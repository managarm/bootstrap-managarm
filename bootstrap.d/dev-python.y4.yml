sources:
  - name: flit_core
    subdir: 'ports'
    git: 'https://github.com/pypa/flit.git'
    tag: '3.12.0'
    version: '3.12.0'

  - name: hatchling
    subdir: 'ports'
    git: 'https://github.com/pypa/hatch.git'
    tag: 'hatchling-v1.27.0'
    version: '1.27.0'

  - name: hatch-fancy-pypi-readme
    subdir: 'ports'
    git: 'https://github.com/hynek/hatch-fancy-pypi-readme.git'
    tag: '25.1.0'
    version: '25.1.0'

  - name: hatch-vcs
    subdir: 'ports'
    git: 'https://github.com/ofek/hatch-vcs.git'
    tag: 'v0.5.0'
    version: '0.5.0'

  - name: setuptools
    subdir: 'ports'
    git: 'https://github.com/pypa/setuptools.git'
    tag: 'v80.9.0'
    version: '80.9.0'

tools:
  - name: host-bragi
    labels: [aarch64, riscv64]
    architecture: noarch
    from_source: bragi
    tools_required:
      - tool: host-python
        recursive: true
    revision: 1
    install:
      - args: ['python3', '-m', 'venv', '.']
        workdir: '@PREFIX@'
      - args: ['bin/pip', 'install', '@THIS_SOURCE_DIR@']
        workdir: '@PREFIX@'
        isolate_network: false

  - name: host-gpep517
    labels: [aarch64, riscv64]
    architecture: noarch
    source:
      subdir: 'ports'
      git: 'https://github.com/gentoo/gpep517.git'
      tag: 'v19'
      version: '19'
    sources_required:
      - flit_core
      - hatchling
      - hatch-fancy-pypi-readme
      - hatch-vcs
      - setuptools
    tools_required:
      - tool: host-python
        recursive: true
    revision: 2
    install:
      - args: ['python3', '-m', 'venv', '.']
        workdir: '@PREFIX@'
      - args: ['bin/pip', 'install', '@THIS_SOURCE_DIR@']
        workdir: '@PREFIX@'
        isolate_network: false
      # We need to install setuptools into the same venv, because build systems can use it
      # Note that other build systems might need more dependencies installed in the venv for gpep517 to work with them
      - args: ['bin/pip', 'install', '@THIS_SOURCE_DIR@/../setuptools']
        workdir: '@PREFIX@'
        isolate_network: false
      - args: ['bin/pip', 'install', '@THIS_SOURCE_DIR@/../flit_core']
        workdir: '@PREFIX@'
        isolate_network: false
      - args: ['bin/pip', 'install', '@THIS_SOURCE_DIR@/../hatchling']
        workdir: '@PREFIX@'
        isolate_network: false
      # Yes these plugins are needed, yes I think that's annoying too
      - args: ['bin/pip', 'install', '@THIS_SOURCE_DIR@/../hatch-fancy-pypi-readme']
        workdir: '@PREFIX@'
        isolate_network: false
      - args: ['bin/pip', 'install', '@THIS_SOURCE_DIR@/../hatch-vcs']
        workdir: '@PREFIX@'
        isolate_network: false

packages:
  - name: python-attrs
    architecture: '@OPTION:arch@'
    metadata:
      summary: Attributes without boilerplate
      description: Python Classes Without Boilerplate
      spdx: 'MIT'
      website: 'https://attrs.readthedocs.io/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-python']
    source:
      subdir: 'ports'
      git: 'https://github.com/python-attrs/attrs.git'
      tag: '25.4.0'
      version: '25.4.0'
    tools_required:
      - host-gpep517
      - system-gcc
    pkgs_required:
      - mlibc
      - python
      - python-zope-interface
    revision: 1
    configure:
      # python modules do not seem to support out-of-tree builds, so we just copy
      # the source tree into the build directory instead.
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['python3', '-m', 'gpep517', 'install-from-source', '--destdir', '@THIS_COLLECT_DIR@', '--optimize', 'all', '--prefix', '/usr', '--sysroot', '@SYSROOT_DIR@', '--interpreter', '/usr/bin/env python3']

  - name: python-colorama
    architecture: '@OPTION:arch@'
    metadata:
      summary: ANSI escape character sequences for colored terminal text & cursor positioning
      description: ANSI escape character sequences for colored terminal text & cursor positioning
      spdx: 'BSD-3-Clause'
      website: 'https://pypi.org/project/colorama/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-python']
    source:
      subdir: 'ports'
      git: 'https://github.com/tartley/colorama.git'
      tag: '0.4.6'
      version: '0.4.6'
    tools_required:
      - host-gpep517
      - system-gcc
    pkgs_required:
      - mlibc
      - python
    revision: 1
    configure:
      # python modules do not seem to support out-of-tree builds, so we just copy
      # the source tree into the build directory instead.
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['python3', '-m', 'gpep517', 'install-from-source', '--destdir', '@THIS_COLLECT_DIR@', '--optimize', 'all', '--prefix', '/usr', '--sysroot', '@SYSROOT_DIR@', '--interpreter', '/usr/bin/env python3']

  - name: python-packaging
    architecture: '@OPTION:arch@'
    metadata:
      summary: Core utilities for Python packages
      description: Core utilities for Python packages
      spdx: 'Apache-2.0'
      website: 'https://packaging.pypa.io/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-python']
    source:
      subdir: 'ports'
      git: 'https://github.com/pypa/packaging.git'
      tag: '25.0'
      version: '25.0'
    tools_required:
      - host-gpep517
      - system-gcc
    pkgs_required:
      - mlibc
      - python
    revision: 1
    configure:
      # python modules do not seem to support out-of-tree builds, so we just copy
      # the source tree into the build directory instead.
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['python3', '-m', 'gpep517', 'install-from-source', '--destdir', '@THIS_COLLECT_DIR@', '--optimize', 'all', '--prefix', '/usr', '--sysroot', '@SYSROOT_DIR@', '--interpreter', '/usr/bin/env python3']

  - name: python-zope-interface
    architecture: '@OPTION:arch@'
    metadata:
      summary: Interfaces for Python
      description: Interfaces for Python
      spdx: 'ZPL'
      website: 'https://github.com/zopefoundation/zope.interface/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-python']
    source:
      subdir: 'ports'
      git: 'https://github.com/zopefoundation/zope.interface.git'
      tag: '8.0.1'
      version: '8.0.1'
    tools_required:
      - host-gpep517
      - system-gcc
    pkgs_required:
      - mlibc
      - python
    revision: 1
    configure:
      # python modules do not seem to support out-of-tree builds, so we just copy
      # the source tree into the build directory instead.
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['python3', '-m', 'gpep517', 'install-from-source', '--destdir', '@THIS_COLLECT_DIR@', '--optimize', 'all', '--prefix', '/usr', '--sysroot', '@SYSROOT_DIR@', '--interpreter', '/usr/bin/env python3']
        environ:
          CC: '@OPTION:arch-triple@-gcc'
