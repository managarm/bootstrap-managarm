!<tag:y4.managarm.org:preamble>
import:
  - !managarm
---
packages:
  - name: alsa-lib
    architecture: '@OPTION:arch@'
    metadata:
      summary: Advanced Linux Sound Architecture Library
      description: This package contains the ALSA library used by programs (including ALSA Utilities) requiring access to the ALSA sound interface.
      spdx: 'LGPL-2.1-only'
      website: 'https://alsa-project.org/wiki/Main_Page'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/alsa-project/alsa-lib.git'
      tag: 'v1.2.13'
      version: '1.2.13'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: flac
    architecture: '@OPTION:arch@'
    metadata:
      summary: Free lossless audio encoder and decoder
      description: FLAC is an audio CODEC similar to MP3, but lossless, meaning that audio is compressed without losing any information.
      spdx: 'LGPL-2.1-only GPL-2.0-only'
      website: 'https://github.com/xiph/flac'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/xiph/flac.git'
      tag: '1.5.0'
      version: '1.5.0'
    tools_required:
      - host-cmake
      - system-gcc
    pkgs_required:
      - mlibc
      - nasm
      - libogg
      - libiconv
    revision: 1
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DCMAKE_BUILD_TYPE=Debug'
        - '-DWITH_ASM=ON'
        - '-DBUILD_SHARED_LIBS=ON'
        - '-DINSTALL_MANPAGES=OFF'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: fontconfig
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: A library for configuring and customizing font access
      description: This package contains a library and support programs used for configuring and customizing font access.
      spdx: 'MIT'
      website: 'https://fontconfig.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: ports
      git: 'https://gitlab.freedesktop.org/fontconfig/fontconfig'
      tag: '2.16.0'
      version: '2.16.0'
      tools_required:
        - host-autoconf-v2.71
        - host-automake-v1.16
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          environ:
            'NOCONFIGURE': 'yes'
        # Make sure we regenerate this file
        - args: ['rm', '-f', 'src/fcobjshash.h']
    tools_required:
      - host-autoconf-v2.71
      - host-automake-v1.16
      - system-gcc
      - host-libtool
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - freetype
      - libxml
      - libiconv
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--sysconfdir=/etc'
        - '--localstatedir=/var'
        - '--disable-docs'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        - '--enable-libxml2'
        - '--docdir=/usr/share/doc/fontconfig-2.16.0'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: freeglut
    architecture: '@OPTION:arch@'
    metadata:
      summary: A free OpenGL utility toolkit, the open-sourced alternative to the GLUT library
      description: Freeglut is intended to be a 100% compatible, completely opensourced clone of the GLUT library. GLUT is a window system independent toolkit for writing OpenGL programs, implementing a simple windowing API, which makes learning about and exploring OpenGL programming very easy.
      spdx: 'MIT'
      website: 'https://freeglut.sourceforge.net/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/FreeGLUTProject/freeglut.git'
      tag: 'v3.6.0'
      version: '3.6.0'
    tools_required:
      - host-cmake
      - system-gcc
    pkgs_required:
      - mlibc
      - libxi
      - mesa
      - glu
    revision: 1
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DBUILD_SHARED_LIBS=ON'
        - '-DFREEGLUT_BUILD_DEMOS=OFF'
        - '-DFREEGLUT_BUILD_STATIC_LIBS=OFF'
        - '-DCMAKE_POLICY_VERSION_MINIMUM=3.5' # CMake 4.0.0 removed compat with CMake < 3.5
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: freetype
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: High-quality and portable font engine
      description: This package contains a library which allows applications to properly render TrueType fonts.
      spdx: 'GPL-2.0-or-later'
      website: 'https://www.freetype.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/freetype/freetype.git'
      tag: 'VER-2-13-3'
      version: '2.13.3'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          isolate_network: false
          environ:
            NOCONFIGURE: '1'
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/builds/unix/']
        # Enable GX/AAT and OpenType table validation
        - args: |
            sed -ri "s:.*(AUX_MODULES.*valid):\1:" @THIS_SOURCE_DIR@/modules.cfg
        # Enable subpixel rendering
        - args: |
            sed -r "s:.*(#.*SUBPIXEL_RENDERING) .*:\1:" -i @THIS_SOURCE_DIR@/include/freetype/config/ftoption.h
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - bzip2
      - libpng
      - zlib
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--with-harfbuzz=no'
        - '--enable-freetype-config'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: giflib
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library to handle, display and manipulate GIF images
      description: This package contains libraries for reading and writing GIFs as well as programs for converting and working with GIF files.
      spdx: 'MIT'
      website: 'https://sourceforge.net/projects/giflib/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: ports
      git: 'https://git.code.sf.net/p/giflib/code'
      tag: '5.2.1'
      version: '5.2.1'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 10
    configure:
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['make', '-j@PARALLELISM@']
        environ:
          CC: "x86_64-managarm-gcc"
      - args: ['make', 'PREFIX=/usr', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: glew
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      url: 'https://github.com/nigels-com/glew/releases/download/glew-2.2.0/glew-2.2.0.tgz'
      format: 'tar.gz'
      checksum: blake2b:f403f3ebd5a78d21cf5744e8e6714a0558c7cda57930751afeced966a54bc9634c070eee4d791f5948bfc60b5c03ca5f488559c6372c0953c0ffe1711a3913f3
      extract_path: 'glew-2.2.0'
      version: '2.2.0'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - glu
      - mesa
    revision: 10
    configure:
      # These two seds lets the build system respect the GCC variable
      - args: ['sed', '-i', 's/CC = cc/CC = $(GCC)/g', '@THIS_SOURCE_DIR@/config/Makefile.linux']
      - args: ['sed', '-i', 's/LD = cc/LD = $(GCC)/g', '@THIS_SOURCE_DIR@/config/Makefile.linux']
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['make', '-j@PARALLELISM@']
        environ:
          GCC: "@OPTION:arch-triple@-gcc"
          # We don't want to install libs in /usr/lib64, so disable that (like gentoo does)
          M_ARCH: ""
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
          GCC: "@OPTION:arch-triple@-gcc"
          M_ARCH: ""

  - name: glu
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/mesa/glu.git'
      tag: 'glu-9.0.3'
      version: '9.0.3'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - gcc # Actually requires libstdc++.so in the system root, otherwise it links against the host libstdc++.so.6
      - mesa
    revision: 6
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: graphene
    architecture: '@OPTION:arch@'
    metadata:
      summary: A thin layer of types for graphic libraries
      description: This package provides a thin layer of types for graphics libraries.
      spdx: 'MIT'
      website: 'https://ebassi.github.io/graphene/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/ebassi/graphene.git'
      tag: '1.10.8'
      version: '1.10.8'
    tools_required:
      - system-gcc
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - !managarm::arch_dep
        arch: [x86_64]
        item: host-mlibc
      - !managarm::arch_dep
        arch: [x86_64]
        item: host-gobject-introspection
      - host-python
      - host-glib
    pkgs_required:
      - mlibc
      - glib
      - !managarm::arch_dep
        arch: [x86_64]
        item: gobject-introspection
    revision: 3
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--buildtype=release'
        - '-Dgtk_doc=false'
        - !managarm::arch_ite
          arch: [x86_64]
          # Disabled on all architectures for now
          then: '-Dintrospection=disabled'
          else: '-Dintrospection=disabled'
        - '-Dtests=false'
        - '-Dinstalled_tests=false'
        - '@THIS_SOURCE_DIR@'
        environ:
          # Same as below
          RUN_WRAPPER_LD_LIBRARY_PATH: '@BUILD_ROOT@/tools/host-mlibc/lib:@SYSROOT_DIR@/usr/lib:@SYSROOT_DIR@/usr/lib64:@THIS_BUILD_DIR@/girepository'
          RUN_WRAPPER_INTERP: '@BUILD_ROOT@/tools/host-mlibc/lib/ld.so'
    build:
      - args: ['ninja']
        environ:
          # Library path for our run-wrapper that allows it to load managarm libraries
          RUN_WRAPPER_LD_LIBRARY_PATH: '@BUILD_ROOT@/tools/host-mlibc/lib:@SYSROOT_DIR@/usr/lib:@SYSROOT_DIR@/usr/lib64:@THIS_BUILD_DIR@/girepository'
          # Similar to above, but using a nasty (but working) hack lets us use a Linux mlibc build to execute an
          # executable that was cross-compiled for managarm
          RUN_WRAPPER_INTERP: '@BUILD_ROOT@/tools/host-mlibc/lib/ld.so'
          # This is a custom environment variable which tells g-ir-scanner what to use instead of ldd
          # We point it at our native ldd-wrapper that's installed as part of host-gobject-introspection
          GI_LDD_WRAPPER: ldd-wrapper
          # This tells g-ir-scanner what program should be used for "cross-launching" the executables it builds
          GI_CROSS_LAUNCHER: run-wrapper
          # Path to the introspection data installed by other packages
          GI_GIR_PATH: '@SYSROOT_DIR@/usr/share/gir-1.0'
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: gst-plugins-bad
    architecture: '@OPTION:arch@'
    metadata:
      summary: Less plugins for GStreamer
      description: The GStreamer Bad Plug-ins package contains a set of plug-ins that aren't up to par compared to the rest. They might be close to being good quality, but they're missing something - be it a good code review, some documentation, a set of tests, a real live maintainer, or some actual wide use.
      spdx: 'LGPL-2.0-only'
      website: 'https://gstreamer.freedesktop.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      url: 'https://gstreamer.freedesktop.org/src/gst-plugins-bad/gst-plugins-bad-1.26.0.tar.xz'
      format: 'tar.xz'
      extract_path: 'gst-plugins-bad-1.26.0'
      checksum: blake2b:b8ffd8c7694c171f4e2bff88e37c0c63d5f58d04baa2a7bad4b526179ef630cc6909a8bef3479cdc5ee8c7c1f23f1c53f4a6f462799a0f940483116b407c12ae
      version: '1.26.0'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - wayland-scanner
    pkgs_required:
      - mlibc
      - gstreamer
      - gst-plugins-base
      - curl
      - libsndfile
      - libsoup
      - libwebp
      - libxkbcommon
      - wayland
      - wayland-protocols
      - gtk+-3
      - opus
      - gst-plugins-good
      - pango
      - libxml
      - openssl
      - nettle
      - libmodplug
      - vulkan-headers
      - libusb
    revision: 1
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - '--wrap-mode=nodownload'
        - '-Dgpl=enabled'
        - '-Dpackage-origin=https://managarm.org/'
        - '-Dpackage-name="GStreamer 1.26.0 Managarm"'
        - '-Dopenh264=disabled'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: gst-plugins-base
    architecture: '@OPTION:arch@'
    metadata:
      summary: Basepack of plugins for GStreamer
      description: The GStreamer Base Plug-ins is a well-groomed and well-maintained collection of GStreamer plug-ins and elements, spanning the range of possible types of elements one would want to write for GStreamer.
      spdx: 'LGPL-2.0-or-later GPL-2.0-or-later'
      website: 'https://gstreamer.freedesktop.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      url: 'https://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-1.26.0.tar.xz'
      format: 'tar.xz'
      extract_path: 'gst-plugins-base-1.26.0'
      checksum: blake2b:7d9bbbaf24d981af2794e013ece6b69b9e973ea34a1517bbb550b7d3d7ae778a676f56a56a07a67a684af458af53350f591fe1a1eff5f570d147f3a0374b35b6
      version: '1.26.0'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - wayland-scanner
    pkgs_required:
      - mlibc
      - gstreamer
      - mesa
      - wayland-protocols
      - libogg
      - libtheora
      - libvorbis
      - libjpeg-turbo
      - libpng
      - libx11
      - glib
      - gdk-pixbuf
      - gtk+-3
      - zlib
      - libdrm
      - wayland
      - pango
      - libxext
    revision: 1
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - !managarm::arch_ite
          arch: [x86_64]
          # Disabled on all architectures for now
          then: '-Dintrospection=disabled'
          else: '-Dintrospection=disabled'
        - '--wrap-mode=nodownload'
        - '-Dorc=disabled'
        - '-Dexamples=disabled'
        - '-Dpackage-origin=https://managarm.org/'
        - '-Dpackage-name="GStreamer 1.26.0 Managarm"'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: gst-plugins-good
    architecture: '@OPTION:arch@'
    metadata:
      summary: Basepack of plugins for GStreamer
      description: The GStreamer Good Plug-ins is a set of plug-ins considered by the GStreamer developers to have good quality code, correct functionality, and the preferred license (LGPL for the plug-in code, LGPL or LGPL-compatible for the supporting library). A wide range of video and audio decoders, encoders, and filters are included.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://gstreamer.freedesktop.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      url: 'https://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-1.26.0.tar.xz'
      format: 'tar.xz'
      extract_path: 'gst-plugins-good-1.26.0'
      checksum: blake2b:e10f51ed5c4cf9012a37ceaeb6e2c4835bc9d79c84b44fea3cbe6d0cb287f4f8f3af58ff6736d30e0900b3067b716ae83bf10923a1756f83bedc480e44d6bf2e
      version: '1.26.0'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - wayland-scanner
    pkgs_required:
      - mlibc
      - gstreamer
      - gst-plugins-base
      - flac
      - gdk-pixbuf
      - libsoup
      - libvpx
      - cairo
      - wayland
      - wayland-protocols
      - gtk+-3
      - libjpeg-turbo
      - libpng
      - nettle
      - libxml
    revision: 1
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - '--wrap-mode=nodownload'
        - '-Dpackage-origin=https://managarm.org/'
        - '-Dpackage-name="GStreamer 1.26.0 Managarm"'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: gstreamer
    architecture: '@OPTION:arch@'
    metadata:
      summary: Open source multimedia framework
      description: This package contains a streaming media framework that enables applications to share a common set of plugins for tasks such as video encoding and decoding, audio encoding and decoding, audio and video filters, audio visualisation, web streaming and anything else that streams in real-time or otherwise. This package only provides base functionality and libraries of the GStreamer stack.
      spdx: 'LGPL-2.0-or-later'
      website: 'https://gstreamer.freedesktop.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      url: 'https://gstreamer.freedesktop.org/src/gstreamer/gstreamer-1.26.0.tar.xz'
      format: 'tar.xz'
      extract_path: 'gstreamer-1.26.0'
      checksum: blake2b:48ac9eb40c3ae9644028d2f1135658cb6eb661870556edfb956023bc126a3d8077e5e030c0f3718a0f572a0ac8bcc2339cad8e74563cd0c10de7f9956bcba939
      version: '1.26.0'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - glib
    revision: 1
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - !managarm::arch_ite
          arch: [x86_64]
          # Disabled on all architectures for now
          then: '-Dintrospection=disabled'
          else: '-Dintrospection=disabled'
        - '-Dptp-helper-setuid-user=false'
        - '-Dptp-helper-setuid-group=false'
        - '-Dptp-helper-permissions=none'
        - '-Dlibunwind=disabled'
        - '-Dlibdw=disabled'
        - '-Dgst_debug=false'
        - '-Dcheck=disabled'
        - '-Dpackage-origin=https://managarm.org/'
        - '-Dpackage-name="GStreamer 1.26.0 Managarm"'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: harfbuzz
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: An OpenType text shaping engine
      description: This package contains an OpenType text shaping engine.
      spdx: 'ISC'
      website: 'https://harfbuzz.github.io/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/harfbuzz/harfbuzz.git'
      tag: '11.0.0'
      version: '11.0.0'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - !managarm::arch_dep
        item: host-mlibc
        arch: [x86_64]
      - !managarm::arch_dep
        item: host-gobject-introspection
        arch: [x86_64]
      - host-python
      - host-glib
    pkgs_required:
      - mlibc
      - graphite2
      - glib
      - zlib
      - freetype
      - cairo
      - icu
      - !managarm::arch_dep
        item: gobject-introspection
        arch: [x86_64]
    revision: 1
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--native-file'
        - '@SOURCE_ROOT@/scripts/meson.native-file'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - '-Dgraphite2=enabled'
        - '-Dglib=enabled'
        - '-Dgobject=enabled'
        - '-Dicu=enabled'
        - '-Dfreetype=enabled'
        - '-Dcairo=enabled'
        - !managarm::arch_ite
          arch: [x86_64]
          then: '-Dintrospection=enabled'
          else: '-Dintrospection=disabled'
        - '-Ddocs=disabled'
        - '-Dtests=disabled' # Disabled due to a linking error
        - '@THIS_SOURCE_DIR@'
        environ:
          # Same as below
          RUN_WRAPPER_LD_LIBRARY_PATH: '@BUILD_ROOT@/tools/host-mlibc/lib:@SYSROOT_DIR@/usr/lib:@SYSROOT_DIR@/usr/lib64:@THIS_BUILD_DIR@/girepository'
          RUN_WRAPPER_INTERP: '@BUILD_ROOT@/tools/host-mlibc/lib/ld.so'
    build:
      - args: ['ninja']
        environ:
          # Library path for our run-wrapper that allows it to load managarm libraries
          RUN_WRAPPER_LD_LIBRARY_PATH: '@BUILD_ROOT@/tools/host-mlibc/lib:@SYSROOT_DIR@/usr/lib:@SYSROOT_DIR@/usr/lib64:@THIS_BUILD_DIR@/girepository'
          # Similar to above, but using a nasty (but working) hack lets us use a Linux mlibc build to execute an
          # executable that was cross-compiled for managarm
          RUN_WRAPPER_INTERP: '@BUILD_ROOT@/tools/host-mlibc/lib/ld.so'
          # This is a custom environment variable which tells g-ir-scanner what to use instead of ldd
          # We point it at our native ldd-wrapper that's installed as part of host-gobject-introspection
          GI_LDD_WRAPPER: ldd-wrapper
          # This tells g-ir-scanner what program should be used for "cross-launching" the executables it builds
          GI_CROSS_LAUNCHER: run-wrapper
          # Path to the introspection data installed by other packages
          GI_GIR_PATH: '@SYSROOT_DIR@/usr/share/gir-1.0'
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libcanberra
    architecture: '@OPTION:arch@'
    metadata:
      summary: Portable sound event library
      description: libcanberra is an implementation of the XDG Sound Theme and Name Specifications, for generating event sounds on free desktops, such as GNOME.
      spdx: 'LGPL-2.1-or-later'
      website: 'http://0pointer.de/lennart/projects/libcanberra/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      url: 'https://0pointer.de/lennart/projects/libcanberra/libcanberra-0.30.tar.xz'
      format: 'tar.xz'
      extract_path: 'libcanberra-0.30'
      checksum: blake2b:c90c6863738b103c256eeb0907060a0f74b73ef50ac0728d2114aa558a7a1ad7cbae4184860573d3fac0032eba77327a4de94c459b99a81c3dc19da0e98adfda
      version: '0.30'
      patch-path-strip: 1
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
      - host-libtool
    pkgs_required:
      - mlibc
      - libvorbis
      - alsa-lib
      - gtk+-3
      - gstreamer
      - libtool
    revision: 2
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--enable-shared'
        - '--disable-oss'
        - '--disable-gtk'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'docdir=@THIS_COLLECT_DIR@/usr/share/doc/libcanberra-0.30', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libdisplay-info
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Simple framework for writing Vulkan layers
      description: libdisplay-info is a simple framework for writing Vulkan layers.
      spdx: 'MIT'
      website: 'https://gitlab.freedesktop.org/emersion/libdisplay-info'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/emersion/libdisplay-info.git'
      tag: '0.2.0'
      version: '0.2.0'
    tools_required:
      - host-pkg-config
      - system-gcc
      - host-hwdata
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - virtual: pkgconfig-for-host
        program_name: host-pkg-config
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
          - 'meson'
          - 'setup'
          - '--native-file'
          - '@SOURCE_ROOT@/scripts/meson.native-file'
          - '--cross-file'
          - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
          - '--prefix=/usr'
          - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libepoxy
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library for handling OpenGL function pointer management
      description: libdisplay-info is a library for handling OpenGL function pointer management.
      spdx: 'MIT'
      website: 'https://github.com/anholt/libepoxy'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/anholt/libepoxy.git'
      tag: '1.5.10'
      version: '1.5.10'
    tools_required:
      - host-pkg-config
      - system-gcc
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - mesa
      - xorg-proto
      - libx11
    revision: 9
    configure:
      - args:
          - 'meson'
          - 'setup'
          - '--cross-file'
          - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
          - '--prefix=/usr'
          - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libglvnd
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: The GL Vendor-Neutral Dispatch library
      description: This package contains the GL Vendor-Neutral Dispatch library.
      spdx: 'MIT'
      website: 'https://gitlab.freedesktop.org/glvnd/libglvnd'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/glvnd/libglvnd.git'
      tag: 'v1.7.0'
      version: '1.7.0'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - libx11
      - libxext
    revision: 7
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - '-Dasm=disabled'
        - '-Dx11=enabled'
        - '-Degl=true'
        - '-Dglx=enabled'
        - '-Dgles1=true'
        - '-Dgles2=true'
        - '-Dtls=true'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libjpeg-turbo
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: MMX, SSE, and SSE2 SIMD accelerated JPEG library
      description: libjpeg-turbo is a fork of the original IJG libjpeg which uses SIMD to accelerate baseline JPEG compression and decompression. libjpeg is a library that implements JPEG image encoding, decoding and transcoding.
      spdx: 'BSD-3-Clause ZLIB'
      website: 'https://libjpeg-turbo.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/libjpeg-turbo/libjpeg-turbo.git'
      tag: '3.1.0'
      version: '3.1.0'
    tools_required:
      - host-pkg-config
      - system-gcc
      - host-cmake
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - 'cmake'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DCMAKE_BUILD_TYPE=RELEASE'
        - '-DENABLE_STATIC=FALSE'
        - '-DCMAKE_INSTALL_DOCDIR=/usr/share/doc/libjpeg-turbo-3.1.0'
        - '-DCMAKE_INSTALL_DEFAULT_LIBDIR=lib'
        - '-DWITH_JPEG8=ON'
        - '-DCMAKE_SYSTEM_PROCESSOR=@OPTION:arch@'
        - '@THIS_SOURCE_DIR@/'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libmodplug
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library for playing MOD-like music files
      description: This package contains a library for playing MOD-like music files.
      spdx: 'public-domain'
      website: 'https://modplug-xmms.sourceforge.net/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/Konstanty/libmodplug.git'
      # Check out current master
      branch: 'master'
      commit: 'd04fbc2eb2dddc9dd05fbcc29ab062f83a7a2a48'
      version: '0.8.9.1'
      tools_required:
        - host-autoconf-v2.71
        - host-automake-v1.16
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libogg
    architecture: '@OPTION:arch@'
    metadata:
      summary: The Ogg media file format library
      description: This package contains the Ogg file structure. This is useful for creating (encoding) or playing (decoding) a single physical bit stream.
      spdx: 'BSD'
      website: 'https://xiph.org/ogg/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/xiph/ogg.git'
      tag: 'v1.3.5'
      version: '1.3.5'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          environ:
            NOCONFIGURE: '1'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 11
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libpng
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Portable Network Graphics library
      description: This package contains libraries used by other programs for reading and writing PNG files. The PNG format was designed as a replacement for GIF and, to a lesser extent, TIFF, with many improvements and extensions and lack of patent problems.
      spdx: 'no-spdx: libpng'
      website: 'http://www.libpng.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      url: 'https://downloads.sourceforge.net/libpng/libpng-1.6.44.tar.xz'
      format: 'tar.xz'
      extract_path: 'libpng-1.6.44'
      checksum: blake2b:61064dd83f40a7e2e60ff723a568b7d0cda95aa80621a211aee7127b9783fbfc20cd82a2fe2d03584cbf9ab77c5444e3e008ac5ccc7f64af6e858ebcbcb78822
      version: '1.6.44'
      patch-path-strip: 1
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['git', 'clean', '-xf', '-e', '*.xbstrap']
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - zlib
    revision: 3
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        # TODO: libpng fails to build without -mno-relax (toolchain issue?).
        - !managarm::arch_ite
          arch: [riscv64]
          then: 'CFLAGS=-O2 -g -mno-relax'
          else: 'CFLAGS=-O2 -g'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libtiff
    architecture: '@OPTION:arch@'
    metadata:
      summary: Tag Image File Format (TIFF) library
      description: This package contains the TIFF libraries and associated utilities. The libraries are used by many programs for reading and writing TIFF files and the utilities are used for general work with TIFF files.
      spdx: 'libtiff'
      website: 'http://libtiff.maptools.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.com/libtiff/libtiff.git'
      tag: 'v4.7.0'
      version: '4.7.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - freeglut
      - libjpeg-turbo
      - zlib
      - zstd
      - xz-utils
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--enable-shared'
        - '--with-docdir=/usr/share/doc/libtiff-4.7.0'
        - '--without-x'
        - '--enable-zlib'
        - '--enable-zstd'
        - '--enable-jpeg'
        - '--enable-lzma'
        - '--disable-webp'
        - '--enable-cxx'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libsndfile
    architecture: '@OPTION:arch@'
    metadata:
      summary: C library for reading and writing files containing sampled sound
      description: Libsndfile is a library of C routines for reading and writing files containing sampled audio data.
      spdx: 'LGPL-2.1-only'
      website: 'https://github.com/libsndfile/libsndfile'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      url: 'https://github.com/libsndfile/libsndfile/releases/download/1.2.2/libsndfile-1.2.2.tar.xz'
      format: 'tar.xz'
      extract_path: 'libsndfile-1.2.2'
      checksum: blake2b:bc8e49983d9ad9dfd98984e2ffef501c6f576480e556e9f9ef91c7d597524cc1bb8baed15dfef8e239f72c42136c524117029eb8271f3a2c9d607fee490279b5
      version: '1.2.2'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - flac
      - opus
      - libvorbis
      - sqlite
      - alsa-lib
    revision: 6
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--enable-shared'
        - '--docdir=/usr/share/doc/libsndfile-1.2.2'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libtheora
    architecture: '@OPTION:arch@'
    metadata:
      summary: The Theora Video Compression Codec
      description: This package contains the Theora Video Compression Codec.
      spdx: 'BSD'
      website: 'https://www.theora.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/xiph/theora.git'
      tag: 'v1.2.0'
      version: '1.2.0'
      tools_required:
        - host-autoconf-v2.71
        - host-automake-v1.16
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - libogg
      - libvorbis
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--disable-spec'
        - '--disable-sdltest'
        - '--disable-vorbistest'
        - '--disable-oggtest'
        - '--disable-examples'
        - '--disable-asm'
        environ:
          HAVE_DOXYGEN: 'false'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libvorbis
    architecture: '@OPTION:arch@'
    metadata:
      summary: The Ogg Vorbis sound file format library
      description: This package contains a general purpose audio and music encoding format. This is useful for creating (encoding) and playing (decoding) sound in an open (patent free) format.
      spdx: 'BSD'
      website: 'https://xiph.org/vorbis/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/xiph/vorbis.git'
      tag: 'v1.3.7'
      version: '1.3.7'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          environ:
            NOCONFIGURE: '1'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - libogg
    revision: 11
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libvpx
    architecture: '@OPTION:arch@'
    metadata:
      summary: WebM VP8 and VP9 Codec SDK
      description: This package provides the reference implementations of the VP8 Codec, used in most current html5 video, and of the next-generation VP9 Codec.
      spdx: 'BSD-3-Clause'
      website: 'https://www.webmproject.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://chromium.googlesource.com/webm/libvpx.git'
      tag: 'v1.15.0'
      version: '1.15.0'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - nasm
    revision: 1
    configure:
      # Fix ownership and permission of installed files.
      - args: ['sed', '-i', 's/cp -p/cp/', '@THIS_SOURCE_DIR@/build/make/Makefile']
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=/usr'
        - '--disable-static'
        - '--enable-shared'
        # Generic GNU target to disable optimizations
        - '--force-target=generic-gnu'
        - '--enable-pic'
        - '--enable-vp8'
        - '--enable-vp9'
        - '--enable-multithread'
        - '--enable-vp9-highbitdepth'
        - '--disable-examples'
        - '--disable-install-docs'
        - '--disable-docs'
    build:
      - args: ['make', 'HAVE_GNU_STRIP=no', 'CC=@OPTION:arch-triple@-gcc', 'LD=@OPTION:arch-triple@-gcc', 'CXX=@OPTION:arch-triple@-g++', 'AR=@OPTION:arch-triple@-ar', 'NM=@OPTION:arch-triple@-nm', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libwebp
    architecture: '@OPTION:arch@'
    metadata:
      summary: A lossy image compression format
      description: This package contains a library and support programs to encode and decode images in WebP format.
      spdx: 'BSD-3-Clause'
      website: 'https://github.com/webmproject/libwebp'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/webmproject/libwebp.git'
      tag: 'v1.5.0'
      version: '1.5.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - libjpeg-turbo
      - libpng
      - freeglut
      - sdl2
      - libtiff
      - giflib
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--enable-libwebpmux'
        - '--enable-libwebpdemux'
        - '--enable-libwebpdecoder'
        - '--enable-libwebpextras'
        - '--enable-swap-16bit-csp'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: mesa
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/mesa/mesa.git'
      tag: 'mesa-25.0.2'
      version: '25.0.2'
    tools_required:
      - host-pkg-config
      - system-gcc
      - wayland-scanner
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - virtual: pkgconfig-for-host
        program_name: host-pkg-config
    pkgs_required:
      - mlibc
      - libdrm
      - llvm
      - wayland
      - wayland-protocols
      - zlib
      - libxshmfence
      - libxrandr
      - libxdamage
      - libxxf86vm
      - libxfixes
      - libx11
      - libxext
      - libxcb
      - libglvnd
      - libexpat
      - zstd
    revision: 1
    configure:
      - args: ['cp', '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file', 'meson.cross-file']
      - args:
        - 'sed'
        - '-i'
        - "/^# sed adds binaries here.$/a llvm-config = '@SOURCE_ROOT@/scripts/cross-llvm-config'"
        - 'meson.cross-file'
      - args:
        - 'meson'
        - 'setup'
        - '--native-file'
        - '@SOURCE_ROOT@/scripts/meson.native-file'
        - '--cross-file'
        - 'meson.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        # The debug build type enables some additional output from Mesa.
        - '--buildtype=debugoptimized'
        #- '--buildtype=debug'
        - '-Dglx=dri'
        - '-Dplatforms=wayland,x11'
        - '-Dgallium-drivers=swrast'
        - '-Dvulkan-drivers='
        - '-Dglvnd=enabled'
        # Force Mesa to build with LLVM.
        - '-Dllvm=enabled'
        - '-Dgallium-nine=false'
        - '-Dgallium-va=disabled'
        - '-Dgallium-vdpau=disabled'
        - '-Dgallium-xa=disabled'
        - '-Dshared-glapi=enabled'
        - '-Degl=enabled'
        - '-Dgbm=enabled'
        - '-Dgles1=enabled'
        - '-Dgles2=enabled'
        - '-Dzstd=enabled'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: vulkan-loader
    architecture: '@OPTION:arch@'
    metadata:
      summary: Vulkan Installable Client Driver (ICD) Loader
      description: This package provides the Vulkan Installable Client Driver (ICD) Loader. This allows the vulkan driver to be chosen at run time, rather than requiring static configuration.
      spdx: 'Apache-2.0'
      website: 'https://github.com/KhronosGroup/Vulkan-Loader'
      maintainer: "Alexander Richards <electrodeyt@gmail.com>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/KhronosGroup/Vulkan-Loader.git'
      tag: 'v1.3.268'
      version: '1.3.268'
    tools_required:
      - system-gcc
      - host-cmake
    pkgs_required:
      - mlibc
      - libx11
      - libxrandr
      - wayland
      - wayland-protocols
      # This is only required for building.
      - vulkan-headers
    revision: 6
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DBUILD_TESTS=OFF'
        - '-DBUILD_WSI_WAYLAND_SUPPORT=ON'
        - '-DBUILD_WSI_XCB_SUPPORT=ON'
        - '-DBUILD_WSI_XLIB_SUPPORT=ON'
        - '-DVULKAN_HEADERS_INSTALL_DIR=@THIS_COLLECT_DIR@/usr'
        - '-DENABLE_WERROR=OFF'
        - '@THIS_SOURCE_DIR@/'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: opus
    architecture: '@OPTION:arch@'
    metadata:
      summary: Open codec for interactive speech and music transmission over the Internet
      description: Opus is a lossy audio compression format developed by the Internet Engineering Task Force (IETF) that is particularly suitable for interactive speech and audio transmission over the Internet. This package provides the Opus development library and headers.
      spdx: 'BSD-3-Clause'
      website: 'https://opus-codec.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.xiph.org/xiph/opus.git'
      tag: 'v1.5.2'
      version: '1.5.2'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          isolate_network: false
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--docdir=/usr/share/doc/opus-1.5.2'
        - '--disable-static'
        - '--disable-intrinsics'
        - '--disable-doc'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: sdl2
    architecture: '@OPTION:arch@'
    metadata:
      summary: Simple Direct Media Layer version 2
      description: The Simple DirectMedia Layer Version 2 (SDL2 for short) is a cross-platform library designed to make it easy to write multimedia software, such as games and emulators.
      spdx: 'Zlib'
      website: 'https://www.libsdl.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['media-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/libsdl-org/SDL.git'
      tag: 'release-2.32.4'
      version: '2.32.4'
    tools_required:
      - system-gcc
      - host-cmake
      - host-pkg-config
      - wayland-scanner
    pkgs_required:
      - mlibc
      - libdrm
      - systemd
      - mesa
      - wayland
      - wayland-protocols
      - libiconv
      - libx11
      - libxext
      - libxcursor
      - libxinerama
      - libxi
      - libxfixes
      - libxrandr
      - libxrender
      - libxxf86vm
      - libxkbcommon
    revision: 1
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DSDL_ALTIVEC=OFF'
        - '-DSDL_DISKAUDIO=OFF'
        - '-DSDL_DIRECTFB=ON'
        - '-DSDL_OPENGL=ON'
        - '-DSDL_OPENGLES=ON'
        - '-DSDL_PTHREADS=ON'
        - '-DSDL_PTHREADS_SEM=OFF'
        - '-DSDL_OSS=OFF'
        - '-DSDL_ALSA=OFF'
        - '-DSDL_JACK=OFF'
        - '-DSDL_ESD=OFF'
        - '-DSDL_PULSEAUDIO=OFF'
        - '-DSDL_ARTS=OFF'
        - '-DSDL_NAS=OFF'
        - '-DSDL_SNDIO=OFF'
        - '-DSDL_FUSIONSOUND=OFF'
        - '-DSDL_LIBSAMPLERATE=OFF'
        - '-DSDL_RPATH=OFF'
        - '-DSDL_CLOCK_GETTIME=OFF'
        - '-DSDL_INPUT_TSLIB=OFF'
        - '-DSDL_X11=ON'
        - '-DSDL_WAYLAND=ON'
        - '-DSDL_WAYLAND_QT_TOUCH=OFF'
        - '-DSDL_RPI=OFF'
        - '-DSDL_COCOA=OFF'
        - '-DSDL_DIRECTX=OFF'
        - '-DSDL_WASAPI=OFF'
        - '-DSDL_RENDER_D3D=OFF'
        - '-DSDL_VIVANTE=OFF'
        - '-DSDL_VULKAN=OFF'
        - '-DSDL_KMSDRM=ON'
        - '-DSDL_KMSDRM_SHARED=OFF'
        - '-DSDL_DLOPEN=ON'
        - '-DSDL_HIDAPI=OFF'
        - '-DSDL_SHARED=ON'
        - '-DSDL_STATIC=OFF'
        - '@THIS_SOURCE_DIR@/'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true
