!<tag:y4.managarm.org:preamble>
import:
  - !managarm
---
sources:
  - name: appstream
    subdir: 'ports'
    git: 'https://github.com/ximion/appstream.git'
    tag: 'v1.0.4'
    version: '1.0.4'

  - name: glib
    subdir: ports
    git: 'https://gitlab.gnome.org/GNOME/glib.git'
    tag: '2.78.4'
    version: '2.78.4'

  - name: gobject-introspection
    subdir: 'ports'
    git: 'https://gitlab.gnome.org/GNOME/gobject-introspection.git'
    tag: '1.78.1'
    version: '1.78.1'

  - name: icu
    subdir: 'ports'
    git: 'https://github.com/unicode-org/icu.git'
    tag: 'release-76-1'
    version: '76.1'
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
      - host-libtool
    regenerate:
      - args: ['cp',
          '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
          '@THIS_SOURCE_DIR@/icu4c/source']

  - name: libffi
    subdir: 'ports'
    git: 'https://github.com/libffi/libffi.git'
    tag: 'v3.4.4'
    version: '3.4.4'
    tools_required:
      - host-autoconf-v2.71
      - host-automake-v1.11
      - host-libtool
    regenerate:
      - args: ['./autogen.sh']
      - args: ['cp',
          '@BUILD_ROOT@/tools/host-automake-v1.11/share/automake-1.11/config.sub',
          '@THIS_SOURCE_DIR@/']

  - name: nss
    subdir: 'ports'
    git: 'https://github.com/nss-dev/nss.git'
    tag: 'NSS_3_106_RTM'
    version: '3.106.RTM'

  - name: wayland
    subdir: 'ports'
    url: 'https://gitlab.freedesktop.org/wayland/wayland/-/releases/1.22.0/downloads/wayland-1.22.0.tar.xz'
    checksum: 'blake2b:b0bb366e7f3494813d1574228ae5dd48eccde035120d6dd8709e3a24738681ab9dd9ba6a13924b6a35982d331fa8911fa7346911da9f618be9c9109da0288629'
    extract_path: 'wayland-1.22.0'
    patch-path-strip: 1
    format: 'tar.xz'
    tag: '1.22.0'
    version: '1.22.0'

  - name: libtool
    subdir: 'ports'
    git: 'https://git.savannah.gnu.org/git/libtool.git'
    tag: 'v2.5.4'
    version: '2.5.4'
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
    regenerate:
      # libtool's ./bootstrap does a shallow clone with insufficient depth.
      - args: ['git', 'submodule', 'update', '--init']
        isolate_network: false
      - args: ['./bootstrap']
      - args: ['cp',
          '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
          '@THIS_SOURCE_DIR@/build-aux/']
      - args: ['cp',
          '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.guess',
          '@THIS_SOURCE_DIR@/build-aux/']


tools:
  - name: host-appstream
    architecture: noarch
    from_source: appstream
    exports_aclocal: true
    exports_shared_libs: true
    tools_required:
      - host-pkg-config
      - virtual: pkgconfig-for-host
        program_name: host-pkg-config
    revision: 1
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--native-file'
        - '@SOURCE_ROOT@/scripts/meson.native-file'
        - '--prefix=@PREFIX@'
        - '-Dapidocs=false'
        - '-Ddocs=false'
        - '-Dcompose=false'
        - '-Dmaintainer=false'
        - '-Dstatic-analysis=false'
        - '-Dstemming=false'
        - '-Dvapi=false'
        - '-Dapt-support=false'
        - '-Dinstall-docs=false'
        - '-Dgir=false'
        - '-Dqt=false'
        - '-Dsystemd=false'
        - '-Ddocs=false'
        - '@THIS_SOURCE_DIR@'
        isolate_network: false
    compile:
      - args: ['ninja']
    install:
      - args: ['ninja', 'install']

  - name: host-glib
    labels: [aarch64, riscv64]
    architecture: noarch
    exports_aclocal: true
    exports_shared_libs: true
    from_source: glib
    tools_required:
      - host-libffi
      - host-pkg-config
      - virtual: pkgconfig-for-host
        program_name: host-pkg-config
    revision: 3
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--native-file'
        - '@SOURCE_ROOT@/scripts/meson.native-file'
        - '--prefix=@PREFIX@'
        - '--libdir=lib'
        - '@THIS_SOURCE_DIR@'
        isolate_network: false
    compile:
      - args: ['ninja']
    install:
      - args: ['ninja', 'install']

  - name: host-gobject-introspection
    architecture: noarch
    exports_aclocal: true
    exports_shared_libs: true
    from_source: gobject-introspection
    tools_required:
      - host-python
      - host-glib
      - host-pkg-config
      - virtual: pkgconfig-for-host
        program_name: host-pkg-config
    revision: 4
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--prefix=@PREFIX@'
        - '--native-file'
        - '@SOURCE_ROOT@/scripts/meson.native-file'
        - '-Dbuild_introspection_data=false'
        - '@THIS_SOURCE_DIR@'
        isolate_network: false
    compile:
      - args: ['ninja']
    install:
      - args: ['ninja', 'install']
      - args: ['cp', '-rpv', '@SOURCE_ROOT@/scripts/ldd-wrapper', '@PREFIX@/bin/']
      - args: ['cp', '-rpv', '@SOURCE_ROOT@/scripts/run-wrapper', '@PREFIX@/bin/']

  - name: host-icu
    labels: [aarch64, riscv64]
    architecture: noarch
    from_source: icu
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/icu4c/source/configure'
        - '--prefix=@PREFIX@'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

  - name: host-libffi
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    from_source: libffi
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=@PREFIX@'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

packages:
  - name: appstream
    architecture: '@OPTION:arch@'
    metadata:
      summary: Cross-distro effort for providing metadata for software in the Linux ecosystem
      description: This package provides a library and tool that is useful for retrieving software metadata and making it easily accessible to programs which need it.
      spdx: 'LGPL-2.1-or-later GPL-2.0-or-later'
      website: 'https://www.freedesktop.org/wiki/Distributions/AppStream/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    from_source: 'appstream'
    tools_required:
      - system-gcc
      - host-appstream
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - curl
      - glib
      - libxml
      - libxmlb
      - libyaml
    revision: 1
    configure:
      - args: ['mkdir', '-pv', '@THIS_BUILD_DIR@/data']
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/data/org.freedesktop.appstream.cli.metainfo.xml', '@THIS_BUILD_DIR@/data/nol10n_withrelinfo_org.freedesktop.appstream.cli.metainfo.xml']
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@-appstream.cross-file'
        - '--prefix=/usr'
        - '--buildtype=release'
        - '-Dapidocs=false'
        - '-Ddocs=false'
        - '-Dcompose=false'
        - '-Dmaintainer=false'
        - '-Dstatic-analysis=false'
        - '-Dstemming=false'
        - '-Dvapi=false'
        - '-Dapt-support=false'
        - '-Dinstall-docs=false'
        - '-Dgir=false'
        - '-Dqt=false'
        - '-Dsystemd=false'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: atk
    architecture: '@OPTION:arch@'
    metadata:
      summary: GTK+ & GNOME Accessibility Toolkit
      description: This package provides a set of accessibility interfaces used extensively througout GTK and GNOME.
      spdx: 'LGPL-2.0-or-later'
      website: 'https://wiki.gnome.org/Accessibility'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.gnome.org/GNOME/atk.git'
      tag: '2.38.0'
      version: '2.38.0'
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - glib
    revision: 8
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - !managarm::arch_ite
          arch: [x86_64]
          # Disabled on all architectures for now
          then: '-Dintrospection=false'
          else: '-Dintrospection=false'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: d0-blind-id
    architecture: '@OPTION:arch@'
    metadata:
      summary: Blind-ID library for user identification using RSA blind signatures
      description: This package provides a library for user identification using RSA blind signatures.
      spdx: 'BSD-3-Clause'
      website: 'https://git.xonotic.org/?p=xonotic/d0_blind_id.git'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/divVerent/d0_blind_id.git'
      tag: 'v1.0'
      version: '1.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - gmp
    revision: 9
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--disable-rijndael'
        - '--without-openssl'
        - '--without-tommath'
        - '--without-tfm'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: double-conversion
    architecture: '@OPTION:arch@'
    metadata:
      summary: Efficient binary-decimal and decimal-binary conversion routines for IEEE doubles
      description: This package provides a library with conversion routines for binary to decimal and decimal to binary with IEEE doubles.
      spdx: 'BSD-3-Clause'
      website: 'https://github.com/google/double-conversion'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://github.com/google/double-conversion.git'
      tag: 'v3.3.0'
      version: '3.3.0'
    tools_required:
      - host-cmake
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 6
    configure:
      - args:
        - 'cmake'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DBUILD_SHARED_LIBS=ON'
        - '@THIS_SOURCE_DIR@'
        environ:
          CC: '@OPTION:arch-triple@-gcc'
          CXX: '@OPTION:arch-triple@-g++'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: elfutils
    architecture: '@OPTION:arch@'
    metadata:
      summary: Libraries/utilities to handle ELF objects
      description: Elfutils is a collection of utilities, including eu-ld (a linker), eu-nm (for listing symbols from object files), eu-size (for listing the section sizes of an object or archive file), eu-strip (for discarding  symbols), eu-readelf (to see the raw ELF file structures), and eu-elflint (to check for well-formed ELF files).
      spdx: 'LGPL-3.0-or-later GPL-2.0-or-later GPL-3.0-or-later'
      website: 'https://sourceware.org/elfutils/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      url: 'https://sourceware.org/elfutils/ftp/0.189/elfutils-0.189.tar.bz2'
      format: 'tar.bz2'
      extract_path: 'elfutils-0.189'
      checksum: blake2b:30596271e14cf3408326abc38a9775b849b8cb0ee119a5455df9434a7d3b9a57afb15e0236a179a26c7bd400d303749964c9d6350c419f747784fd99d12517e0
      version: '0.189'
      patch-path-strip: 1
      tools_required:
        - host-autoconf-archive
        - host-autoconf-v2.71
        - host-automake-v1.16
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - bzip2
      - xz-utils
      - zlib
      - zstd
      - argp-standalone
      - fts-standalone
      - obstack-standalone
      - libintl
      - libiconv
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--build=x86_64-linux-gnu'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--program-prefix=eu-'
        - '--disable-debuginfod'
        - '--disable-libdebuginfod'
        - '--disable-valgrind'
        - '--with-bzlib'
        - '--with-lzma'
        - '--with-zstd'
        - '--with-zlib'
        - '--disable-nls'
        - '--enable-thread-safety'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: fribidi
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: A free implementation of the unicode bidirectional algorithm
      description: This package provides a library with an implementation of the Unicode Bidirectional Algorithm (BIDI). This is used for supporting Arabic and Hebrew alphabets in other packages.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://fribidi.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/fribidi/fribidi.git'
      tag: 'v1.0.13'
      version: '1.0.13'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          environ:
            'NOCONFIGURE': 'yes'
        - args: 'sed -i s/"SUBDIRS = gen.tab lib bin doc test"/"SUBDIRS = gen.tab lib bin test"/ @THIS_SOURCE_DIR@/Makefile.am'
    tools_required:
      - system-gcc
      - host-autoconf-v2.69
      - host-automake-v1.15
    pkgs_required:
      - mlibc
    revision: 6
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: glib
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: The GLib library of C routines
      description: This package contains low-level libraries useful for providing data structure handling for C, portability wrappers and interfaces for runtime functionality such as an event loop, threads, dynamic loading and an object system.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://www.gtk.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    from_source: glib
    tools_required:
      - system-gcc
      - host-libtool
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - pcre2
      - libffi
      - zlib
      - libiconv
      - libintl
    revision: 6
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - '-Dxattr=false'
        - '-Dtests=false'
        - '-Dinstalled_tests=false'
        - '@THIS_SOURCE_DIR@'
        isolate_network: false
        environ:
          PKG_CONFIG_SYSROOT_DIR: '@BUILD_ROOT@/system-root'
          PKG_CONFIG_LIBDIR: '@BUILD_ROOT@/system-root/usr/lib/pkgconfig:@BUILD_ROOT@/system-root/usr/share/pkgconfig'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
    scripts:
        post_install:
          - args: ['glib-compile-schemas /usr/share/glib-2.0/schemas']
          - args: ['gio-querymodules /usr/lib/gio/modules']

  - name: gmp
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library for arbitrary-precision arithmetic on different type of numbers
      description: The GMP package contains math libraries. These have useful functions for arbitrary precision arithmetic.
      spdx: 'LGPL-3.0-or-later'
      website: 'https://gmplib.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      hg: 'https://gmplib.org/repo/gmp-6.2/'
      tag: 'tip'
      version: '6.2.1'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['@THIS_SOURCE_DIR@/.bootstrap']
        - args: ['cp', '@THIS_SOURCE_DIR@/configfsf.guess', '@THIS_SOURCE_DIR@/config.guess']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 8
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--enable-cxx'
        - '--disable-static'
        - '--docdir=/usr/share/doc/gmp-6.2.1'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: gobject-introspection
    architecture: '@OPTION:arch@'
    metadata:
      summary: Introspection system for GObject-based libraries
      description: Introspection system for GObject-based libraries
      spdx: 'LGPL-2.0-or-later GPL-2.0-or-later'
      website: 'https://gi.readthedocs.io/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    from_source: gobject-introspection
    tools_required:
      - system-gcc
      - host-pkg-config
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - host-python
      - host-gobject-introspection
      - host-glib
      - host-mlibc
    pkgs_required:
      - mlibc
      - glib
      - libffi
      - cairo
      - pcre2
      - python
    revision: 3
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@-goi.cross-file'
        - '--prefix=/usr'
        - '-Dgi_cross_ldd_wrapper=ldd-wrapper'
        - '-Dgi_cross_use_prebuilt_gi=true'
        - '-Dbuild_introspection_data=true'
        - '-Dgi_cross_pkgconfig_sysroot_path=@SYSROOT_DIR@'
        - '@THIS_SOURCE_DIR@'
        environ:
          PKG_CONFIG_SYSROOT_DIR: '@BUILD_ROOT@/system-root'
          PKG_CONFIG_LIBDIR: '@BUILD_ROOT@/system-root/usr/lib/pkgconfig:@BUILD_ROOT@/system-root/usr/share/pkgconfig'
          RUN_WRAPPER_LD_LIBRARY_PATH: '@BUILD_ROOT@/tools/host-mlibc/lib:@SYSROOT_DIR@/usr/lib:@SYSROOT_DIR@/usr/lib64:@THIS_BUILD_DIR@/girepository'
          RUN_WRAPPER_INTERP: '@BUILD_ROOT@/tools/host-mlibc/lib/ld.so'
    build:
      - args: ['ninja']
        environ:
          CC: '@OPTION:arch-triple@-gcc'
          CXX: '@OPTION:arch-triple@-g++'
          GI_CROSS_LAUNCHER: 'run-wrapper'
          PKG_CONFIG_SYSROOT_DIR: '@BUILD_ROOT@/system-root'
          PKG_CONFIG_LIBDIR: '@BUILD_ROOT@/system-root/usr/lib/pkgconfig:@BUILD_ROOT@/system-root/usr/share/pkgconfig'
          LD_LIBRARY_PATH: '@BUILD_ROOT@/tools/host-glib/lib:@BUILD_ROOT@/tools/host-glib/lib/x86_64-linux-gnu:@BUILD_ROOT@/tools/host-gobject-introspection/lib/x86_64-linux-gnu'
          RUN_WRAPPER_LD_LIBRARY_PATH: '@BUILD_ROOT@/tools/host-mlibc/lib:@SYSROOT_DIR@/usr/lib:@SYSROOT_DIR@/usr/lib64:@THIS_BUILD_DIR@/girepository'
          RUN_WRAPPER_INTERP: '@BUILD_ROOT@/tools/host-mlibc/lib/ld.so'
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: icu
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: International Components for Unicode
      description: This package is a mature, widely used set of C/C++ libraries providing Unicode and Globalization support for software applications. ICU is widely portable and gives applications the same results on all platforms.
      spdx: 'BSD'
      website: 'https://icu.unicode.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    from_source: icu
    tools_required:
      - system-gcc
      - host-icu
    pkgs_required:
      - mlibc
    revision: 2
    configure:
      - args: ['cp',
          '@THIS_SOURCE_DIR@/icu4c/source/config/mh-linux',
          '@THIS_SOURCE_DIR@/icu4c/source/config/mh-unknown']
      - args:
        - '@THIS_SOURCE_DIR@/icu4c/source/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-cross-build=@BUILD_ROOT@/tool-builds/host-icu'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: json-c
    architecture: '@OPTION:arch@'
    metadata:
      summary: A JSON implementation in C
      description: This package implements a reference counting object model that allows you to easily construct JSON objects in C, output them as JSON formatted strings and parse JSON formatted strings back into the C representation of JSON objects.
      spdx: 'MIT'
      website: 'https://github.com/json-c/json-c/wiki'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://github.com/json-c/json-c.git'
      tag: 'json-c-0.16-20220414'
      version: '0.16'
    tools_required:
      - system-gcc
      - host-cmake
    pkgs_required:
      - mlibc
    revision: 9
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libevdev
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Handler library for evdev events
      description: This package contains common functions for Xorg input drivers.
      spdx: 'MIT'
      website: 'https://www.freedesktop.org/wiki/Software/libevdev/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/libevdev/libevdev.git'
      tag: 'libevdev-1.13.1'
      version: '1.13.1'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          environ:
            'NOCONFIGURE': 'yes'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 6
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libevent
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library to execute a function when a specific event occurs on a file descriptor
      description: This package provides a library for asynchronous event notification.
      spdx: 'BSD-3-Clause'
      website: 'https://github.com/libevent/libevent'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://github.com/libevent/libevent.git'
      tag: 'release-2.1.12-stable'
      version: '2.1.12'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
        # Fix an issue that prevents event_rpcgen.py from working.
        - args: ['sed', '-i', 's/python/&3/', '@THIS_SOURCE_DIR@/event_rpcgen.py']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - openssl
      - zlib
    revision: 9
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libexpat
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Stream-oriented XML parser library
      description: This package contains a stream oriented C library for parsing XML.
      spdx: 'MIT'
      website: 'https://libexpat.github.io/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/libexpat/libexpat.git'
      tag: 'R_2_5_0'
      version: '2.5.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['./buildconf.sh']
          workdir: '@THIS_SOURCE_DIR@/expat'
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
      - host-libtool
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 6
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/expat/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        # We disable xmlwf to avoid building its documentation.
        - '--without-xmlwf'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libffi
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    from_source: libffi
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 5
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libgcrypt
    architecture: '@OPTION:arch@'
    metadata:
      summary: General purpose crypto library based on the code used in GnuPG
      description: This package contains a general purpose crypto library based on the code used in GnuPG. The library provides a high level interface to cryptographic building blocks using an extendable and flexible API.
      spdx: 'LGPL-2.0-only'
      website: 'https://www.gnupg.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://dev.gnupg.org/source/libgcrypt.git'
      tag: 'libgcrypt-1.10.3'
      version: '1.10.3'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['./autogen.sh']
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - libgpg-error
    revision: 5
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--enable-shared'
        - '--disable-static'
        - '--prefix=/usr'
        - '--disable-nls'
        - '--disable-doc'
        - '--disable-dev-random'
        - '--with-libgpg-error-prefix=@SYSROOT_DIR@/usr'
        - '--disable-asm'
        environ:
          LIBS: '-lgpg-error'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libgee
    architecture: '@OPTION:arch@'
    metadata:
      summary: GObject-based interfaces and classes for commonly used data structures
      description: This package provides acollection library providing GObject based interfaces and classes for commonly used data structures.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://wiki.gnome.org/Projects/Libgee'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      url: 'http://ftp.gnome.org/pub/gnome/sources/libgee/0.20/libgee-0.20.6.tar.xz'
      format: 'tar.xz'
      checksum: 'blake2b:cdb88719e0e1bceccefd6a824823e6e514bf1f4d6b8cf5330d6d83f781649312b23554c7dfc4a6b4eeb3bbcd81ca42843666d596b85634ff95fc90e90fea44bd'
      extract_path: 'libgee-0.20.6'
      version: '0.20.6'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
      - host-vala
    pkgs_required:
      - mlibc
      - glib
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--enable-vala=yes'
        - !managarm::arch_ite
          arch: [x86_64]
          # Disabled on all architectures for now
          then: '--enable-introspection=no'
          else: '--enable-introspection=no'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  # Updating to 1.47 broke libgcrypt, must be investigated
  - name: libgpg-error
    architecture: '@OPTION:arch@'
    metadata:
      summary: Contains error handling functions used by GnuPG software
      description: This package contains a library that defines common error values for all GnuPG components.
      spdx: 'LGPL-2.1-only'
      website: 'https://www.gnupg.org/related_software/libgpg-error'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://dev.gnupg.org/source/libgpg-error.git'
      tag: 'libgpg-error-1.45'
      version: '1.45'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['./autogen.sh']
        - args: ['autoreconf', '-f', '-v', '-i']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 8
    configure:
      # libgpg-error does not know about managarm, teach it
      - args: ['cp', '-v', '@THIS_SOURCE_DIR@/src/syscfg/lock-obj-pub.x86_64-unknown-linux-gnu.h',
          '@THIS_SOURCE_DIR@/src/syscfg/lock-obj-pub.managarm-mlibc.h']
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-nls'
        - '--disable-doc'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libiconv
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://git.savannah.gnu.org/git/libiconv.git'
      tag: 'v1.17'
      version: '1.17'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
        - host-autoconf-archive
        - host-gettext
      regenerate:
        - args: ['./gitsub.sh', 'pull']
        # Checkout current gnulib master, 044bf893acee0a55b22b4be0ede0e3ce010c480a, 29-08-2022.
        # This avoids random breakage in the future
          isolate_network: false
        - args: ['git', 'checkout', '044bf893acee0a55b22b4be0ede0e3ce010c480a']
          workdir: '@THIS_SOURCE_DIR@/gnulib'
        - args: ['./autogen.sh']
          environ:
            'NOCONFIGURE': 'yes'
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/build-aux/']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/libcharset/build-aux/']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-libtool/share/aclocal/libtool.m4',
            '@THIS_SOURCE_DIR@/m4/']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-libtool/share/aclocal/libtool.m4',
            '@THIS_SOURCE_DIR@/libcharset/m4/']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-libtool/share/libtool/build-aux/ltmain.sh',
            '@THIS_SOURCE_DIR@/libcharset/build-aux/']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-libtool/share/libtool/build-aux/ltmain.sh',
            '@THIS_SOURCE_DIR@/build-aux/']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-libtool/share/aclocal/ltversion.m4',
            '@THIS_SOURCE_DIR@/m4/']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-libtool/share/aclocal/ltversion.m4',
            '@THIS_SOURCE_DIR@/libcharset/m4/']
        - args: ['autoreconf', '-fvi', '-I@THIS_SOURCE_DIR@/m4', '-I@THIS_SOURCE_DIR@/srcm4']
    tools_required:
      - system-gcc
      - host-libtool
    pkgs_required:
      - mlibc
    revision: 7
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        - '--disable-nls'
        - '--enable-shared'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libinput
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/libinput/libinput.git'
      tag: '1.24.0'
      version: '1.24.0'
    tools_required:
      - host-pkg-config
      - system-gcc
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - eudev
      - libevdev
      - mtdev
    revision: 5
    configure:
      - args:
          - 'meson'
          - 'setup'
          - '--cross-file'
          - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
          - '--prefix=/usr'
          - '--libdir=lib'
          - '--buildtype=debugoptimized'
          - '-Dlibwacom=false'
          - '-Ddebug-gui=false'
          - '-Dtests=false'
          - '-Ddocumentation=false'
          - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libintl
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      url: 'https://ftp.gnu.org/gnu/gettext/gettext-0.21.tar.xz'
      format: 'tar.xz'
      checksum: blake2b:e36418323c79f582d13777083b455ae76ccb29e41a8259a2f4d6d9f5d8e2ac7c8ecc4df1b1fa2e9838c819cb27345fe254772398bdb88b3315410866048f755a
      extract_path: 'gettext-0.21'
      version: '0.21'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - libiconv
    revision: 9
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--without-emacs'
        - '--without-lispdir'
        # Normally this controls nls behavior in general, but the libintl
        # subdir is skipped unless this is explicitly set.
        - '--enable-nls'
        # This magic flag enables libintl.
        - '--with-included-gettext'
        - '--disable-c++'
        - '--disable-libasprintf'
        - '--disable-java'
        - '--enable-shared'
        - '--disable-static'
        - '--enable-threads=posix'
        - '--disable-curses'
        - '--without-git'
        - '--without-cvs'
        - '--without-bzip2'
        - '--without-xz'
    build:
      - args: ['make', '-C', 'gettext-runtime/intl', '-j@PARALLELISM@']
      - args: ['make', '-C', 'gettext-runtime/intl', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libtool
    architecture: '@OPTION:arch@'
    metadata:
      summary: A shared library tool for developers
      description: This package provides a shared library tool for developers.
      spdx: 'GPL-2.0-only'
      website: 'https://www.gnu.org/software/libtool/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    from_source: libtool
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--enable-ltdl-install'
        - '--enable-shared'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libmnl
    architecture: '@OPTION:arch@'
    labels: [aarch64, riscv64]
    metadata:
      summary: libmnl is a minimalistic user-space library oriented to Netlink developers
      description: There are a lot of common tasks in parsing, validating, constructing of both the Netlink header and TLVs that are repetitive and easy to get wrong. This library aims to provide simple helpers that allows you to re-use code and to avoid re-inventing the wheel.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://www.netfilter.org/projects/libmnl/'
      maintainer: 'no92 <leo@managarm.org>'
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'git://git.netfilter.org/libmnl.git'
      tag: 'libmnl-1.0.5'
      version: '1.0.5'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--sysconfdir=/etc'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libnl
    architecture: '@OPTION:arch@'
    metadata:
      summary: Libraries providing APIs to netlink protocol based Linux kernel interfaces
      description: The libnl suite is a collection of libraries providing APIs to netlink protocol based Linux kernel interfaces.
      spdx: 'LGPL-2.1-only'
      website: 'https://www.infradead.org/~tgr/libnl/'
      maintainer: 'Dennis Bonke <dennis@managarm.org>'
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/thom311/libnl.git'
      tag: 'libnl3_11_0'
      version: '3.11.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 3
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--sysconfdir=/etc'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  # The mirroring task doesn't respect stability_level, comment out the port for now.
  #- name: libotf
  #  stability_level: 'broken' # Apparently salsa.debian.org is returning 403.
  #  source:
  #    subdir: ports
  #    git: 'https://salsa.debian.org/debian/libotf.git'
  #    branch: 'master'
  #    commit: '85af96e78b5ba551d98eb994f010e737ee044b94'
  #    version: '0.9.16'
  #    tools_required:
  #      - host-autoconf-v2.69
  #      - host-automake-v1.15
  #      - host-libtool
  #      - host-pkg-config
  #    regenerate:
  #      - args: ['./autogen.sh']
  #      - args: ['cp',
  #          '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
  #          '@THIS_SOURCE_DIR@/']
  #  tools_required:
  #    - system-gcc
  #    - host-autoconf-v2.69
  #  pkgs_required:
  #    - mlibc
  #    - freetype
  #  revision: 3
  #  configure:
  #    - args:
  #      - '@THIS_SOURCE_DIR@/configure'
  #      - '--host=@OPTION:arch-triple@'
  #      - '--prefix=/usr'
  #      - '--disable-static'
  #      - '--docdir=/usr/share/doc/libotf-0.9.16'
  #  build:
  #    - args: ['make', '-j@PARALLELISM@']
  #    - args: ['make', 'install']
  #      environ:
  #        DESTDIR: '@THIS_COLLECT_DIR@'
  #      quiet: true

  - name: libpipeline
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: A pipeline manipulation library
      description: This package provides a library for manipulating pipelines of subprocesses in a flexible and convenient way.
      spdx: 'GPL-3.0-only'
      website: 'https://libpipeline.nongnu.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://gitlab.com/cjwatson/libpipeline.git'
      tag: '1.5.7'
      version: '1.5.7'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-pkg-config
        - host-libtool
      regenerate:
        - args: ['./bootstrap']
          isolate_network: false
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/build-aux/']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 6
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libqtxdg
    architecture: '@OPTION:arch@'
    metadata:
      summary: Qt implementation of freedesktop.org xdg specs
      description: This package provides a Qt implementation of freedesktop.org xdg specs.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://lxqt-project.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://github.com/lxqt/libqtxdg.git'
      tag: '4.0.0'
      version: '4.0.0'
    tools_required:
      - host-cmake
      - system-gcc
      - host-lxqt-build-tools
      - host-qt6
    pkgs_required:
      - mlibc
      - glib
      - qtbase6
      - qtsvg6
    revision: 1
    configure:
      - args:
        - 'cmake'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DQT_HOST_PATH=@BUILD_ROOT@/tools/host-qt6'
        - '-DCMAKE_BUILD_TYPE=Debug'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DBUILD_SHARED_LIBS=ON'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libtasn
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: ASN.1 library
      description: This package provides a highly portable C library that encodes and decodes DER/BER data following an ASN.1 schema.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://www.gnu.org/software/libtasn1/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://gitlab.com/gnutls/libtasn1.git'
      tag: 'v4.19.0'
      version: '4.19.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-pkg-config
        - host-libtool
      regenerate:
        - args: ['./bootstrap']
          isolate_network: false
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/build-aux/']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 6
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--disable-doc'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libunistring
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library for manipulating Unicode and C strings according to Unicode standard
      description: This package provides a library containing functions for manipulating Unicode strings and for manipulating C strings according to the Unicode standard.
      spdx: 'LGPL-3.0-or-later'
      website: 'https://www.gnu.org/software/libunistring/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      url: 'https://ftp.gnu.org/gnu/libunistring/libunistring-1.1.tar.xz'
      format: 'tar.xz'
      checksum: blake2b:721adc90884006480055b95d0fa06cd862417aa02b467f1e14688292ad9c11f1e33520b14ed5dc2d2724c6df8713d3af1e8032014259d8355156cb72edfcb983
      extract_path: 'libunistring-1.1'
      version: '1.1'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
      - args: ['autoreconf', '-fvi']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 6
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        - '--disable-static'
        - '--docdir=/usr/share/doc/libunistring-1.1'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libusb
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library for interacting with USB devices
      description: This package provides a library used by some applications for USB device access.
      spdx: 'LGPL-2.1-only'
      website: 'https://github.com/libusb/libusb'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      url: 'https://github.com/libusb/libusb/releases/download/v1.0.26/libusb-1.0.26.tar.bz2'
      format: 'tar.bz2'
      checksum: blake2b:0cc397ecf4de0066abbff9b286a9e4fcd48658698d5e0d6b736abf56b48c1b55a05f15fff7be53fd33f767621e0c25d87275a47e05a4bcb44c4b8ac9221cd081
      extract_path: 'libusb-1.0.26'
      version: '1.0.26'
      patch-path-strip: 1
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-pkg-config
        - host-libtool
      regenerate:
        - args: ['autoreconf', '-fvi']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - eudev
    revision: 7
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--enable-shared'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libuv
    architecture: '@OPTION:arch@'
    source:
      subdir: ports
      git: 'https://github.com/libuv/libuv.git'
      tag: 'v1.42.0'
      version: '1.42.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-pkg-config
        - host-libtool
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 10
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libxml
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: ports
      git: 'https://gitlab.gnome.org/GNOME/libxml2.git'
      tag: 'v2.10.0'
      version: '2.10.0'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
          environ:
            'NOCONFIGURE': 'yes'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - zlib
      - libiconv
    revision: 7
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--without-python'
        - '--disable-static'
        - '--with-threads'
        - '--disable-ipv6'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libxmlb
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library to help create and query binary XML blobs
      description: This package provides a library and a tool which help create and query binary XML blobs.
      spdx: 'LGPL-2.1-or-later'
      website: 'https://github.com/hughsie/libxmlb'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/hughsie/libxmlb.git'
      tag: '0.3.15'
      version: '0.3.15'
    tools_required:
      - system-gcc
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - glib
      - xz-utils
      - zstd
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--buildtype=release'
        - '-Dgtkdoc=false'
        - !managarm::arch_ite
          arch: [x86_64]
          # Disabled on all architectures for now
          then: '-Dintrospection=false'
          else: '-Dintrospection=false'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: libxslt
    architecture: '@OPTION:arch@'
    source:
      subdir: ports
      git: 'https://gitlab.gnome.org/GNOME/libxslt.git'
      tag: 'v1.1.38'
      version: '1.1.38'
    tools_required:
      - system-gcc
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - host-cmake
    pkgs_required:
      - mlibc
      - libxml
    revision: 5
    configure:
      # BLFS increases the recursion limit, apparently some packages need that to build their documentation.
      - args: ['sed', '-i', 's/3000/5000/', '@THIS_SOURCE_DIR@/libxslt/transform.c']
      - args: ['sed', '-i', 's/3000/5000/', '@THIS_SOURCE_DIR@/doc/xsltproc.1']
      - args: ['sed', '-i', 's/3000/5000/', '@THIS_SOURCE_DIR@/doc/xsltproc.xml']
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_PREFIX_PATH=/usr'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DCMAKE_SYSTEM_PROCESSOR=@OPTION:arch@'
        - '-DLIBXSLT_WITH_DEBUGGER=OFF'
        - '-DLIBXSLT_WITH_CRYPTO=OFF'
        - '-DLIBXSLT_WITH_MEM_DEBUG=OFF'
        - '-DLIBXSLT_WITH_MODULES=ON'
        - '-DLIBXSLT_WITH_PROFILER=OFF'
        - '-DLIBXSLT_WITH_PYTHON=OFF'
        - '-DLIBXSLT_WITH_XSLT_DEBUG=OFF'
        - '-DLIBXSLT_WITH_TESTS=OFF'
        - '-DLIBXSLT_WITH_THREADS=ON'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: libyaml
    architecture: '@OPTION:arch@'
    metadata:
      summary: YAML 1.1 parser and emitter written in C
      description: This package contains a C library for parsing and emitting YAML (YAML Ain't Markup Language) code.
      spdx: 'MIT'
      website: 'https://github.com/yaml/libyaml'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://github.com/yaml/libyaml.git'
      tag: '0.2.5'
      version: '0.2.5'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['autoreconf', '-f', '-i']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: mpc
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: A library for multiprecision complex arithmetic with exact rounding
      description: The MPC package contains a library for the arithmetic of complex numbers with arbitrarily high precision and correct rounding of the result.
      spdx: 'LGPL-3.0-or-later'
      website: 'https://www.multiprecision.org/mpc/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://gitlab.inria.fr/mpc/mpc.git'
      tag: '1.3.1'
      version: '1.3.1'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['autoreconf', '-f', '-i']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - gmp
      - mpfr
    revision: 4
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--docdir=/usr/share/doc/mpc-1.3.1'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: mpfr
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Library for multiple-precision floating-point computations with exact rounding
      description: The MPFR package contains functions for multiple precision math.
      spdx: 'LGPL-3.0-or-later'
      website: 'https://www.mpfr.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      url: 'https://ftp.gnu.org/gnu/mpfr/mpfr-4.2.1.tar.xz'
      format: 'tar.xz'
      checksum: blake2b:ad69f53bc910294647523e7613b18a683f1d0f3dd994168ab2a46b66d0371ffa9b8e7cb59495f898470aea69d343e83fc722f11babe4af7b3a12665a1e65860c
      extract_path: 'mpfr-4.2.1'
      version: '4.2.1'
      tools_required:
        - host-autoconf-archive
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['autoreconf', '-v', '-f', '-i', '--warnings=all,error']
    tools_required:
      - host-autoconf-archive
      - host-autoconf-v2.69
      - host-automake-v1.15
      - host-libtool
      - system-gcc
      - host-libtool
    pkgs_required:
      - mlibc
      - gmp
    revision: 5
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--enable-static=no'
        - '--enable-shared=yes'
        - '--docdir=/usr/share/doc/mpfr-4.2.1'
        - '--with-pic'
        environ:
          # MPFR's configuration script misdetects cross-compilations. Hence,
          # set one of its internal variables to force it into the cross compilation path.
          'user_redefine_cc': 'yes'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: nettle
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://git.lysator.liu.se/nettle/nettle.git'
      tag: 'nettle_3.8.1_release_20220727'
      version: '3.8.1'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['./.bootstrap']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/']
    tools_required:
      - system-gcc
      - host-autoconf-v2.69
      - host-automake-v1.15
    pkgs_required:
      - mlibc
      - gmp
    revision: 7
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--disable-documentation'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: nspr
    architecture: '@OPTION:arch@'
    metadata:
      summary: Netscape Portable Runtime (NSPR)
      description: This package provides a platform-neutral API for system level and libc like functions.
      spdx: 'MPL-2.0 GPL-2.0-only LGPL-2.1-only'
      website: 'https://www.mozilla.org/projects/nspr/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      hg: 'https://hg.mozilla.org/projects/nspr/'
      tag: 'NSPR_4_36_RTM'
      version: '4.36'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['autoreconf', '-fvi']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/build/autoconf/']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      # Disable installing two unneeded scripts.
      - args: ['sed', '-ri', '/^RELEASE/s/^/#/', '@THIS_SOURCE_DIR@/pr/src/misc/Makefile.in']
      # Disable installing static libraries.
      - args: ['sed', '-i', 's#$(LIBRARY) ##', '@THIS_SOURCE_DIR@/config/rules.mk']
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=x86_64-linux'
        - '--build=x86_64-linux'
        - '--prefix=/usr'
        - '--with-mozilla'
        - '--with-pthreads'
        - '--enable-64bit'
        environ:
          CROSS_COMPILE: '1'
          ac_cv_func_syscall: 'no'
    build:
      # We first build a native nsinstall that the build can use later on.
      - args: ['make', 'CC=gcc', 'CXX=g++', '-C', '@THIS_BUILD_DIR@/config/']
      - args: ['mv', '-v', '@THIS_BUILD_DIR@/config/nsinstall', '@THIS_BUILD_DIR@/config/native-nsinstall']
      - args: ['sed', '-s', 's#/nsinstall$#/native-nsinstall#', '-i', '@THIS_BUILD_DIR@/config/autoconf.mk']
      - args: ['rm', '-v', '@THIS_BUILD_DIR@/config/nsinstall.o']
      # Then build the real deal
      - args: ['make', 'CC=x86_64-managarm-gcc', 'CXX=x86_64-managarm-g++', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: nss
    architecture: '@OPTION:arch@'
    metadata:
      summary: Mozilla's Network Security Services library that implements PKI support
      description: This package provides a set of libraries designed to support cross-platform development of security-enabled client and server applications.
      spdx: 'MPL-2.0 GPL-2.0-only LGPL-2.1-only'
      website: 'https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    from_source: nss
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - nspr
      - sqlite
      - zlib
    revision: 1
    configure:
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      # First, build a host version of nsinstall.
      - args: ['make', '-C', '@THIS_BUILD_DIR@/coreconf/']
        environ:
          CC: 'gcc'
          BUILD_OPT: '1'
          NSPR_INCLUDE_DIR: '/usr/include/nspr'
          USE_SYSTEM_ZLIB: '1'
          ZLIB_LIBS: '-lz'
          NSS_ENABLE_WERROR: '0'
          USE_64: '1'
          NSS_USE_SYSTEM_SQLITE: '1'
          NS_USE_GCC: '1'
          CC_IS_GCC: '1'
          NSDISTMODE: 'copy'
      # Then, build some configuration items courtesy of BLFS (see the patches).
      - args: |
            make V=1 -C @THIS_BUILD_DIR@/config NSINSTALL=@THIS_BUILD_DIR@/$(find -type f -name nsinstall) -j1
        environ:
          # Optimized builds.
          BUILD_OPT: '1'
          # NSPR is here.
          NSPR_INCLUDE_DIR: '@SYSROOT_DIR@/usr/include/nspr'
          # Use our zlib.
          USE_SYSTEM_ZLIB: '1'
          # Freestanding freebl yes please.
          FREEBL_NO_DEPEND: '1'
          FREEBL_LOWHASH: '1'
          NSS_SEED_ONLY_DEV_URANDOM: '1'
          # Link with zlib.
          ZLIB_LIBS: '-lz'
          # Do not enable Werror.
          NSS_ENABLE_WERROR: '0'
          # We are 64 bit.
          USE_64: '1'
          # Use system sqlite.
          NSS_USE_SYSTEM_SQLITE: '1'
          # We're using gcc.
          NS_USE_GCC: '1'
          CC_IS_GCC: '1'
          # We're cross compiling.
          CROSS_COMPILE: '1'
          # Don't symlink files, copy them.
          NSDISTMODE: 'copy'
          # Do not build the tests.
          NSS_DISABLE_GTESTS: '1'
          # Put the libs and binaries here.
          SOURCE_PREFIX: '@THIS_BUILD_DIR@/dist'
          # Specify the compiler.
          CC: 'x86_64-managarm-gcc'
          CXX: 'x86_64-managarm-g++'
      # Then build the main libraries and binaries.
      - args: |
            make V=1 -C @THIS_BUILD_DIR@/. NSINSTALL=@THIS_BUILD_DIR@/$(find -type f -name nsinstall) -j1
        environ:
          BUILD_OPT: '1'
          NSPR_INCLUDE_DIR: '@SYSROOT_DIR@/usr/include/nspr'
          USE_SYSTEM_ZLIB: '1'
          FREEBL_NO_DEPEND: '1'
          FREEBL_LOWHASH: '1'
          NSS_SEED_ONLY_DEV_URANDOM: '1'
          ZLIB_LIBS: '-lz'
          NSS_ENABLE_WERROR: '0'
          USE_64: '1'
          NSS_USE_SYSTEM_SQLITE: '1'
          NS_USE_GCC: '1'
          CC_IS_GCC: '1'
          CROSS_COMPILE: '1'
          NSDISTMODE: 'copy'
          NSS_DISABLE_GTESTS: '1'
          SOURCE_PREFIX: '@THIS_BUILD_DIR@/dist'
          CC: 'x86_64-managarm-gcc'
          CXX: 'x86_64-managarm-g++'
      # Create some directories to install into.
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/usr/lib/pkgconfig']
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/usr/bin']
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/usr/include']
      # And install everything, this _will_ break on a non Linux box, but unfortunately NSS hardcodes kernel names and versions.
      # If someone wants to patch NSS to not do that, greatly appreciated.
      # These install instructions are adapted from BLFS, and not Gentoo as I usually do.
      - args: |
            cd dist
            install -v -m755 Linux*/lib/*.so @THIS_COLLECT_DIR@/usr/lib
            install -v -m644 Linux*/lib/{*.chk,libcrmf.a} @THIS_COLLECT_DIR@/usr/lib
            install -v -m755 -d @THIS_COLLECT_DIR@/usr/include/nss
            cp -v -RL {public,private}/nss/* @THIS_COLLECT_DIR@/usr/include/nss
            chmod -v 644 @THIS_COLLECT_DIR@/usr/include/nss/*
            install -v -m755 Linux*/bin/{certutil,nss-config,pk12util} @THIS_COLLECT_DIR@/usr/bin
            install -v -m644 Linux*/lib/pkgconfig/nss.pc @THIS_COLLECT_DIR@/usr/lib/pkgconfig

  - name: openssl
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: ports
      git: 'https://github.com/openssl/openssl.git'
      tag: 'OpenSSL_1_1_1q'
      version: '1.1.1q'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - zlib
    revision: 8
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/Configure'
        - '--prefix=/usr'
        - '--openssldir=/etc/ssl'
        - '--libdir=lib'
        - '@OPTION:arch-triple@'
        - 'shared'
        - 'zlib-dynamic'
        - 'no-afalgeng'
        environ:
          CC: '@OPTION:arch-triple@-gcc'
          CXX: '@OPTION:arch-triple@-g++'
    build:
      - args: ['make', '-j@PARALLELISM@']
      # Disable installing static libraries
      - args: ['sed', '-i', '/INSTALL_LIBS/s/libcrypto.a libssl.a//', '@THIS_BUILD_DIR@/Makefile']
      # Suffix all man pages with ssl
      - args: ['make', 'DESTDIR=@THIS_COLLECT_DIR@', 'MANSUFFIX=ssl', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
      # Move the doc dir to a versioned directory
      - args: ['mv', '@THIS_COLLECT_DIR@/usr/share/doc/openssl', '@THIS_COLLECT_DIR@/usr/share/doc/openssl-1.1.1q']
      # Install more documentation
      - args: ['cp', '-fr', '@THIS_SOURCE_DIR@/doc/.', '@THIS_COLLECT_DIR@/usr/share/doc/openssl-1.1.1q']

  - name: pcre
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: ports
      # Use a git mirror as pcre retired their svn repositories
      git: 'https://github.com/vinix-os/pcre'
      tag: '1767'
      # Seems to be 8.45?
      version: '8.45'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
        - host-autoconf-archive
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
      - host-autoconf-v2.69
      - host-automake-v1.15
    pkgs_required:
      - mlibc
    revision: 10
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        - '--enable-unicode-properties'
        - '--enable-pcre8'
        - '--enable-pcre16'
        - '--enable-pcre32'
        - '--disable-static'
        environ:
          PKG_CONFIG_SYSROOT_DIR: '@BUILD_ROOT@/system-root'
          PKG_CONFIG_LIBDIR: '@BUILD_ROOT@/system-root/usr/lib/pkgconfig:@BUILD_ROOT@/system-root/usr/share/pkgconfig'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'DESTDIR=@THIS_COLLECT_DIR@', 'install']

  - name: pcre2
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Perl-compatible regular expression library
      description: This package contains a new generation of the Perl Compatible Regular Expression libraries. These are useful for implementing regular expression pattern matching using the same syntax and semantics as Perl.
      spdx: 'BSD-3-Clause'
      website: 'https://www.pcre.org/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: ports
      git: 'https://github.com/PhilipHazel/pcre2.git'
      tag: 'pcre2-10.44'
      version: '10.44'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - bzip2
      - ncurses
      - readline
      - zlib
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        - '--docdir=/usr/share/doc/pcre2-10.44'
        - '--enable-unicode'
        - '--enable-jit'
        - '--enable-pcre2-16'
        - '--enable-pcre2-32'
        - '--enable-pcre2grep-libz'
        - '--enable-pcre2grep-libbz2'
        - '--enable-pcre2test-libreadline'
        - '--disable-static'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: plasma-wayland-protocols
    architecture: '@OPTION:arch@'
    metadata:
      summary: Plasma Specific Protocols for Wayland
      description: This package provides the Plasma Specific Protocols for Wayland
      spdx: 'LGPL-2.1-only'
      website: 'https://invent.kde.org/libraries/plasma-wayland-protocols'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/KDE/plasma-wayland-protocols.git'
      tag: 'v1.13.0'
      version: '1.13.0'
    tools_required:
      - system-gcc
      - wayland-scanner
      - host-cmake
      - host-ecm
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DECM_DIR=@BUILD_ROOT@/tools/host-ecm'
        - '-DCMAKE_BUILD_TYPE=Debug'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: popt
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://github.com/rpm-software-management/popt.git'
      tag: 'popt-1.19-release'
      version: '1.19'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - libiconv
    revision: 5
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--disable-nls'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: wayland-protocols
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      url: 'https://gitlab.freedesktop.org/wayland/wayland-protocols/-/releases/1.32/downloads/wayland-protocols-1.32.tar.xz'
      checksum: 'blake2b:80e38270526c9da13c39263a60e7d2c330a1a4b1dfecec03fadda747f1a2e3dff95b30373aa19e133ae999fa15bdcdd64aa9ebbb54acf571f980a3f6088ea9be'
      extract_path: 'wayland-protocols-1.32'
      format: 'tar.xz'
      version: '1.32'
    tools_required:
      - system-gcc
      - wayland-scanner
    revision: 5
    configure:
      - args:
        - 'meson'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--buildtype=release'
        - '-Dtests=false'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: weston
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: 'A lightweight and functional Wayland compositor'
      description: 'Weston is a Wayland compositor designed for correctness, reliability, predictability, and performance. Out of the box, Weston provides a very basic desktop, or a full-featured environment for non-desktop uses such as automotive, embedded, in-flight, industrial, kiosks, set-top boxes and TVs.'
      spdx: 'MIT'
      website: 'https://gitlab.freedesktop.org/wayland/weston'
      maintainer: "no92 <leo@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://gitlab.freedesktop.org/wayland/weston.git'
      tag: '12.0.2'
      version: '12.0.2'
    tools_required:
      - host-pkg-config
      - system-gcc
      - wayland-scanner
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - virtual: pkgconfig-for-host
        program_name: host-pkg-config
    pkgs_required:
      - mlibc
      - cairo
      - libinput
      - libxkbcommon
      - mesa
      - wayland
      - wayland-protocols
      - dejavu
      - libxcursor
      - xwayland
      - pango
      - glib
      - libjpeg-turbo
      - seatd
      - xcb-proto
      - xcb-util-cursor
    revision: 5
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--native-file'
        - '@SOURCE_ROOT@/scripts/meson.native-file'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--libdir=lib'
        - '--buildtype=debugoptimized'
        - '-Dbackend-x11=false'
        - '-Dsimple-clients=damage,im,egl,shm,touch'
        - '-Dimage-jpeg=true'
        - '-Dimage-webp=false'
        - '-Dbackend-drm-screencast-vaapi=false'
        - '-Dbackend-rdp=false'
        - '-Dbackend-vnc=false'
        - '-Dbackend-pipewire=false'
        - '-Dcolor-management-lcms=false'
        - '-Dsystemd=false'
        - '-Dremoting=false'
        - '-Dpipewire=false'
        - '@THIS_SOURCE_DIR@'
        environ:
          PKG_CONFIG_SYSROOT_DIR: '@BUILD_ROOT@/system-root'
          PKG_CONFIG_LIBDIR: '@BUILD_ROOT@/system-root/usr/lib/pkgconfig:@BUILD_ROOT@/system-root/usr/share/pkgconfig'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: xxhash
    architecture: '@OPTION:arch@'
    source:
      subdir: 'ports'
      git: 'https://github.com/Cyan4973/xxHash.git'
      tag: 'v0.8.0'
      version: '0.8.0'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 9
    configure:
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['make', '-j@PARALLELISM@']
        environ:
          PREFIX: '/usr'
          LIBDIR: '/usr/lib'
          CC: '@OPTION:arch-triple@-gcc'
          AR: '@OPTION:arch-triple@-ar'
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
          PREFIX: '/usr'
          LIBDIR: '/usr/lib'
          MANDIR: '/usr/share/man/man1'
      - args: ['rm', '-v', '@THIS_COLLECT_DIR@/usr/lib/libxxhash.a']

  - name: libtsm
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    metadata:
      summary: Terminal emulator state machine
      description: LibTSM provides a state machine for DEC VT100-VT520 compatible terminal emulators.
      spdx: 'MIT'
      website: 'https://github.com/Aetf/libtsm'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/Aetf/libtsm.git'
      tag: 'v4.0.2'
      version: '4.0.2'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - libxkbcommon
    revision: 6
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DCMAKE_BUILD_TYPE=Release'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: wayland
    labels: [aarch64, riscv64]
    architecture: '@OPTION:arch@'
    from_source: wayland
    tools_required:
      - host-pkg-config
      - system-gcc
      - wayland-scanner
      - host-libtool
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
      - virtual: pkgconfig-for-host
        program_name: host-pkg-config
    pkgs_required:
      - mlibc
      - libexpat
      - libffi
    revision: 7
    configure:
      - args:
        - 'meson'
        - '--native-file'
        - '@SOURCE_ROOT@/scripts/meson.native-file'
        - '--cross-file'
        - '@SOURCE_ROOT@/scripts/meson-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--buildtype=debugoptimized'
        - '-Ddtd_validation=false'
        - '-Ddocumentation=false'
        - '-Dscanner=true'
        - '@THIS_SOURCE_DIR@'
        environ:
          PKG_CONFIG_SYSROOT_DIR: '@BUILD_ROOT@/system-root'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: boost
    labels: [aarch64, riscv64]
    architecture: noarch
    metadata:
      summary: Boost development headers
      description: This package provides the Boost headers for C++.
      spdx: 'BSL-1.0'
      website: 'https://boost.org'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['dev-libs']
    source:
      subdir: 'ports'
      git: 'https://github.com/boostorg/boost.git'
      tag: 'boost-1.62.0'
      version: '1.62.0'
      regenerate:
        - args: |
            if ! git -C '@THIS_SOURCE_DIR@' remote | grep -q origin; then
              git -C '@THIS_SOURCE_DIR@' remote add origin https://github.com/boostorg/boost.git
            fi
        - args: ['git', '-C', '@THIS_SOURCE_DIR@', 'submodule', 'update', '--init']
          isolate_network: false
        - args: ['./bootstrap.sh']
        - args: ['./b2', 'headers']
    revision: 7
    configure: []
    build:
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/usr/include']
      - args: ['cp', '-r', '--dereference', '@THIS_SOURCE_DIR@/boost',
            '@THIS_COLLECT_DIR@/usr/include']
