From 2a2a01021fd643d46391c0659848590f21b06e74 Mon Sep 17 00:00:00 2001
From: Dennis Bonke <admin@dennisbonke.com>
Date: Wed, 12 Nov 2025 21:05:16 +0100
Subject: [PATCH] Add Managarm support

---
 src/closures.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/closures.c b/src/closures.c
index 02cf78f..ffc30c9 100644
--- a/src/closures.c
+++ b/src/closures.c
@@ -27,7 +27,7 @@
    DEALINGS IN THE SOFTWARE.
    ----------------------------------------------------------------------- */
 
-#if (defined __linux__ || defined __CYGWIN__) && !defined _GNU_SOURCE
+#if (defined __linux__ || defined __CYGWIN__ || defined __mlibc__) && !defined _GNU_SOURCE
 #define _GNU_SOURCE 1
 #endif
 
@@ -141,6 +141,9 @@ ffi_tramp_is_present (__attribute__((unused)) void *ptr)
    executable memory. */
 #  define FFI_MMAP_EXEC_WRIT 1
 # endif
+#if defined(__managarm__)
+#  define FFI_MMAP_EXEC_WRIT 1
+#endif
 #endif
 
 #if FFI_MMAP_EXEC_WRIT && defined(__linux__) && !defined(__ANDROID__)
-- 
2.52.0

