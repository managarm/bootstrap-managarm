From 2f94d1a54e0985dbda7f7ab6663095e2a9903a32 Mon Sep 17 00:00:00 2001
From: no92 <no92.mail@gmail.com>
Date: Thu, 3 Feb 2022 16:37:28 +0100
Subject: [PATCH 3/3] Define more mlibc constants

---
 src/unix/mlibc/mod.rs | 85 +++++++++++++++++++++++++++++++++++++++----
 1 file changed, 77 insertions(+), 8 deletions(-)

diff --git a/src/unix/mlibc/mod.rs b/src/unix/mlibc/mod.rs
index f374aa1..ddd4c07 100644
--- a/src/unix/mlibc/mod.rs
+++ b/src/unix/mlibc/mod.rs
@@ -19,7 +19,7 @@ pub type socklen_t = ::c_ulong;
 // options/internal/include/bits/off_t.h
 pub type off_t = ::c_long;
 
-// abis/mlibc/vm-flags.h 
+// abis/mlibc/vm-flags.h
 pub const MAP_ANON: ::c_int = 8;
 pub const MAP_PRIVATE: ::c_int = 1;
 pub const MAP_SHARED: ::c_int = 2;
@@ -71,9 +71,53 @@ pub type fsblkcnt_t = ::c_uint;
 pub type fsfilcnt_t = ::c_uint;
 
 // abis/mlibc/signal.h
+pub const SIGHUP: ::c_int = 1;
+pub const SIGINT: ::c_int = 2;
+pub const SIGQUIT: ::c_int = 3;
+pub const SIGILL: ::c_int = 4;
+pub const SIGTRAP: ::c_int = 5;
+pub const SIGABRT: ::c_int = 6;
+pub const SIGBUS: ::c_int = 7;
+pub const SIGFPE: ::c_int = 8;
 pub const SIGKILL: ::c_int = 9;
+pub const SIGUSR1: ::c_int = 10;
+pub const SIGSEGV: ::c_int = 11;
+pub const SIGUSR2: ::c_int = 12;
 pub const SIGPIPE: ::c_int = 13;
+pub const SIGALRM: ::c_int = 14;
+pub const SIGTERM: ::c_int = 15;
+pub const SIGSTKFLT: ::c_int = 16;
+pub const SIGCHLD: ::c_int = 17;
+pub const SIGCONT: ::c_int = 18;
+pub const SIGSTOP: ::c_int = 19;
+pub const SIGTSTP: ::c_int = 20;
+pub const SIGTTIN: ::c_int = 21;
+pub const SIGTTOU: ::c_int = 22;
+pub const SIGURG: ::c_int = 23;
+pub const SIGXCPU: ::c_int = 24;
+pub const SIGXFSZ: ::c_int = 25;
+pub const SIGVTALRM: ::c_int = 26;
+pub const SIGPROF: ::c_int = 27;
+pub const SIGWINCH: ::c_int = 28;
+pub const SIGIO: ::c_int = 29;
+pub const SIGPOLL: ::c_int = SIGIO;
+pub const SIGPWR: ::c_int = 30;
+pub const SIGSYS: ::c_int = 31;
+pub const SIGRTMIN: ::c_int = 32;
+pub const SIGRTMAX: ::c_int = 33;
+pub const SIGCANCEL: ::c_int = 34;
+
 pub const SIG_SETMASK: ::c_int = 3;
+
+
+pub const SA_NOCLDSTOP: ::c_int = 1 << 0;
+pub const SA_ONSTACK: ::c_int = 1 << 1;
+pub const SA_RESETHAND: ::c_int = 1 << 2;
+pub const SA_RESTART: ::c_int = 1 << 3;
+pub const SA_SIGINFO: ::c_int = 1 << 4;
+pub const SA_NOCLDWAIT: ::c_int = 1 << 5;
+pub const SA_NODEFER: ::c_int = 1 << 6;
+
 pub type sigset_t = ::c_long;
 s! {
     pub struct siginfo_t {
@@ -93,9 +137,9 @@ s! {
         pub sa_sigaction: ::Option<extern fn(::c_int, *mut siginfo_t, *mut ::c_void)>,
     }
 }
-s_no_extra_traits! {
-    pub union sigval {
-        pub sival_int: ::c_int,
+s! {
+    pub struct sigval {
+        // pub sival_int: ::c_int,
         pub sival_ptr: *mut ::c_void,
     }
 }
@@ -120,6 +164,13 @@ s! {
 // options/posix/include/termios.h
 pub const TIOCGWINSZ: ::c_ulong = 0x5413;
 
+pub const CSTOPB: ::c_int = 0x0004;
+pub const CREAD: ::c_int = 0x0008;
+pub const PARENB: ::c_int = 0x0010;
+pub const PARODD: ::c_int = 0x0020;
+pub const HUPCL: ::c_int = 0x0040;
+pub const CLOCAL: ::c_int = 0x0080;
+
 // abis/mlibc/ino_t.h
 pub type ino_t = ::c_long;
 
@@ -176,11 +227,29 @@ pub const SHUT_WR: ::c_int = 3;
 pub const SOCK_DGRAM: ::c_int = 1;
 pub const SOCK_STREAM: ::c_int = 4;
 pub const SOL_SOCKET: ::c_int = 1;
-pub const SO_BROADCAST: ::c_int = 6;
+
+pub const SO_ACCEPTCONN: ::c_int = 1;
+pub const SO_BROADCAST: ::c_int = 2;
+pub const SO_DEBUG: ::c_int = 3;
+pub const SO_DONTROUTE: ::c_int = 4;
 pub const SO_ERROR: ::c_int = 5;
+pub const SO_KEEPALIVE: ::c_int = 6;
+pub const SO_LINGER: ::c_int = 7;
+pub const SO_OOBINLINE: ::c_int = 8;
+pub const SO_RCVBUF: ::c_int = 9;
+pub const SO_RCVLOWAT: ::c_int = 10;
 pub const SO_RCVTIMEO: ::c_int = 11;
 pub const SO_REUSEADDR: ::c_int = 12;
+pub const SO_SNDBUF: ::c_int = 13;
+pub const SO_SNDLOWAT: ::c_int = 14;
 pub const SO_SNDTIMEO: ::c_int = 15;
+pub const SO_TYPE: ::c_int = 16;
+pub const SO_SNDBUFFORCE: ::c_int = 17;
+pub const SO_PEERCRED: ::c_int = 18;
+pub const SO_ATTACH_FILTER: ::c_int = 19;
+pub const SO_PASSCRED: ::c_int = 20;
+pub const SO_RCVBUFFORCE: ::c_int = 21;
+
 pub type sa_family_t = ::c_uint;
 s! {
     pub struct sockaddr_storage {
@@ -522,9 +591,9 @@ s! {
 }
 
 // options/posix/include/bits/posix/fd_set.h
-s_no_extra_traits! {
-    pub union fd_set {
-        pub __mlibc_elems: [c_char; 128],
+s! {
+    pub struct fd_set {
+        // pub __mlibc_elems: [c_char; 128],
         pub fds_bits: [c_char; 128],
     }
 }
-- 
2.34.1

