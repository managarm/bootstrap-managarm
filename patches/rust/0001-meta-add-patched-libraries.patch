From f54b3fd5edb98990235c1273c0e056c8c8d228e1 Mon Sep 17 00:00:00 2001
From: no92 <no92.mail@gmail.com>
Date: Sun, 31 Mar 2024 19:21:57 +0200
Subject: [PATCH 1/6] meta: add patched libraries

---
 Cargo.lock             | 7 ++++---
 Cargo.toml             | 2 ++
 library/Cargo.lock     | 4 +---
 library/Cargo.toml     | 1 +
 library/std/Cargo.toml | 2 +-
 library/std/src/lib.rs | 2 +-
 6 files changed, 10 insertions(+), 8 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 2c290b39..721618d0 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -2091,9 +2091,7 @@ checksum = "9fa0e2a1fcbe2f6be6c42e342259976206b383122fc152e872795338b5a3f3a7"
 
 [[package]]
 name = "libc"
-version = "0.2.174"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "1171693293099992e19cddea4e8b849964e9846f4acee11b3948bcc337be8776"
+version = "0.2.175"
 
 [[package]]
 name = "libdbus-sys"
@@ -6839,3 +6837,6 @@ dependencies = [
  "quote",
  "syn 2.0.106",
 ]
+
+[patch.crates-io]
+libc = { path = '../rust-libc' }
diff --git a/Cargo.toml b/Cargo.toml
index 67c7a9d6..c9892d15 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -93,3 +93,5 @@ codegen-units = 1
 # For git dependencies, also add your source to ALLOWED_SOURCES in src/tools/tidy/src/extdeps.rs.
 #[patch.crates-io]
 
+[patch.crates-io]
+libc = { path = '../rust-libc' }
diff --git a/library/Cargo.lock b/library/Cargo.lock
index 50fb060f..8352c393 100644
--- a/library/Cargo.lock
+++ b/library/Cargo.lock
@@ -139,9 +139,7 @@ dependencies = [
 
 [[package]]
 name = "libc"
-version = "0.2.177"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "2874a2af47a2325c2001a6e6fad9b16a53b802102b528163885171cf92b15976"
+version = "0.2.175"
 dependencies = [
  "rustc-std-workspace-core",
 ]
diff --git a/library/Cargo.toml b/library/Cargo.toml
index e30e6240..a761277b 100644
--- a/library/Cargo.toml
+++ b/library/Cargo.toml
@@ -59,3 +59,4 @@ rustflags = ["-Cpanic=abort"]
 rustc-std-workspace-core = { path = 'rustc-std-workspace-core' }
 rustc-std-workspace-alloc = { path = 'rustc-std-workspace-alloc' }
 rustc-std-workspace-std = { path = 'rustc-std-workspace-std' }
+libc = { path = '../../rust-libc' }
diff --git a/library/std/Cargo.toml b/library/std/Cargo.toml
index 685c2cf1..53b60f27 100644
--- a/library/std/Cargo.toml
+++ b/library/std/Cargo.toml
@@ -33,7 +33,7 @@ miniz_oxide = { version = "0.8.0", optional = true, default-features = false }
 addr2line = { version = "0.25.0", optional = true, default-features = false }
 
 [target.'cfg(not(all(windows, target_env = "msvc")))'.dependencies]
-libc = { version = "0.2.177", default-features = false, features = [
+libc = { path = "../../../rust-libc", default-features = false, features = [
     'rustc-dep-of-std',
 ], public = true }
 
diff --git a/library/std/src/lib.rs b/library/std/src/lib.rs
index a8c50cec..548e868c 100644
--- a/library/std/src/lib.rs
+++ b/library/std/src/lib.rs
@@ -695,7 +695,7 @@ pub mod arch {
 // Private support modules
 mod panicking;
 
-#[path = "../../backtrace/src/lib.rs"]
+#[path = "../../../../rust-backtrace/src/lib.rs"]
 #[allow(dead_code, unused_attributes, fuzzy_provenance_casts, unsafe_op_in_unsafe_fn)]
 mod backtrace_rs;
 
-- 
2.52.0

