From 00ef9f483117e55d88dab7ea59b0111a18fd8dc7 Mon Sep 17 00:00:00 2001
From: no92 <no92.mail@gmail.com>
Date: Wed, 23 Apr 2025 13:01:40 +0200
Subject: [PATCH] Add managarm support

---
 kernel-open/common/inc/cpuopsys.h             |   4 +
 managarm-open/meson.build                     |  12 +
 managarm-open/shader-ld.sh                    |  16 +
 meson.build                                   |   7 +
 src/common/sdk/nvidia/inc/cpuopsys.h          |   4 +
 src/meson.build                               | 833 ++++++++++++++++++
 src/nvidia-modeset/meson.build                | 331 +++++++
 .../include/nvidia-modeset-os-interface.h     |   2 +-
 .../os-interface/include/nvkms.h              |   2 +-
 src/nvidia-modeset/src/shaders/meson.build    |  31 +
 .../arch/nvalloc/unix/include/nv-ioctl-numa.h |   2 +-
 src/nvidia/arch/nvalloc/unix/include/nv.h     |   1 +
 .../arch/nvalloc/unix/src/asm/x86/nv_rdcr.c   |   4 +-
 src/nvidia/arch/nvalloc/unix/src/osinit.c     |   4 +-
 src/nvidia/meson.build                        | 289 ++++++
 15 files changed, 1536 insertions(+), 6 deletions(-)
 create mode 100644 managarm-open/meson.build
 create mode 100755 managarm-open/shader-ld.sh
 create mode 100644 meson.build
 create mode 100644 src/meson.build
 create mode 100644 src/nvidia-modeset/meson.build
 create mode 100644 src/nvidia-modeset/src/shaders/meson.build
 create mode 100644 src/nvidia/meson.build

diff --git a/kernel-open/common/inc/cpuopsys.h b/kernel-open/common/inc/cpuopsys.h
index 9743041..f146af3 100644
--- a/kernel-open/common/inc/cpuopsys.h
+++ b/kernel-open/common/inc/cpuopsys.h
@@ -69,6 +69,10 @@
 #   define NV_LINUX
 #endif  /* defined(__linux__) */
 
+#if defined(__managarm__) && !defined(NV_LINUX)
+#   define NV_LINUX
+#endif  /* defined(__managarm__) */
+
 #if defined(__VMWARE__) && !defined(NV_VMWARE)
 #   define NV_VMWARE
 #endif /* defined(__VMWARE__) */
diff --git a/managarm-open/meson.build b/managarm-open/meson.build
new file mode 100644
index 0000000..2925f5e
--- /dev/null
+++ b/managarm-open/meson.build
@@ -0,0 +1,12 @@
+nvidia_open_lib_dep = declare_dependency(
+	link_with: [libnvidia, libnvidia_modeset],
+	include_directories: [src_inc, inc, modeset_inc],
+	compile_args: ['-DNVRM'])
+
+nvidia_open_cpp_args = [
+	'-fno-operator-names',
+	'-DNVRM',
+	'-DDEBUG',
+	'-DNV_VERSION_STRING="575.51.02"',
+	'-DNV_KERNEL_INTERFACE_LAYER',
+]
diff --git a/managarm-open/shader-ld.sh b/managarm-open/shader-ld.sh
new file mode 100755
index 0000000..5283c4a
--- /dev/null
+++ b/managarm-open/shader-ld.sh
@@ -0,0 +1,16 @@
+#!/bin/bash
+# Invocation: <ld path> <absolute input path> <absolute output path>
+outpath=$(realpath "$3")
+
+cd $(dirname "$2")
+
+input_basename=$(basename "$2")
+temp_input=${input_basename:2}
+
+cp "$input_basename" "$temp_input"
+
+echo "$1 -r -z noexecstack --format=binary $temp_input -o $outpath"
+
+$1 -r -z noexecstack --format=binary "$temp_input" -o "$outpath"
+
+rm "$temp_input"
diff --git a/meson.build b/meson.build
new file mode 100644
index 0000000..862c1ce
--- /dev/null
+++ b/meson.build
@@ -0,0 +1,7 @@
+project('nvidia-open', ['c', 'cpp'], default_options: [
+	'c_std=gnu11',
+	'cpp_std=gnu++11',
+])
+
+subdir('src')
+subdir('managarm-open')
diff --git a/src/common/sdk/nvidia/inc/cpuopsys.h b/src/common/sdk/nvidia/inc/cpuopsys.h
index 230c7b5..59f26a7 100644
--- a/src/common/sdk/nvidia/inc/cpuopsys.h
+++ b/src/common/sdk/nvidia/inc/cpuopsys.h
@@ -69,6 +69,10 @@
 #   define NV_LINUX
 #endif  /* defined(__linux__) */
 
+#if defined(__managarm__) && !defined(NV_LINUX)
+#   define NV_LINUX
+#endif  /* defined(__managarm__) */
+
 #if defined(__VMWARE__) && !defined(NV_VMWARE)
 #   define NV_VMWARE
 #endif /* defined(__VMWARE__) */
diff --git a/src/meson.build b/src/meson.build
new file mode 100644
index 0000000..127cf3c
--- /dev/null
+++ b/src/meson.build
@@ -0,0 +1,833 @@
+src_inc = include_directories(
+	'common/sdk/nvidia/inc',
+	# 'common/sdk/nvidia/inc/hw',
+	'common/shared/inc',
+	'common/shared/msgq/inc',
+	'common/inc',
+	# 'common/uproc/os/libos-v2.0.0/include',
+	'common/uproc/os/common/include',
+	'common/inc/swref',
+	'common/inc/swref/published',
+	'common/nvswitch/kernel/inc',
+	'common/nvswitch/interface',
+	'common/nvswitch/common/inc/',
+	'common/inc/displayport',
+	'common/nvlink/interface/',
+	'common/nvlink/inband/interface',
+	# 'common/mbedtls/include',
+	# 'common/mbedtls/nvidia',
+	'common/softfloat/nvidia',
+	'common/softfloat/source/include',
+	'common/softfloat/source/8086-SSE',
+	'common/unix/common/utils/interface',
+	'common/unix/common/inc',
+	'common/modeset',
+)
+
+nvidia_common_src = files(
+	'common/shared/msgq/msgq.c',
+	'common/shared/nvstatus/nvstatus.c',
+	'common/src/nvSha256.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_conn_mgmt.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_discovery.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_initialize.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_ioctl.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_link_mgmt.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_logger.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_shutdown.c',
+	'common/nvlink/kernel/nvlink/core/nvlink_training.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_ioctl_entry.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_kern_device_mgmt_entry.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_kern_discovery_entry.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_kern_initialize_entry.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_kern_link_mgmt_entry.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_kern_registration_entry.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_kern_shutdown_entry.c',
+	'common/nvlink/kernel/nvlink/interface/nvlink_kern_training_entry.c',
+	'common/nvlink/kernel/nvlink/nvlink_lib_mgmt.c',
+	'common/nvlink/kernel/nvlink/nvlink_lock.c',
+	'common/nvswitch/kernel/bios_nvswitch.c',
+	'common/nvswitch/kernel/cci/cables/cci_common.c',
+	'common/nvswitch/kernel/cci/cables/cci_copper.c',
+	'common/nvswitch/kernel/cci/cables/cci_direct.c',
+	'common/nvswitch/kernel/cci/cables/cci_error.c',
+	'common/nvswitch/kernel/cci/cables/cci_optical.c',
+	'common/nvswitch/kernel/cci/cci_cdb_async_nvswitch.c',
+	'common/nvswitch/kernel/cci/cci_nvswitch.c',
+	'common/nvswitch/kernel/error_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcn_call_hal_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcn_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcnable_call_hal_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcnable_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcndmem_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcnqueue_dmem_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcnqueue_fb_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcnqueue_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcnqueuerd_nvswitch.c',
+	'common/nvswitch/kernel/flcn/flcnrtosdebug_nvswitch.c',
+	'common/nvswitch/kernel/flcn/v03/flcn0300_nvswitch.c',
+	'common/nvswitch/kernel/flcn/v04/flcn0400_nvswitch.c',
+	'common/nvswitch/kernel/flcn/v05/flcn0501_nvswitch.c',
+	'common/nvswitch/kernel/flcn/v06/flcn0600_nvswitch.c',
+	'common/nvswitch/kernel/fsprpc_nvswitch.c',
+	'common/nvswitch/kernel/inforom/ifrbbx_nvswitch.c',
+	'common/nvswitch/kernel/inforom/ifrecc_nvswitch.c',
+	'common/nvswitch/kernel/inforom/ifrnvlink_nvswitch.c',
+	'common/nvswitch/kernel/inforom/ifroms_nvswitch.c',
+	'common/nvswitch/kernel/inforom/ifrro_nvswitch.c',
+	'common/nvswitch/kernel/inforom/inforom_nvl_v3_nvswitch.c',
+	'common/nvswitch/kernel/inforom/inforom_nvl_v4_nvswitch.c',
+	'common/nvswitch/kernel/inforom/inforom_nvswitch.c',
+	'common/nvswitch/kernel/ipmi/fru_nvswitch.c',
+	'common/nvswitch/kernel/lr10/cci_lr10.c',
+	'common/nvswitch/kernel/lr10/clock_lr10.c',
+	'common/nvswitch/kernel/lr10/discovery_lr10.c',
+	'common/nvswitch/kernel/lr10/flcn_lr10.c',
+	'common/nvswitch/kernel/lr10/inforom_lr10.c',
+	'common/nvswitch/kernel/lr10/intr_lr10.c',
+	'common/nvswitch/kernel/lr10/link_lr10.c',
+	'common/nvswitch/kernel/lr10/lr10.c',
+	'common/nvswitch/kernel/lr10/minion_lr10.c',
+	'common/nvswitch/kernel/lr10/pmgr_lr10.c',
+	'common/nvswitch/kernel/lr10/smbpbi_lr10.c',
+	'common/nvswitch/kernel/lr10/soe_lr10.c',
+	'common/nvswitch/kernel/lr10/therm_lr10.c',
+	'common/nvswitch/kernel/ls10/cci_ls10.c',
+	'common/nvswitch/kernel/ls10/clock_ls10.c',
+	'common/nvswitch/kernel/ls10/discovery_ls10.c',
+	'common/nvswitch/kernel/ls10/flcn_ls10.c',
+	'common/nvswitch/kernel/ls10/fsprpc_ls10.c',
+	'common/nvswitch/kernel/ls10/heartbeat_ls10.c',
+	'common/nvswitch/kernel/ls10/inforom_ls10.c',
+	'common/nvswitch/kernel/ls10/intr_ls10.c',
+	'common/nvswitch/kernel/ls10/link_ls10.c',
+	'common/nvswitch/kernel/ls10/ls10.c',
+	'common/nvswitch/kernel/ls10/minion_ls10.c',
+	'common/nvswitch/kernel/ls10/multicast_ls10.c',
+	'common/nvswitch/kernel/ls10/pmgr_ls10.c',
+	'common/nvswitch/kernel/ls10/smbpbi_ls10.c',
+	'common/nvswitch/kernel/ls10/soe_ls10.c',
+	'common/nvswitch/kernel/ls10/sugen_ls10.c',
+	'common/nvswitch/kernel/ls10/therm_ls10.c',
+	'common/nvswitch/kernel/ls10/tnvl_ls10.c',
+	'common/nvswitch/kernel/nvswitch.c',
+	'common/nvswitch/kernel/pmgr_nvswitch.c',
+	'common/nvswitch/kernel/rom_nvswitch.c',
+	'common/nvswitch/kernel/smbpbi_nvswitch.c',
+	'common/nvswitch/kernel/soe/soe_call_hal_nvswitch.c',
+	'common/nvswitch/kernel/soe/soe_nvswitch.c',
+	'common/nvswitch/kernel/spi_nvswitch.c',
+	'common/uproc/os/libos-v3.1.0/lib/libdwarf.c',
+	'common/uproc/os/libos-v3.1.0/lib/libelf.c',
+	'common/uproc/os/libos-v3.1.0/lib/liblogdecode.c',
+)
+
+nvidia_nvalloc_src = files(
+	'nvidia/arch/nvalloc/unix/src/asm/x86/nv_cpuid.c',
+	'nvidia/arch/nvalloc/unix/src/asm/x86/nv_rdcr.c',
+	'nvidia/arch/nvalloc/unix/src/dynamic-power.c',
+	'nvidia/arch/nvalloc/unix/src/escape.c',
+	'nvidia/arch/nvalloc/unix/src/exports-stubs.c',
+	# 'nvidia/arch/nvalloc/unix/src/gcc_helper.c',
+	'nvidia/arch/nvalloc/unix/src/os-hypervisor.c',
+	'nvidia/arch/nvalloc/unix/src/os.c',
+	'nvidia/arch/nvalloc/unix/src/osapi.c',
+	'nvidia/arch/nvalloc/unix/src/osinit.c',
+	'nvidia/arch/nvalloc/unix/src/osmemdesc.c',
+	'nvidia/arch/nvalloc/unix/src/osnvlink.c',
+	'nvidia/arch/nvalloc/unix/src/osunix.c',
+	'nvidia/arch/nvalloc/unix/src/registry.c',
+	'nvidia/arch/nvalloc/unix/src/rm-gpu-ops.c',
+	'nvidia/arch/nvalloc/unix/src/rmobjexportimport.c',
+	'nvidia/arch/nvalloc/unix/src/subdevice_ctrl_os_unix.c',
+	'nvidia/arch/nvalloc/unix/src/unix_console.c',
+	'nvidia/arch/nvalloc/unix/src/unix_intr.c',
+	'nvidia/arch/nvalloc/unix/src/vbioscall.c',
+	'nvidia/arch/nvalloc/unix/x86emu/debug.c',
+	'nvidia/arch/nvalloc/unix/x86emu/decode.c',
+	'nvidia/arch/nvalloc/unix/x86emu/fpu.c',
+	'nvidia/arch/nvalloc/unix/x86emu/ops.c',
+	'nvidia/arch/nvalloc/unix/x86emu/ops2.c',
+	'nvidia/arch/nvalloc/unix/x86emu/prim_ops.c',
+	'nvidia/arch/nvalloc/unix/x86emu/sys.c',
+)
+
+nvidia_interface_src = files(
+	'nvidia/interface/deprecated/rmapi_deprecated_allocmemory.c',
+	'nvidia/interface/deprecated/rmapi_deprecated_control.c',
+	'nvidia/interface/deprecated/rmapi_deprecated_misc.c',
+	'nvidia/interface/deprecated/rmapi_deprecated_utils.c',
+	'nvidia/interface/deprecated/rmapi_deprecated_vidheapctrl.c',
+	'nvidia/interface/deprecated/rmapi_gss_legacy_control.c',
+	'nvidia/interface/rmapi/src/g_finn_rm_api.c',
+)
+
+nvidia_kernel_src = files(
+	'nvidia/src/kernel/compute/fabric.c',
+	'nvidia/src/kernel/compute/fm_session_api.c',
+	'nvidia/src/kernel/compute/imex_session_api.c',
+	'nvidia/src/kernel/compute/mps_api.c',
+	'nvidia/src/kernel/core/bin_data.c',
+	'nvidia/src/kernel/core/hal/hal.c',
+	'nvidia/src/kernel/core/hal/hals_all.c',
+	'nvidia/src/kernel/core/hal/hals_stub.c',
+	'nvidia/src/kernel/core/hal/info_block.c',
+	'nvidia/src/kernel/core/hal_mgr.c',
+	'nvidia/src/kernel/core/locks.c',
+	'nvidia/src/kernel/core/locks_common.c',
+	'nvidia/src/kernel/core/system.c',
+	'nvidia/src/kernel/core/thread_state.c',
+	'nvidia/src/kernel/diagnostics/code_coverage_mgr.c',
+	'nvidia/src/kernel/diagnostics/gpu_acct.c',
+	'nvidia/src/kernel/diagnostics/journal.c',
+	'nvidia/src/kernel/diagnostics/nv_debug_dump.c',
+	'nvidia/src/kernel/diagnostics/nvlog.c',
+	'nvidia/src/kernel/diagnostics/nvlog_printf.c',
+	'nvidia/src/kernel/diagnostics/profiler.c',
+	'nvidia/src/kernel/diagnostics/ucode_coverage_ctrl.c',
+	'nvidia/src/kernel/disp/disp_sw.c',
+	'nvidia/src/kernel/disp/nvfbc_session.c',
+	'nvidia/src/kernel/gpu/arch/ada/kern_gpu_ad102.c',
+	'nvidia/src/kernel/gpu/arch/ampere/kern_gpu_error_cont_ga100.c',
+	'nvidia/src/kernel/gpu/arch/ampere/kern_gpu_ga100.c',
+	'nvidia/src/kernel/gpu/arch/blackwell/kern_gpu_error_cont_gb100.c',
+	'nvidia/src/kernel/gpu/arch/blackwell/kern_gpu_gb100.c',
+	'nvidia/src/kernel/gpu/arch/blackwell/kern_gpu_gb10b.c',
+	'nvidia/src/kernel/gpu/arch/blackwell/kern_gpu_gb202.c',
+	'nvidia/src/kernel/gpu/arch/blackwell/kern_gpu_gb20b.c',
+	'nvidia/src/kernel/gpu/arch/hopper/kern_gpu_gh100.c',
+	'nvidia/src/kernel/gpu/arch/maxwell/kern_gpu_gm107.c',
+	'nvidia/src/kernel/gpu/arch/pascal/kern_gpu_gp100.c',
+	'nvidia/src/kernel/gpu/arch/turing/kern_gpu_tu102.c',
+	'nvidia/src/kernel/gpu/audio/hda_codec_api.c',
+	'nvidia/src/kernel/gpu/bif/arch/ada/kernel_bif_ad102.c',
+	'nvidia/src/kernel/gpu/bif/arch/ampere/kernel_bif_ga100.c',
+	'nvidia/src/kernel/gpu/bif/arch/ampere/kernel_bif_ga102.c',
+	'nvidia/src/kernel/gpu/bif/arch/blackwell/kernel_bif_gb100.c',
+	'nvidia/src/kernel/gpu/bif/arch/blackwell/kernel_bif_gb10b.c',
+	'nvidia/src/kernel/gpu/bif/arch/blackwell/kernel_bif_gb202.c',
+	'nvidia/src/kernel/gpu/bif/arch/hopper/kernel_bif_gh100.c',
+	'nvidia/src/kernel/gpu/bif/arch/maxwell/kernel_bif_gm107.c',
+	'nvidia/src/kernel/gpu/bif/arch/maxwell/kernel_bif_gm200.c',
+	'nvidia/src/kernel/gpu/bif/arch/pascal/kernel_bif_gp100.c',
+	'nvidia/src/kernel/gpu/bif/arch/pascal/kernel_bif_gp10X.c',
+	'nvidia/src/kernel/gpu/bif/arch/turing/kernel_bif_tu102.c',
+	'nvidia/src/kernel/gpu/bif/arch/volta/kernel_bif_gv100.c',
+	'nvidia/src/kernel/gpu/bif/arch/volta/kernel_bif_gv11b.c',
+	'nvidia/src/kernel/gpu/bif/kernel_bif.c',
+	'nvidia/src/kernel/gpu/bif/kernel_bif_vgpu.c',
+	'nvidia/src/kernel/gpu/bus/arch/ampere/kern_bus_ga100.c',
+	'nvidia/src/kernel/gpu/bus/arch/blackwell/kern_bus_gb100.c',
+	'nvidia/src/kernel/gpu/bus/arch/blackwell/kern_bus_gb10b.c',
+	'nvidia/src/kernel/gpu/bus/arch/blackwell/kern_bus_gb202.c',
+	'nvidia/src/kernel/gpu/bus/arch/hopper/kern_bus_gh100.c',
+	'nvidia/src/kernel/gpu/bus/arch/maxwell/kern_bus_gm107.c',
+	'nvidia/src/kernel/gpu/bus/arch/maxwell/kern_bus_gm200.c',
+	'nvidia/src/kernel/gpu/bus/arch/pascal/kern_bus_gp100.c',
+	'nvidia/src/kernel/gpu/bus/arch/turing/kern_bus_tu102.c',
+	'nvidia/src/kernel/gpu/bus/arch/volta/kern_bus_gv100.c',
+	'nvidia/src/kernel/gpu/bus/kern_bus.c',
+	'nvidia/src/kernel/gpu/bus/kern_bus_ctrl.c',
+	'nvidia/src/kernel/gpu/bus/kern_bus_vbar2.c',
+	'nvidia/src/kernel/gpu/bus/kern_bus_vgpu.c',
+	'nvidia/src/kernel/gpu/bus/p2p.c',
+	'nvidia/src/kernel/gpu/bus/p2p_api.c',
+	'nvidia/src/kernel/gpu/bus/third_party_p2p.c',
+	'nvidia/src/kernel/gpu/bus/third_party_p2p_ctrl.c',
+	'nvidia/src/kernel/gpu/ccu/arch/blackwell/kernel_ccu_gb100.c',
+	'nvidia/src/kernel/gpu/ccu/arch/hopper/kernel_ccu_gh100.c',
+	'nvidia/src/kernel/gpu/ccu/kernel_ccu.c',
+	'nvidia/src/kernel/gpu/ccu/kernel_ccu_api.c',
+	'nvidia/src/kernel/gpu/ce/arch/ampere/kernel_ce_ga100.c',
+	'nvidia/src/kernel/gpu/ce/arch/ampere/kernel_ce_ga102.c',
+	'nvidia/src/kernel/gpu/ce/arch/blackwell/kernel_ce_gb100.c',
+	'nvidia/src/kernel/gpu/ce/arch/blackwell/kernel_ce_gb10b.c',
+	'nvidia/src/kernel/gpu/ce/arch/blackwell/kernel_ce_gb202.c',
+	'nvidia/src/kernel/gpu/ce/arch/blackwell/kernel_ce_gb20b.c',
+	'nvidia/src/kernel/gpu/ce/arch/hopper/kernel_ce_gh100.c',
+	'nvidia/src/kernel/gpu/ce/arch/pascal/kernel_ce_gp100.c',
+	'nvidia/src/kernel/gpu/ce/arch/turing/kernel_ce_tu102.c',
+	'nvidia/src/kernel/gpu/ce/arch/volta/kernel_ce_gv100.c',
+	'nvidia/src/kernel/gpu/ce/kernel_ce.c',
+	'nvidia/src/kernel/gpu/ce/kernel_ce_context.c',
+	'nvidia/src/kernel/gpu/ce/kernel_ce_ctrl.c',
+	'nvidia/src/kernel/gpu/ce/kernel_ce_shared.c',
+	'nvidia/src/kernel/gpu/conf_compute/arch/blackwell/conf_compute_gb100.c',
+	'nvidia/src/kernel/gpu/conf_compute/arch/blackwell/conf_compute_keystore_gb100.c',
+	'nvidia/src/kernel/gpu/conf_compute/arch/hopper/conf_compute_gh100.c',
+	'nvidia/src/kernel/gpu/conf_compute/arch/hopper/conf_compute_key_rotation_gh100.c',
+	'nvidia/src/kernel/gpu/conf_compute/arch/hopper/conf_compute_keystore_gh100.c',
+	'nvidia/src/kernel/gpu/conf_compute/ccsl.c',
+	'nvidia/src/kernel/gpu/conf_compute/conf_compute.c',
+	'nvidia/src/kernel/gpu/conf_compute/conf_compute_api.c',
+	'nvidia/src/kernel/gpu/conf_compute/conf_compute_key_rotation.c',
+	'nvidia/src/kernel/gpu/dbgbuffer.c',
+	'nvidia/src/kernel/gpu/deferred_api.c',
+	'nvidia/src/kernel/gpu/device.c',
+	'nvidia/src/kernel/gpu/device_ctrl.c',
+	'nvidia/src/kernel/gpu/device_share.c',
+	'nvidia/src/kernel/gpu/disp/arch/v02/kern_disp_0204.c',
+	'nvidia/src/kernel/gpu/disp/arch/v02/kern_disp_0207.c',
+	'nvidia/src/kernel/gpu/disp/arch/v03/kern_disp_0300.c',
+	'nvidia/src/kernel/gpu/disp/arch/v03/kern_disp_channel_0300.c',
+	'nvidia/src/kernel/gpu/disp/arch/v04/kern_disp_0400.c',
+	'nvidia/src/kernel/gpu/disp/arch/v04/kern_disp_0401.c',
+	'nvidia/src/kernel/gpu/disp/arch/v04/kern_disp_0404.c',
+	'nvidia/src/kernel/gpu/disp/arch/v05/kern_disp_0501.c',
+	'nvidia/src/kernel/gpu/disp/disp_capabilities.c',
+	'nvidia/src/kernel/gpu/disp/disp_channel.c',
+	'nvidia/src/kernel/gpu/disp/disp_common_ctrl_acpi.c',
+	'nvidia/src/kernel/gpu/disp/disp_common_kern_ctrl_minimal.c',
+	'nvidia/src/kernel/gpu/disp/disp_object_kern_ctrl_minimal.c',
+	'nvidia/src/kernel/gpu/disp/disp_objs.c',
+	'nvidia/src/kernel/gpu/disp/disp_sf_user.c',
+	'nvidia/src/kernel/gpu/disp/head/arch/v04/kernel_head_0400.c',
+	'nvidia/src/kernel/gpu/disp/head/arch/v04/kernel_head_0401.c',
+	'nvidia/src/kernel/gpu/disp/head/arch/v05/kernel_head_0502.c',
+	'nvidia/src/kernel/gpu/disp/head/kernel_head.c',
+	'nvidia/src/kernel/gpu/disp/inst_mem/arch/v03/disp_inst_mem_0300.c',
+	'nvidia/src/kernel/gpu/disp/inst_mem/disp_inst_mem.c',
+	'nvidia/src/kernel/gpu/disp/kern_disp.c',
+	'nvidia/src/kernel/gpu/disp/rg_line_callback/rg_line_callback.c',
+	'nvidia/src/kernel/gpu/disp/vblank_callback/vblank.c',
+	'nvidia/src/kernel/gpu/disp/vblank_callback/vblank_callback.c',
+	'nvidia/src/kernel/gpu/eng_state.c',
+	'nvidia/src/kernel/gpu/external_device/arch/blackwell/kern_gsync_gb100.c',
+	'nvidia/src/kernel/gpu/external_device/arch/kepler/kern_external_device_gk104.c',
+	'nvidia/src/kernel/gpu/external_device/arch/kepler/kern_gsync_p2060.c',
+	'nvidia/src/kernel/gpu/external_device/arch/pascal/kern_gsync_p2061.c',
+	'nvidia/src/kernel/gpu/external_device/gsync.c',
+	'nvidia/src/kernel/gpu/external_device/gsync_api.c',
+	'nvidia/src/kernel/gpu/external_device/kern_external_device.c',
+	'nvidia/src/kernel/gpu/falcon/arch/ampere/kernel_falcon_ga100.c',
+	'nvidia/src/kernel/gpu/falcon/arch/ampere/kernel_falcon_ga102.c',
+	'nvidia/src/kernel/gpu/falcon/arch/blackwell/kernel_falcon_gb100.c',
+	'nvidia/src/kernel/gpu/falcon/arch/turing/kernel_crashcat_engine_tu102.c',
+	'nvidia/src/kernel/gpu/falcon/arch/turing/kernel_falcon_tu102.c',
+	'nvidia/src/kernel/gpu/falcon/kernel_crashcat_engine.c',
+	'nvidia/src/kernel/gpu/falcon/kernel_falcon.c',
+	'nvidia/src/kernel/gpu/falcon/kernel_falcon_ctrl.c',
+	'nvidia/src/kernel/gpu/fifo/arch/ada/kernel_fifo_ad102.c',
+	'nvidia/src/kernel/gpu/fifo/arch/ampere/kernel_channel_ga100.c',
+	'nvidia/src/kernel/gpu/fifo/arch/ampere/kernel_channel_ga10b.c',
+	'nvidia/src/kernel/gpu/fifo/arch/ampere/kernel_fifo_ga100.c',
+	'nvidia/src/kernel/gpu/fifo/arch/ampere/kernel_fifo_ga102.c',
+	'nvidia/src/kernel/gpu/fifo/arch/blackwell/kernel_channel_gb10b.c',
+	'nvidia/src/kernel/gpu/fifo/arch/blackwell/kernel_fifo_gb100.c',
+	'nvidia/src/kernel/gpu/fifo/arch/blackwell/kernel_fifo_gb10b.c',
+	'nvidia/src/kernel/gpu/fifo/arch/blackwell/kernel_fifo_gb202.c',
+	'nvidia/src/kernel/gpu/fifo/arch/hopper/kernel_channel_gh100.c',
+	'nvidia/src/kernel/gpu/fifo/arch/hopper/kernel_fifo_gh100.c',
+	'nvidia/src/kernel/gpu/fifo/arch/maxwell/kernel_channel_gm107.c',
+	'nvidia/src/kernel/gpu/fifo/arch/maxwell/kernel_fifo_gm107.c',
+	'nvidia/src/kernel/gpu/fifo/arch/maxwell/kernel_fifo_gm200.c',
+	'nvidia/src/kernel/gpu/fifo/arch/pascal/kernel_fifo_gp102.c',
+	'nvidia/src/kernel/gpu/fifo/arch/turing/kernel_fifo_tu102.c',
+	'nvidia/src/kernel/gpu/fifo/arch/volta/kernel_channel_group_gv100.c',
+	'nvidia/src/kernel/gpu/fifo/arch/volta/kernel_channel_gv100.c',
+	'nvidia/src/kernel/gpu/fifo/arch/volta/kernel_fifo_gv100.c',
+	'nvidia/src/kernel/gpu/fifo/channel_descendant.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_channel.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_channel_group.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_channel_group_api.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_ctxshare.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_fifo.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_fifo_ctrl.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_fifo_init.c',
+	'nvidia/src/kernel/gpu/fifo/kernel_idle_channels.c',
+	'nvidia/src/kernel/gpu/fifo/usermode_api.c',
+	'nvidia/src/kernel/gpu/fifo/uvm_channel_retainer.c',
+	'nvidia/src/kernel/gpu/fsp/arch/blackwell/kern_fsp_gb100.c',
+	'nvidia/src/kernel/gpu/fsp/arch/blackwell/kern_fsp_gb202.c',
+	'nvidia/src/kernel/gpu/fsp/arch/blackwell/kern_fsp_gb20b.c',
+	'nvidia/src/kernel/gpu/fsp/arch/hopper/kern_fsp_gh100.c',
+	'nvidia/src/kernel/gpu/fsp/kern_fsp.c',
+	'nvidia/src/kernel/gpu/gpu.c',
+	'nvidia/src/kernel/gpu/gpu_access.c',
+	'nvidia/src/kernel/gpu/gpu_device_mapping.c',
+	'nvidia/src/kernel/gpu/gpu_engine_type.c',
+	'nvidia/src/kernel/gpu/gpu_fabric_probe.c',
+	'nvidia/src/kernel/gpu/gpu_gspclient.c',
+	'nvidia/src/kernel/gpu/gpu_protobuf.c',
+	'nvidia/src/kernel/gpu/gpu_register_access_map.c',
+	'nvidia/src/kernel/gpu/gpu_registry.c',
+	'nvidia/src/kernel/gpu/gpu_resource.c',
+	'nvidia/src/kernel/gpu/gpu_resource_desc.c',
+	'nvidia/src/kernel/gpu/gpu_rmapi.c',
+	'nvidia/src/kernel/gpu/gpu_suspend.c',
+	'nvidia/src/kernel/gpu/gpu_timeout.c',
+	'nvidia/src/kernel/gpu/gpu_user_shared_data.c',
+	'nvidia/src/kernel/gpu/gpu_uuid.c',
+	'nvidia/src/kernel/gpu/gpu_vgpu.c',
+	'nvidia/src/kernel/gpu/gpuvideo/videoeventlist.c',
+	'nvidia/src/kernel/gpu/gr/arch/ampere/kgraphics_ga100.c',
+	'nvidia/src/kernel/gpu/gr/arch/ampere/kgrmgr_ga100.c',
+	'nvidia/src/kernel/gpu/gr/arch/blackwell/kgraphics_gb100.c',
+	'nvidia/src/kernel/gpu/gr/arch/blackwell/kgrmgr_gb100.c',
+	'nvidia/src/kernel/gpu/gr/arch/blackwell/kgrmgr_gb10b.c',
+	'nvidia/src/kernel/gpu/gr/arch/maxwell/kgraphics_gm200.c',
+	'nvidia/src/kernel/gpu/gr/arch/pascal/kgraphics_gp100.c',
+	'nvidia/src/kernel/gpu/gr/arch/turing/kgraphics_tu102.c',
+	'nvidia/src/kernel/gpu/gr/fecs_event_list.c',
+	'nvidia/src/kernel/gpu/gr/kernel_graphics.c',
+	'nvidia/src/kernel/gpu/gr/kernel_graphics_context.c',
+	'nvidia/src/kernel/gpu/gr/kernel_graphics_manager.c',
+	'nvidia/src/kernel/gpu/gr/kernel_graphics_object.c',
+	'nvidia/src/kernel/gpu/gr/kernel_sm_debugger_session.c',
+	'nvidia/src/kernel/gpu/gr/kernel_sm_debugger_session_ctrl.c',
+	'nvidia/src/kernel/gpu/gsp/arch/ada/kernel_gsp_ad102.c',
+	'nvidia/src/kernel/gpu/gsp/arch/ampere/kernel_gsp_falcon_ga102.c',
+	'nvidia/src/kernel/gpu/gsp/arch/ampere/kernel_gsp_ga100.c',
+	'nvidia/src/kernel/gpu/gsp/arch/ampere/kernel_gsp_ga102.c',
+	'nvidia/src/kernel/gpu/gsp/arch/blackwell/kernel_gsp_ecc_gb100.c',
+	'nvidia/src/kernel/gpu/gsp/arch/blackwell/kernel_gsp_gb100.c',
+	'nvidia/src/kernel/gpu/gsp/arch/blackwell/kernel_gsp_gb10b.c',
+	'nvidia/src/kernel/gpu/gsp/arch/hopper/kernel_gsp_gh100.c',
+	'nvidia/src/kernel/gpu/gsp/arch/turing/kernel_gsp_booter_tu102.c',
+	'nvidia/src/kernel/gpu/gsp/arch/turing/kernel_gsp_falcon_tu102.c',
+	'nvidia/src/kernel/gpu/gsp/arch/turing/kernel_gsp_frts_tu102.c',
+	'nvidia/src/kernel/gpu/gsp/arch/turing/kernel_gsp_tu102.c',
+	'nvidia/src/kernel/gpu/gsp/arch/turing/kernel_gsp_vbios_tu102.c',
+	'nvidia/src/kernel/gpu/gsp/kernel_gsp.c',
+	'nvidia/src/kernel/gpu/gsp/kernel_gsp_booter.c',
+	'nvidia/src/kernel/gpu/gsp/kernel_gsp_fwsec.c',
+	'nvidia/src/kernel/gpu/gsp/kernel_gsp_trace_rats.c',
+	'nvidia/src/kernel/gpu/gsp/message_queue_cpu.c',
+	'nvidia/src/kernel/gpu/gsplite/kernel_gsplite.c',
+	'nvidia/src/kernel/gpu/host_eng/host_eng.c',
+	'nvidia/src/kernel/gpu/hwpm/arch/blackwell/kern_hwpm_gb100.c',
+	'nvidia/src/kernel/gpu/hwpm/arch/blackwell/kern_hwpm_gb10b.c',
+	'nvidia/src/kernel/gpu/hwpm/arch/blackwell/kern_hwpm_gb20b.c',
+	'nvidia/src/kernel/gpu/hwpm/arch/hopper/kern_hwpm_gh100.c',
+	'nvidia/src/kernel/gpu/hwpm/arch/maxwell/kern_hwpm_gm107.c',
+	'nvidia/src/kernel/gpu/hwpm/kern_hwpm.c',
+	'nvidia/src/kernel/gpu/hwpm/kern_hwpm_streamout.c',
+	'nvidia/src/kernel/gpu/hwpm/profiler_v1/kern_profiler_v1.c',
+	'nvidia/src/kernel/gpu/hwpm/profiler_v2/kern_profiler_v2.c',
+	'nvidia/src/kernel/gpu/hwpm/profiler_v2/kern_profiler_v2_ctrl.c',
+	'nvidia/src/kernel/gpu/i2c/i2c_api.c',
+	'nvidia/src/kernel/gpu/intr/arch/ampere/intr_cpu_ga102.c',
+	'nvidia/src/kernel/gpu/intr/arch/ampere/intr_ga100.c',
+	'nvidia/src/kernel/gpu/intr/arch/blackwell/intr_gb202.c',
+	'nvidia/src/kernel/gpu/intr/arch/hopper/intr_gh100.c',
+	'nvidia/src/kernel/gpu/intr/arch/maxwell/intr_gm107.c',
+	'nvidia/src/kernel/gpu/intr/arch/pascal/intr_gp100.c',
+	'nvidia/src/kernel/gpu/intr/arch/turing/intr_cpu_tu102.c',
+	'nvidia/src/kernel/gpu/intr/arch/turing/intr_nonstall_tu102.c',
+	'nvidia/src/kernel/gpu/intr/arch/turing/intr_sriov_tu102.c',
+	'nvidia/src/kernel/gpu/intr/arch/turing/intr_swintr_tu102.c',
+	'nvidia/src/kernel/gpu/intr/arch/turing/intr_tu102.c',
+	'nvidia/src/kernel/gpu/intr/intr.c',
+	'nvidia/src/kernel/gpu/intr/intr_service.c',
+	'nvidia/src/kernel/gpu/intr/intr_vgpu.c',
+	'nvidia/src/kernel/gpu/intr/swintr.c',
+	'nvidia/src/kernel/gpu/kern_gpu_power.c',
+	'nvidia/src/kernel/gpu/mc/arch/ampere/kernel_mc_ga100.c',
+	'nvidia/src/kernel/gpu/mc/arch/maxwell/kernel_mc_gm107.c',
+	'nvidia/src/kernel/gpu/mc/kernel_mc.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/ada/mem_mgr_ad102.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/ada/mem_mgr_ad104.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/ampere/fbsr_ga100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/ampere/mem_mgr_ga100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/ampere/mem_mgr_ga102.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/blackwell/mem_mgr_gb100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/blackwell/mem_mgr_gb202.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/blackwell/mem_mgr_gb202_base.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/blackwell/mem_mgr_gb20b.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/hopper/mem_utils_gh100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/hopper/virt_mem_allocator_gh100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/maxwell/fbsr_gm107.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/maxwell/mem_mgr_cmn_gm107.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/maxwell/mem_mgr_gm107.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/maxwell/mem_mgr_gm200.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/maxwell/mem_utils_gm107.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/maxwell/virt_mem_allocator_gm107.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/pascal/mem_mgr_gp100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/pascal/mem_mgr_scrub_gp100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/turing/mem_mgr_tu102.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/turing/mem_mgr_tu102_base.c',
+	'nvidia/src/kernel/gpu/mem_mgr/arch/volta/mem_mgr_gv100.c',
+	'nvidia/src/kernel/gpu/mem_mgr/ce_utils.c',
+	'nvidia/src/kernel/gpu/mem_mgr/channel_utils.c',
+	'nvidia/src/kernel/gpu/mem_mgr/context_dma.c',
+	'nvidia/src/kernel/gpu/mem_mgr/dma.c',
+	'nvidia/src/kernel/gpu/mem_mgr/fbsr.c',
+	'nvidia/src/kernel/gpu/mem_mgr/heap.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_ctrl.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_desc.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_mapper.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_mgr.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_mgr_ctrl.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_mgr_gsp_client.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_mgr_pwr_mgmt.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_mgr_regions.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_mgr_vgpu.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_scrub.c',
+	'nvidia/src/kernel/gpu/mem_mgr/mem_utils.c',
+	'nvidia/src/kernel/gpu/mem_mgr/method_notification.c',
+	'nvidia/src/kernel/gpu/mem_mgr/objheap.c',
+	'nvidia/src/kernel/gpu/mem_mgr/phys_mem_allocator/numa.c',
+	'nvidia/src/kernel/gpu/mem_mgr/phys_mem_allocator/phys_mem_allocator.c',
+	'nvidia/src/kernel/gpu/mem_mgr/phys_mem_allocator/phys_mem_allocator_util.c',
+	'nvidia/src/kernel/gpu/mem_mgr/phys_mem_allocator/regmap.c',
+	'nvidia/src/kernel/gpu/mem_mgr/sec2_utils.c',
+	'nvidia/src/kernel/gpu/mem_mgr/sem_surf.c',
+	'nvidia/src/kernel/gpu/mem_mgr/vaspace_api.c',
+	'nvidia/src/kernel/gpu/mem_mgr/virt_mem_allocator.c',
+	'nvidia/src/kernel/gpu/mem_mgr/virt_mem_allocator_vgpu.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/ampere/kern_mem_sys_ga100.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/ampere/kern_mem_sys_ga102.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/blackwell/kern_mem_sys_gb100.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/blackwell/kern_mem_sys_gb10b.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/hopper/kern_mem_sys_gh100.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/maxwell/kern_mem_sys_gm107.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/maxwell/kern_mem_sys_gm200.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/pascal/kern_mem_sys_gp102.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/turing/kern_mem_sys_tu102.c',
+	'nvidia/src/kernel/gpu/mem_sys/arch/volta/kern_mem_sys_gv100.c',
+	'nvidia/src/kernel/gpu/mem_sys/kern_mem_sys.c',
+	'nvidia/src/kernel/gpu/mem_sys/kern_mem_sys_ctrl.c',
+	'nvidia/src/kernel/gpu/mem_sys/zbc_api.c',
+	'nvidia/src/kernel/gpu/mig_mgr/arch/ampere/kmigmgr_ga100.c',
+	'nvidia/src/kernel/gpu/mig_mgr/arch/blackwell/kmigmgr_gb100.c',
+	'nvidia/src/kernel/gpu/mig_mgr/arch/blackwell/kmigmgr_gb10b.c',
+	'nvidia/src/kernel/gpu/mig_mgr/arch/blackwell/kmigmgr_gb202.c',
+	'nvidia/src/kernel/gpu/mig_mgr/arch/hopper/kmigmgr_gh100.c',
+	'nvidia/src/kernel/gpu/mig_mgr/compute_instance_subscription.c',
+	'nvidia/src/kernel/gpu/mig_mgr/gpu_instance_subscription.c',
+	'nvidia/src/kernel/gpu/mig_mgr/kernel_mig_manager.c',
+	'nvidia/src/kernel/gpu/mig_mgr/mig_config_session.c',
+	'nvidia/src/kernel/gpu/mig_mgr/mig_monitor_session.c',
+	'nvidia/src/kernel/gpu/mmu/arch/ampere/kern_gmmu_fmt_ga10x.c',
+	'nvidia/src/kernel/gpu/mmu/arch/ampere/kern_gmmu_ga100.c',
+	'nvidia/src/kernel/gpu/mmu/arch/ampere/kern_gmmu_ga10b.c',
+	'nvidia/src/kernel/gpu/mmu/arch/blackwell/kern_gmmu_fmt_gb10x.c',
+	'nvidia/src/kernel/gpu/mmu/arch/blackwell/kern_gmmu_gb100.c',
+	'nvidia/src/kernel/gpu/mmu/arch/hopper/kern_gmmu_fmt_gh10x.c',
+	'nvidia/src/kernel/gpu/mmu/arch/hopper/kern_gmmu_gh100.c',
+	'nvidia/src/kernel/gpu/mmu/arch/maxwell/kern_gmmu_fmt_gm10x.c',
+	'nvidia/src/kernel/gpu/mmu/arch/maxwell/kern_gmmu_fmt_gm20x.c',
+	'nvidia/src/kernel/gpu/mmu/arch/maxwell/kern_gmmu_gm107.c',
+	'nvidia/src/kernel/gpu/mmu/arch/maxwell/kern_gmmu_gm200.c',
+	'nvidia/src/kernel/gpu/mmu/arch/pascal/kern_gmmu_fmt_gp10x.c',
+	'nvidia/src/kernel/gpu/mmu/arch/pascal/kern_gmmu_gp100.c',
+	'nvidia/src/kernel/gpu/mmu/arch/turing/kern_gmmu_fmt_tu10x.c',
+	'nvidia/src/kernel/gpu/mmu/arch/turing/kern_gmmu_tu102.c',
+	'nvidia/src/kernel/gpu/mmu/arch/volta/kern_gmmu_gv100.c',
+	'nvidia/src/kernel/gpu/mmu/bar2_walk.c',
+	'nvidia/src/kernel/gpu/mmu/fault_buffer_ctrl.c',
+	'nvidia/src/kernel/gpu/mmu/gmmu_trace.c',
+	'nvidia/src/kernel/gpu/mmu/gmmu_walk.c',
+	'nvidia/src/kernel/gpu/mmu/kern_gmmu.c',
+	'nvidia/src/kernel/gpu/mmu/mmu_fault_buffer.c',
+	'nvidia/src/kernel/gpu/mmu/mmu_fault_buffer_ctrl.c',
+	'nvidia/src/kernel/gpu/mmu/mmu_trace.c',
+	'nvidia/src/kernel/gpu/mmu/uvm_sw.c',
+	'nvidia/src/kernel/gpu/nvdec/kernel_nvdec_ctx.c',
+	'nvidia/src/kernel/gpu/nvdec/kernel_nvdec_engdesc.c',
+	'nvidia/src/kernel/gpu/nvenc/kernel_nvenc_ctx.c',
+	'nvidia/src/kernel/gpu/nvenc/kernel_nvenc_engdesc.c',
+	'nvidia/src/kernel/gpu/nvenc/nvencsession.c',
+	'nvidia/src/kernel/gpu/nvenc/nvencsessionctrl.c',
+	'nvidia/src/kernel/gpu/nvjpg/kernel_nvjpg_ctx.c',
+	'nvidia/src/kernel/gpu/nvjpg/kernel_nvjpg_engdesc.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/ampere/kernel_nvlink_ga100.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/blackwell/kernel_nvle_gb100.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/blackwell/kernel_nvlink_gb100.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/hopper/kernel_nvlink_gh100.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/pascal/kernel_nvlink_gp100.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/turing/kernel_nvlink_tu102.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/volta/kernel_minion_gv100.c',
+	'nvidia/src/kernel/gpu/nvlink/arch/volta/kernel_nvlink_gv100.c',
+	'nvidia/src/kernel/gpu/nvlink/common_nvlinkapi.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_ioctrl.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_nvlink.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_nvlinkapi.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_nvlinkcorelib.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_nvlinkcorelibcallback.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_nvlinkcorelibtrain.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_nvlinkoverrides.c',
+	'nvidia/src/kernel/gpu/nvlink/kernel_nvlinkstate.c',
+	'nvidia/src/kernel/gpu/ofa/kernel_ofa_ctx.c',
+	'nvidia/src/kernel/gpu/ofa/kernel_ofa_engdesc.c',
+	'nvidia/src/kernel/gpu/perf/kern_cuda_limit.c',
+	'nvidia/src/kernel/gpu/perf/kern_perf.c',
+	'nvidia/src/kernel/gpu/perf/kern_perf_boost.c',
+	'nvidia/src/kernel/gpu/perf/kern_perf_ctrl.c',
+	'nvidia/src/kernel/gpu/perf/kern_perf_gpuboostsync.c',
+	'nvidia/src/kernel/gpu/perf/kern_perf_pm.c',
+	'nvidia/src/kernel/gpu/perf/kern_perf_pwr.c',
+	'nvidia/src/kernel/gpu/perf/kern_perfbuffer.c',
+	'nvidia/src/kernel/gpu/pmu/kern_pmu.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc_callback.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc_ctrl.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc_misc.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc_notification.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc_watchdog.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc_watchdog_callback.c',
+	'nvidia/src/kernel/gpu/rc/kernel_rc_watchdog_ctrl.c',
+	'nvidia/src/kernel/gpu/sec2/arch/ampere/kernel_sec2_ga100.c',
+	'nvidia/src/kernel/gpu/sec2/arch/ampere/kernel_sec2_ga102.c',
+	'nvidia/src/kernel/gpu/sec2/arch/hopper/kernel_sec2_gh100.c',
+	'nvidia/src/kernel/gpu/sec2/arch/turing/kernel_sec2_tu102.c',
+	'nvidia/src/kernel/gpu/sec2/kernel_sec2.c',
+	'nvidia/src/kernel/gpu/sec2/sec2_context.c',
+	'nvidia/src/kernel/gpu/spdm/arch/blackwell/spdm_certs_gb100.c',
+	'nvidia/src/kernel/gpu/spdm/arch/hopper/spdm_certs_gh100.c',
+	'nvidia/src/kernel/gpu/spdm/arch/hopper/spdm_gh100.c',
+	'nvidia/src/kernel/gpu/spdm/kernel_spdm.c',
+	'nvidia/src/kernel/gpu/spdm/spdm.c',
+	'nvidia/src/kernel/gpu/spdm_proxy/spdm_proxy.c',
+	'nvidia/src/kernel/gpu/subdevice/generic_engine.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_event_kernel.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_fla.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_gpu_kernel.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_gpu_regops.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_gpu_smc.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_internal_kernel.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_nvd.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_timer_kernel.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_ctrl_vgpu.c',
+	'nvidia/src/kernel/gpu/subdevice/subdevice_diag.c',
+	'nvidia/src/kernel/gpu/sw_eng.c',
+	'nvidia/src/kernel/gpu/sw_test.c',
+	'nvidia/src/kernel/gpu/timed_semaphore.c',
+	'nvidia/src/kernel/gpu/timer/arch/ampere/timer_ga100.c',
+	'nvidia/src/kernel/gpu/timer/arch/hopper/timer_gh100.c',
+	'nvidia/src/kernel/gpu/timer/arch/maxwell/timer_gm107.c',
+	'nvidia/src/kernel/gpu/timer/arch/maxwell/timer_gm200.c',
+	'nvidia/src/kernel/gpu/timer/arch/turing/timer_tu102.c',
+	'nvidia/src/kernel/gpu/timer/arch/volta/timer_gv100.c',
+	'nvidia/src/kernel/gpu/timer/timer.c',
+	'nvidia/src/kernel/gpu/timer/timer_ostimer.c',
+	'nvidia/src/kernel/gpu/timer/timer_ptimer.c',
+	'nvidia/src/kernel/gpu/uvm/access_cntr_buffer.c',
+	'nvidia/src/kernel/gpu/uvm/access_cntr_buffer_ctrl.c',
+	'nvidia/src/kernel/gpu/uvm/arch/blackwell/uvm_gb100.c',
+	'nvidia/src/kernel/gpu/uvm/arch/turing/uvm_tu102.c',
+	'nvidia/src/kernel/gpu/uvm/arch/volta/uvm_gv100.c',
+	'nvidia/src/kernel/gpu/uvm/uvm.c',
+	'nvidia/src/kernel/gpu/video/kernel_video_engine.c',
+	'nvidia/src/kernel/gpu_mgr/gpu_db.c',
+	'nvidia/src/kernel/gpu_mgr/gpu_group.c',
+	'nvidia/src/kernel/gpu_mgr/gpu_mgmt_api.c',
+	'nvidia/src/kernel/gpu_mgr/gpu_mgr.c',
+	'nvidia/src/kernel/gpu_mgr/gpu_mgr_sli.c',
+	'nvidia/src/kernel/mem_mgr/console_mem.c',
+	'nvidia/src/kernel/mem_mgr/ctx_buf_pool.c',
+	'nvidia/src/kernel/mem_mgr/egm_mem.c',
+	'nvidia/src/kernel/mem_mgr/fabric_vaspace.c',
+	'nvidia/src/kernel/mem_mgr/fla_mem.c',
+	'nvidia/src/kernel/mem_mgr/gpu_vaspace.c',
+	'nvidia/src/kernel/mem_mgr/hw_resources.c',
+	'nvidia/src/kernel/mem_mgr/io_vaspace.c',
+	'nvidia/src/kernel/mem_mgr/mem.c',
+	'nvidia/src/kernel/mem_mgr/mem_export.c',
+	'nvidia/src/kernel/mem_mgr/mem_fabric.c',
+	'nvidia/src/kernel/mem_mgr/mem_fabric_import_ref.c',
+	'nvidia/src/kernel/mem_mgr/mem_fabric_import_v2.c',
+	'nvidia/src/kernel/mem_mgr/mem_list.c',
+	'nvidia/src/kernel/mem_mgr/mem_multicast_fabric.c',
+	'nvidia/src/kernel/mem_mgr/no_device_mem.c',
+	'nvidia/src/kernel/mem_mgr/os_desc_mem.c',
+	'nvidia/src/kernel/mem_mgr/phys_mem.c',
+	'nvidia/src/kernel/mem_mgr/pool_alloc.c',
+	'nvidia/src/kernel/mem_mgr/reg_mem.c',
+	'nvidia/src/kernel/mem_mgr/standard_mem.c',
+	'nvidia/src/kernel/mem_mgr/syncpoint_mem.c',
+	'nvidia/src/kernel/mem_mgr/system_mem.c',
+	'nvidia/src/kernel/mem_mgr/vaddr_list.c',
+	'nvidia/src/kernel/mem_mgr/vaspace.c',
+	'nvidia/src/kernel/mem_mgr/video_mem.c',
+	'nvidia/src/kernel/mem_mgr/virt_mem_mgr.c',
+	'nvidia/src/kernel/mem_mgr/virt_mem_range.c',
+	'nvidia/src/kernel/mem_mgr/virtual_mem.c',
+	'nvidia/src/kernel/os/os_init.c',
+	'nvidia/src/kernel/os/os_sanity.c',
+	'nvidia/src/kernel/os/os_stubs.c',
+	'nvidia/src/kernel/os/os_timer.c',
+	'nvidia/src/kernel/platform/acpi_common.c',
+	'nvidia/src/kernel/platform/chipset/chipset.c',
+	'nvidia/src/kernel/platform/chipset/chipset_info.c',
+	'nvidia/src/kernel/platform/chipset/chipset_pcie.c',
+	'nvidia/src/kernel/platform/chipset/pci_pbi.c',
+	'nvidia/src/kernel/platform/cpu.c',
+	'nvidia/src/kernel/platform/guids.c',
+	'nvidia/src/kernel/platform/hwbc.c',
+	'nvidia/src/kernel/platform/nbsi/nbsi_getv.c',
+	'nvidia/src/kernel/platform/nbsi/nbsi_init.c',
+	'nvidia/src/kernel/platform/nbsi/nbsi_osrg.c',
+	'nvidia/src/kernel/platform/p2p/p2p_caps.c',
+	'nvidia/src/kernel/platform/platform.c',
+	'nvidia/src/kernel/platform/platform_request_handler.c',
+	'nvidia/src/kernel/platform/platform_request_handler_ctrl.c',
+	'nvidia/src/kernel/platform/sli/sli.c',
+	'nvidia/src/kernel/power/gpu_boost_mgr.c',
+	'nvidia/src/kernel/rmapi/alloc_free.c',
+	'nvidia/src/kernel/rmapi/binary_api.c',
+	'nvidia/src/kernel/rmapi/client.c',
+	'nvidia/src/kernel/rmapi/client_resource.c',
+	'nvidia/src/kernel/rmapi/client_resource_sli.c',
+	'nvidia/src/kernel/rmapi/control.c',
+	'nvidia/src/kernel/rmapi/deprecated_context.c',
+	'nvidia/src/kernel/rmapi/embedded_param_copy.c',
+	'nvidia/src/kernel/rmapi/entry_points.c',
+	'nvidia/src/kernel/rmapi/event.c',
+	'nvidia/src/kernel/rmapi/event_buffer.c',
+	'nvidia/src/kernel/rmapi/event_notification.c',
+	'nvidia/src/kernel/rmapi/lock_stress.c',
+	'nvidia/src/kernel/rmapi/lock_test.c',
+	'nvidia/src/kernel/rmapi/mapping.c',
+	'nvidia/src/kernel/rmapi/mapping_cpu.c',
+	'nvidia/src/kernel/rmapi/mapping_list.c',
+	'nvidia/src/kernel/rmapi/nv_gpu_ops.c',
+	'nvidia/src/kernel/rmapi/param_copy.c',
+	'nvidia/src/kernel/rmapi/resource.c',
+	'nvidia/src/kernel/rmapi/resource_desc.c',
+	'nvidia/src/kernel/rmapi/rmapi.c',
+	'nvidia/src/kernel/rmapi/rmapi_cache.c',
+	'nvidia/src/kernel/rmapi/rmapi_cache_handlers.c',
+	'nvidia/src/kernel/rmapi/rmapi_finn.c',
+	'nvidia/src/kernel/rmapi/rmapi_specific.c',
+	'nvidia/src/kernel/rmapi/rmapi_stubs.c',
+	'nvidia/src/kernel/rmapi/rmapi_utils.c',
+	'nvidia/src/kernel/rmapi/rpc_common.c',
+	'nvidia/src/kernel/rmapi/rs_utils.c',
+	'nvidia/src/kernel/rmapi/sharing.c',
+	'nvidia/src/kernel/vgpu/arch/ampere/rpcga102.c',
+	'nvidia/src/kernel/vgpu/arch/maxwell/rpcgm204.c',
+	'nvidia/src/kernel/vgpu/objvgpu.c',
+	'nvidia/src/kernel/vgpu/rpc.c',
+	'nvidia/src/kernel/vgpu/rpcstructurecopy.c',
+	'nvidia/src/kernel/vgpu/vgpu_events.c',
+	'nvidia/src/kernel/vgpu/vgpu_util.c',
+	'nvidia/src/kernel/vgpu/vgpuapi.c',
+	'nvidia/src/kernel/vgpu/vgpuctrl.c',
+	'nvidia/src/kernel/virtualization/common_vgpu_mgr.c',
+	'nvidia/src/kernel/virtualization/hypervisor/hyperv/hyperv.c',
+	'nvidia/src/kernel/virtualization/hypervisor/hypervisor.c',
+	'nvidia/src/kernel/virtualization/hypervisor/hypervisor_access.c',
+	'nvidia/src/kernel/virtualization/hypervisor/kvm/kvm.c',
+	'nvidia/src/kernel/virtualization/hypervisor/vmware/vmware.c',
+	'nvidia/src/kernel/virtualization/hypervisor/xen/xen.c',
+	'nvidia/src/kernel/virtualization/kernel_hostvgpudeviceapi.c',
+	'nvidia/src/kernel/virtualization/kernel_vgpu_mgr.c',
+	'nvidia/src/kernel/virtualization/vgpuconfigapi.c',
+)
+
+nvidia_libraries_src = files(
+	'nvidia/src/lib/base_utils.c',
+	'nvidia/src/lib/protobuf/prbenc.c',
+	'nvidia/src/lib/protobuf/prbutil.c',
+	'nvidia/src/lib/ref_count.c',
+	'nvidia/src/lib/zlib/inflate.c',
+	'nvidia/src/libraries/containers/btree/btree.c',
+	'nvidia/src/libraries/containers/eheap/eheap_old.c',
+	'nvidia/src/libraries/containers/list.c',
+	'nvidia/src/libraries/containers/map.c',
+	'nvidia/src/libraries/containers/multimap.c',
+	'nvidia/src/libraries/containers/queue.c',
+	'nvidia/src/libraries/containers/ringbuf.c',
+	'nvidia/src/libraries/containers/vector.c',
+	'nvidia/src/libraries/crashcat/crashcat_engine.c',
+	'nvidia/src/libraries/crashcat/crashcat_queue.c',
+	'nvidia/src/libraries/crashcat/crashcat_report.c',
+	'nvidia/src/libraries/crashcat/crashcat_wayfinder.c',
+	'nvidia/src/libraries/crashcat/v1/crashcat_queue_v1.c',
+	'nvidia/src/libraries/crashcat/v1/crashcat_report_v1.c',
+	'nvidia/src/libraries/crashcat/v1/crashcat_wayfinder_v1.c',
+	'nvidia/src/libraries/crashcat/v1/impl/crashcat_report_v1_generic.c',
+	'nvidia/src/libraries/crashcat/v1/impl/crashcat_report_v1_libos2.c',
+	'nvidia/src/libraries/crashcat/v1/impl/crashcat_report_v1_libos3.c',
+	'nvidia/src/libraries/eventbuffer/eventbufferproducer.c',
+	'nvidia/src/libraries/fnv_hash/fnv_hash.c',
+	'nvidia/src/libraries/ioaccess/ioaccess.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_common_lib/libspdm_com_context_data.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_common_lib/libspdm_com_context_data_session.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_common_lib/libspdm_com_crypto_service.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_common_lib/libspdm_com_crypto_service_session.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_common_lib/libspdm_com_msg_log.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_common_lib/libspdm_com_opaque_data.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_common_lib/libspdm_com_support.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_aead.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_asym.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_cert.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_dhe.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_hash.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_hkdf.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_hmac.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_crypt_lib/libspdm_crypt_rng.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_common.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_communication.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_encap_certificate.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_encap_digests.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_encap_error.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_encap_key_update.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_encap_request.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_end_session.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_finish.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_get_capabilities.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_get_certificate.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_get_digests.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_get_measurements.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_get_version.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_handle_error_response.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_heartbeat.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_key_exchange.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_key_update.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_negotiate_algorithms.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_requester_lib/libspdm_req_send_receive.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_secured_message_lib/libspdm_secmes_context_data.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_secured_message_lib/libspdm_secmes_encode_decode.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_secured_message_lib/libspdm_secmes_key_exchange.c',
+	'nvidia/src/libraries/libspdm/3.1.1/library/spdm_secured_message_lib/libspdm_secmes_session.c',
+	'nvidia/src/libraries/libspdm/3.1.1/os_stub/memlib/compare_mem.c',
+	'nvidia/src/libraries/libspdm/3.1.1/os_stub/platform_lib_null/time_linux.c',
+	'nvidia/src/libraries/libspdm/3.1.1/os_stub/spdm_device_secret_lib_null/lib.c',
+	'nvidia/src/libraries/libspdm/nvidia/nvspdm_crypt_null.c',
+	'nvidia/src/libraries/libspdm/nvidia/nvspdm_debuglib.c',
+	'nvidia/src/libraries/libspdm/nvidia/nvspdm_malloclib.c',
+	'nvidia/src/libraries/libspdm/nvidia/nvspdm_memlib.c',
+	'nvidia/src/libraries/libspdm/nvidia/nvspdm_rng.c',
+	'nvidia/src/libraries/libspdm/nvidia/nvspdm_rsa.c',
+	'nvidia/src/libraries/mapping_reuse/mapping_reuse.c',
+	'nvidia/src/libraries/mmu/gmmu_fmt.c',
+	'nvidia/src/libraries/mmu/mmu_fmt.c',
+	'nvidia/src/libraries/mmu/mmu_walk.c',
+	'nvidia/src/libraries/mmu/mmu_walk_commit.c',
+	'nvidia/src/libraries/mmu/mmu_walk_fill.c',
+	'nvidia/src/libraries/mmu/mmu_walk_info.c',
+	'nvidia/src/libraries/mmu/mmu_walk_map.c',
+	'nvidia/src/libraries/mmu/mmu_walk_migrate.c',
+	'nvidia/src/libraries/mmu/mmu_walk_reserve.c',
+	'nvidia/src/libraries/mmu/mmu_walk_sparse.c',
+	'nvidia/src/libraries/mmu/mmu_walk_unmap.c',
+	'nvidia/src/libraries/nvbitvector/nvbitvector.c',
+	'nvidia/src/libraries/nvoc/src/runtime.c',
+	'nvidia/src/libraries/nvport/core/core.c',
+	'nvidia/src/libraries/nvport/cpu/cpu_common.c',
+	'nvidia/src/libraries/nvport/cpu/cpu_x86_amd64.c',
+	'nvidia/src/libraries/nvport/crypto/crypto_random_xorshift.c',
+	'nvidia/src/libraries/nvport/memory/memory_tracking.c',
+	'nvidia/src/libraries/nvport/memory/memory_unix_kernel_os.c',
+	'nvidia/src/libraries/nvport/string/string_generic.c',
+	'nvidia/src/libraries/nvport/sync/sync_unix_kernel_os.c',
+	'nvidia/src/libraries/nvport/thread/thread_unix_kernel_os.c',
+	'nvidia/src/libraries/nvport/util/util_gcc_clang.c',
+	'nvidia/src/libraries/nvport/util/util_unix_kernel_os.c',
+	'nvidia/src/libraries/poolalloc/poolalloc.c',
+	'nvidia/src/libraries/prereq_tracker/prereq_tracker.c',
+	'nvidia/src/libraries/resserv/src/rs_access_map.c',
+	'nvidia/src/libraries/resserv/src/rs_access_rights.c',
+	'nvidia/src/libraries/resserv/src/rs_client.c',
+	'nvidia/src/libraries/resserv/src/rs_domain.c',
+	'nvidia/src/libraries/resserv/src/rs_resource.c',
+	'nvidia/src/libraries/resserv/src/rs_server.c',
+	'nvidia/src/libraries/tls/tls.c',
+	'nvidia/src/libraries/utils/nvassert.c',
+)
+
+subdir('nvidia')
+subdir('nvidia-modeset')
diff --git a/src/nvidia-modeset/meson.build b/src/nvidia-modeset/meson.build
new file mode 100644
index 0000000..13ff8b0
--- /dev/null
+++ b/src/nvidia-modeset/meson.build
@@ -0,0 +1,331 @@
+modeset_src = files(
+	'../common/shared/nvstatus/nvstatus.c',
+	'../common/softfloat/source/8086-SSE/s_commonNaNToF16UI.c',
+	'../common/softfloat/source/8086-SSE/s_commonNaNToF32UI.c',
+	'../common/softfloat/source/8086-SSE/s_commonNaNToF64UI.c',
+	'../common/softfloat/source/8086-SSE/s_f16UIToCommonNaN.c',
+	'../common/softfloat/source/8086-SSE/s_f32UIToCommonNaN.c',
+	'../common/softfloat/source/8086-SSE/s_f64UIToCommonNaN.c',
+	'../common/softfloat/source/8086-SSE/s_propagateNaNF32UI.c',
+	'../common/softfloat/source/8086-SSE/s_propagateNaNF64UI.c',
+	'../common/softfloat/source/8086-SSE/softfloat_raiseFlags.c',
+	'../common/softfloat/source/f16_to_f32.c',
+	'../common/softfloat/source/f32_add.c',
+	'../common/softfloat/source/f32_div.c',
+	'../common/softfloat/source/f32_eq.c',
+	'../common/softfloat/source/f32_eq_signaling.c',
+	'../common/softfloat/source/f32_isSignalingNaN.c',
+	'../common/softfloat/source/f32_le.c',
+	'../common/softfloat/source/f32_le_quiet.c',
+	'../common/softfloat/source/f32_lt.c',
+	'../common/softfloat/source/f32_lt_quiet.c',
+	'../common/softfloat/source/f32_mul.c',
+	'../common/softfloat/source/f32_mulAdd.c',
+	'../common/softfloat/source/f32_rem.c',
+	'../common/softfloat/source/f32_roundToInt.c',
+	'../common/softfloat/source/f32_sqrt.c',
+	'../common/softfloat/source/f32_sub.c',
+	'../common/softfloat/source/f32_to_f16.c',
+	'../common/softfloat/source/f32_to_f64.c',
+	'../common/softfloat/source/f32_to_i32.c',
+	'../common/softfloat/source/f32_to_i32_r_minMag.c',
+	'../common/softfloat/source/f32_to_i64.c',
+	'../common/softfloat/source/f32_to_i64_r_minMag.c',
+	'../common/softfloat/source/f32_to_ui32.c',
+	'../common/softfloat/source/f32_to_ui32_r_minMag.c',
+	'../common/softfloat/source/f32_to_ui64.c',
+	'../common/softfloat/source/f32_to_ui64_r_minMag.c',
+	'../common/softfloat/source/f64_add.c',
+	'../common/softfloat/source/f64_div.c',
+	'../common/softfloat/source/f64_eq.c',
+	'../common/softfloat/source/f64_eq_signaling.c',
+	'../common/softfloat/source/f64_isSignalingNaN.c',
+	'../common/softfloat/source/f64_le.c',
+	'../common/softfloat/source/f64_le_quiet.c',
+	'../common/softfloat/source/f64_lt.c',
+	'../common/softfloat/source/f64_lt_quiet.c',
+	'../common/softfloat/source/f64_mul.c',
+	'../common/softfloat/source/f64_mulAdd.c',
+	'../common/softfloat/source/f64_rem.c',
+	'../common/softfloat/source/f64_roundToInt.c',
+	'../common/softfloat/source/f64_sqrt.c',
+	'../common/softfloat/source/f64_sub.c',
+	'../common/softfloat/source/f64_to_f32.c',
+	'../common/softfloat/source/f64_to_i32.c',
+	'../common/softfloat/source/f64_to_i32_r_minMag.c',
+	'../common/softfloat/source/f64_to_i64.c',
+	'../common/softfloat/source/f64_to_i64_r_minMag.c',
+	'../common/softfloat/source/f64_to_ui32.c',
+	'../common/softfloat/source/f64_to_ui32_r_minMag.c',
+	'../common/softfloat/source/f64_to_ui64.c',
+	'../common/softfloat/source/f64_to_ui64_r_minMag.c',
+	'../common/softfloat/source/i32_to_f32.c',
+	'../common/softfloat/source/i32_to_f64.c',
+	'../common/softfloat/source/i64_to_f32.c',
+	'../common/softfloat/source/i64_to_f64.c',
+	'../common/softfloat/source/s_addMagsF32.c',
+	'../common/softfloat/source/s_addMagsF64.c',
+	'../common/softfloat/source/s_approxRecipSqrt32_1.c',
+	'../common/softfloat/source/s_approxRecipSqrt_1Ks.c',
+	'../common/softfloat/source/s_countLeadingZeros64.c',
+	'../common/softfloat/source/s_countLeadingZeros8.c',
+	'../common/softfloat/source/s_mul64To128.c',
+	'../common/softfloat/source/s_mulAddF32.c',
+	'../common/softfloat/source/s_mulAddF64.c',
+	'../common/softfloat/source/s_normRoundPackToF32.c',
+	'../common/softfloat/source/s_normRoundPackToF64.c',
+	'../common/softfloat/source/s_normSubnormalF16Sig.c',
+	'../common/softfloat/source/s_normSubnormalF32Sig.c',
+	'../common/softfloat/source/s_normSubnormalF64Sig.c',
+	'../common/softfloat/source/s_roundPackToF16.c',
+	'../common/softfloat/source/s_roundPackToF32.c',
+	'../common/softfloat/source/s_roundPackToF64.c',
+	'../common/softfloat/source/s_roundToI32.c',
+	'../common/softfloat/source/s_roundToI64.c',
+	'../common/softfloat/source/s_roundToUI32.c',
+	'../common/softfloat/source/s_roundToUI64.c',
+	'../common/softfloat/source/s_shiftRightJam128.c',
+	'../common/softfloat/source/s_subMagsF32.c',
+	'../common/softfloat/source/s_subMagsF64.c',
+	'../common/softfloat/source/softfloat_state.c',
+	'../common/softfloat/source/ui32_to_f32.c',
+	'../common/softfloat/source/ui32_to_f64.c',
+	'../common/softfloat/source/ui64_to_f32.c',
+	'../common/softfloat/source/ui64_to_f64.c',
+	'../common/src/nv_smg.c',
+	'../common/displayport/src/dp_auxretry.cpp',
+	'../common/displayport/src/dp_bitstream.cpp',
+	'../common/displayport/src/dp_buffer.cpp',
+	'../common/displayport/src/dp_configcaps.cpp',
+	'../common/displayport/src/dp_configcaps2x.cpp',
+	'../common/displayport/src/dp_connectorimpl.cpp',
+	'../common/displayport/src/dp_connectorimpl2x.cpp',
+	'../common/displayport/src/dp_crc.cpp',
+	'../common/displayport/src/dp_deviceimpl.cpp',
+	'../common/displayport/src/dp_discovery.cpp',
+	'../common/displayport/src/dp_edid.cpp',
+	'../common/displayport/src/dp_evoadapter.cpp',
+	'../common/displayport/src/dp_evoadapter2x.cpp',
+	'../common/displayport/src/dp_groupimpl.cpp',
+	'../common/displayport/src/dp_guid.cpp',
+	'../common/displayport/src/dp_linkconfig.cpp',
+	'../common/displayport/src/dp_list.cpp',
+	'../common/displayport/src/dp_merger.cpp',
+	'../common/displayport/src/dp_messagecodings.cpp',
+	'../common/displayport/src/dp_messageheader.cpp',
+	'../common/displayport/src/dp_messages.cpp',
+	'../common/displayport/src/dp_mst_edid.cpp',
+	'../common/displayport/src/dp_splitter.cpp',
+	'../common/displayport/src/dp_sst_edid.cpp',
+	'../common/displayport/src/dp_timer.cpp',
+	'../common/displayport/src/dp_vrr.cpp',
+	'../common/displayport/src/dp_wardatabase.cpp',
+	'../common/displayport/src/dp_watermark.cpp',
+	'../common/displayport/src/dptestutil/dp_testmessage.cpp',
+	'../common/modeset/hdmipacket/nvhdmipkt.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_0073.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_9171.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_9271.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_9471.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_9571.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_C371.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_C671.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_C771.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_C871.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_C971.c',
+	'../common/modeset/hdmipacket/nvhdmipkt_CA71.c',
+	'../common/modeset/timing/nvt_cvt.c',
+	'../common/modeset/timing/nvt_displayid20.c',
+	'../common/modeset/timing/nvt_dmt.c',
+	'../common/modeset/timing/nvt_dsc_pps.c',
+	'../common/modeset/timing/nvt_edid.c',
+	'../common/modeset/timing/nvt_edidext_861.c',
+	'../common/modeset/timing/nvt_edidext_displayid.c',
+	'../common/modeset/timing/nvt_edidext_displayid20.c',
+	'../common/modeset/timing/nvt_gtf.c',
+	'../common/modeset/timing/nvt_ovt.c',
+	'../common/modeset/timing/nvt_tv.c',
+	'../common/modeset/timing/nvt_util.c',
+	'../common/unix/common/utils/nv_memory_tracker.c',
+	'../common/unix/common/utils/nv_mode_timings_utils.c',
+	'../common/unix/common/utils/nv_vasprintf.c',
+	'../common/unix/common/utils/unix_rm_handle.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-core.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-fermi.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-hopper.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-init.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-kepler.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-maxwell.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-pascal.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-surface.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-turing.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-vertex-arrays.c',
+	'../common/unix/nvidia-3d/src/nvidia-3d-volta.c',
+	'../common/unix/nvidia-push/src/nvidia-push-init.c',
+	'../common/unix/nvidia-push/src/nvidia-push.c',
+	'kapi/src/nvkms-kapi-notifiers.c',
+	'kapi/src/nvkms-kapi-sync.c',
+	'kapi/src/nvkms-kapi.c',
+	'lib/nvkms-format.c',
+	'lib/nvkms-sync.c',
+	'src/dp/nvdp-connector-event-sink.cpp',
+	'src/dp/nvdp-connector.cpp',
+	'src/dp/nvdp-device.cpp',
+	'src/dp/nvdp-evo-interface.cpp',
+	'src/dp/nvdp-host.cpp',
+	'src/dp/nvdp-timer.cpp',
+	'src/g_nvkms-evo-states.c',
+	'src/nvkms-3dvision.c',
+	'src/nvkms-attributes.c',
+	'src/nvkms-conf.c',
+	'src/nvkms-console-restore.c',
+	'src/nvkms-ctxdma.c',
+	'src/nvkms-cursor.c',
+	'src/nvkms-cursor2.c',
+	'src/nvkms-cursor3.c',
+	'src/nvkms-difr.c',
+	'src/nvkms-dma.c',
+	'src/nvkms-dpy-override.c',
+	'src/nvkms-dpy.c',
+	'src/nvkms-event.c',
+	'src/nvkms-evo.c',
+	'src/nvkms-evo1.c',
+	'src/nvkms-evo2.c',
+	'src/nvkms-evo3.c',
+	'src/nvkms-evo4.c',
+	'src/nvkms-flip.c',
+	'src/nvkms-framelock.c',
+	'src/nvkms-hal.c',
+	'src/nvkms-hdmi.c',
+	'src/nvkms-headsurface-3d.c',
+	'src/nvkms-headsurface-config.c',
+	'src/nvkms-headsurface-ioctl.c',
+	'src/nvkms-headsurface-matrix.c',
+	'src/nvkms-headsurface-swapgroup.c',
+	'src/nvkms-headsurface.c',
+	'src/nvkms-hw-flip.c',
+	'src/nvkms-hw-states.c',
+	'src/nvkms-lut.c',
+	'src/nvkms-modepool.c',
+	'src/nvkms-modeset.c',
+	'src/nvkms-pow.c',
+	'src/nvkms-prealloc.c',
+	'src/nvkms-push.c',
+	'src/nvkms-rm.c',
+	'src/nvkms-rmapi-dgpu.c',
+	'src/nvkms-stereo.c',
+	'src/nvkms-surface.c',
+	'src/nvkms-utils-flip.c',
+	'src/nvkms-utils.c',
+	'src/nvkms-vblank-sem-control.c',
+	'src/nvkms-vrr.c',
+	'src/nvkms.c',
+	'../common/unix/xzminidec/src/xz_crc32.c',
+	'../common/unix/xzminidec/src/xz_dec_bcj.c',
+	'../common/unix/xzminidec/src/xz_dec_lzma2.c',
+	'../common/unix/xzminidec/src/xz_dec_stream.c',
+)
+
+modeset_inc = include_directories(
+	'../nvidia/arch/nvalloc/unix/include',
+	'interface',
+	'os-interface/include',
+	'kapi/interface',
+	'include',
+	'kapi/include',
+	'../common/displayport/inc',
+	'../common/displayport/inc/dptestutil',
+	'../common/inc/displayport',
+	'../common/unix/nvidia-3d/interface',
+	'../common/unix/nvidia-push/interface',
+	'../common/unix/nvidia-3d/include',
+	'../common/unix/nvidia-push/include',
+	'../common/unix/xzminidec/interface',
+	'../common/unix/nvidia-headsurface',
+	'src/shaders',
+)
+
+defines = [
+	'-DNV_LINUX',
+	'-DNV_X86_64',
+	'-DNV_ARCH_BITS=64',
+	'-include', '../common/sdk/nvidia/inc/cpuopsys.h',
+	'-D_LANGUAGE_C',
+	'-D__NO_CTYPE',
+	'-DNVRM',
+	'-DLOCK_VAL_ENABLED=0',
+	'-DPORT_ATOMIC_64_BIT_SUPPORTED=1',
+	'-DPORT_IS_KERNEL_BUILD=1',
+	'-DPORT_IS_CHECKED_BUILD=1',
+	'-DPORT_MODULE_atomic=1',
+	'-DPORT_MODULE_core=1',
+	'-DPORT_MODULE_cpu=1',
+	'-DPORT_MODULE_crypto=1',
+	'-DPORT_MODULE_debug=1',
+	'-DPORT_MODULE_memory=1',
+	'-DPORT_MODULE_safe=1',
+	'-DPORT_MODULE_string=1',
+	'-DPORT_MODULE_sync=1',
+	'-DPORT_MODULE_thread=1',
+	'-DPORT_MODULE_util=1',
+	'-DPORT_MODULE_example=0',
+	'-DPORT_MODULE_mmio=0',
+	'-DPORT_MODULE_time=0',
+	'-DRS_STANDALONE=0',
+	'-DRS_STANDALONE_TEST=0',
+	'-DRS_COMPATABILITY_MODE=1',
+	'-DRS_PROVIDES_API_STATE=0',
+	'-DNV_CONTAINERS_NO_TEMPLATES',
+	'-DINCLUDE_NVLINK_LIB',
+	'-DINCLUDE_NVSWITCH_LIB',
+	'-DNV_PRINTF_STRINGS_ALLOWED=1',
+	'-DNV_ASSERT_FAILED_USES_STRINGS=1',
+	'-DPORT_ASSERT_FAILED_USES_STRINGS=1',
+	'-DLIBSPDM_CONFIG="nvspdm_rmconfig.h"',
+	'-DSOFTFLOAT_ROUND_ODD',
+	'-DSOFTFLOAT_FAST_DIV32TO16',
+	'-DSOFTFLOAT_FAST_DIV64TO32',
+	'-DNV_CPU_INTRINSICS_KERNEL',
+	'-DNVHDMIPKT_RM_CALLS_INTERNAL=0',
+	'-DNVT_USE_NVKMS',
+	'-DNV_SMG_IN_NVKMS',
+	'-DNV_PUSH_IN_KERNEL',
+	'-DNV_XZ_CUSTOM_MEM_HOOKS',
+	'-DNV_XZ_USE_NVTYPES',
+	'-DXZ_DEC_SINGLE',
+	'-DNVT_USE_NVKMS',
+	'-DDEBUG',
+]
+
+modeset_c_flags = defines + [
+	'-ffreestanding',
+	'-mno-mmx',
+	'-mno-sse',
+	'-mno-sse2',
+	'-mno-3dnow',
+	'-Wno-unused-parameter',
+	'-Wno-unused-but-set-variable',
+	'-Wno-missing-field-initializers',
+	'-fno-strict-aliasing',
+	'-fno-omit-frame-pointer',
+	'-Wformat=2',
+	'-Wno-sign-compare',
+	'-Wno-duplicate-decl-specifier',
+	'-Wno-overloaded-virtual',
+]
+
+modeset_cpp_flags = [
+	'-fno-operator-names',
+	'-fno-rtti',
+	'-fno-exceptions',
+	'-fcheck-new',
+]
+
+subdir('src/shaders')
+
+libnvidia_modeset = static_library('nvidia-modeset',
+	[modeset_src, embedded_shaders],
+	include_directories: [src_inc, modeset_inc],
+	c_args: modeset_c_flags,
+	cpp_args: modeset_c_flags + modeset_cpp_flags,
+	pic: false)
diff --git a/src/nvidia-modeset/os-interface/include/nvidia-modeset-os-interface.h b/src/nvidia-modeset/os-interface/include/nvidia-modeset-os-interface.h
index 25bc5d0..9aa6f48 100644
--- a/src/nvidia-modeset/os-interface/include/nvidia-modeset-os-interface.h
+++ b/src/nvidia-modeset/os-interface/include/nvidia-modeset-os-interface.h
@@ -29,7 +29,7 @@
 #if !defined(_NVIDIA_MODESET_OS_INTERFACE_H_)
 #define _NVIDIA_MODESET_OS_INTERFACE_H_
 
-#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX)
+#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX) && !defined(__managarm__)
 #include <linux/stddef.h>  /* size_t */
 #else
 #include <stddef.h>        /* size_t */
diff --git a/src/nvidia-modeset/os-interface/include/nvkms.h b/src/nvidia-modeset/os-interface/include/nvkms.h
index 0ac3f79..5dc034b 100644
--- a/src/nvidia-modeset/os-interface/include/nvkms.h
+++ b/src/nvidia-modeset/os-interface/include/nvkms.h
@@ -25,7 +25,7 @@
 #define __NV_KMS_H__
 
 #include "nvtypes.h"
-#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX)
+#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX) && !defined(__managarm__)
 #include <linux/stddef.h> /* size_t */
 #else
 #include <stddef.h>       /* size_t */
diff --git a/src/nvidia-modeset/src/shaders/meson.build b/src/nvidia-modeset/src/shaders/meson.build
new file mode 100644
index 0000000..a3725e3
--- /dev/null
+++ b/src/nvidia-modeset/src/shaders/meson.build
@@ -0,0 +1,31 @@
+shader_compress = generator(find_program('xz'),
+	arguments : ['-ce', '-C', 'none', '@INPUT@'],
+	capture : true,
+	output : '@PLAINNAME@.xz')
+
+shader_pack_obj = generator(find_program('../../../../managarm-open/shader-ld.sh'),
+	arguments : [
+		find_program(host_machine.cpu_family() + '-' + host_machine.system() + '-ld').full_path(),
+		'@INPUT@',
+		'@OUTPUT@'
+	],
+	output : '@PLAINNAME@.o-dirty')
+
+shader_objcopy = generator(find_program(host_machine.cpu_family() + '-' + host_machine.system() + '-objcopy'),
+	arguments : ['--rename-section', '.data=.rodata,contents,alloc,load,data,readonly', '@INPUT@', '@OUTPUT@'],
+	output : '@BASENAME@.o')
+
+embed_shaders = [
+	'g_maxwell_shaders',
+	'g_pascal_shaders',
+	'g_volta_shaders',
+	'g_turing_shaders',
+	'g_ampere_shaders',
+	'g_hopper_shaders',
+	'g_blackwell_shaders',
+	'g_gb20x_shaders',
+]
+
+embed_shaders_xz = shader_compress.process(embed_shaders)
+embed_shaders_xz_o = shader_pack_obj.process(embed_shaders_xz)
+embedded_shaders = shader_objcopy.process(embed_shaders_xz_o)
diff --git a/src/nvidia/arch/nvalloc/unix/include/nv-ioctl-numa.h b/src/nvidia/arch/nvalloc/unix/include/nv-ioctl-numa.h
index 0af5267..60bac5c 100644
--- a/src/nvidia/arch/nvalloc/unix/include/nv-ioctl-numa.h
+++ b/src/nvidia/arch/nvalloc/unix/include/nv-ioctl-numa.h
@@ -27,7 +27,7 @@
 
 #include <nv-ioctl-numbers.h>
 
-#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX)
+#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX) && !defined(__managarm__)
 #include <linux/types.h>
 #elif defined (NV_KERNEL_INTERFACE_LAYER) && defined(NV_BSD)
 #include <sys/stdint.h>
diff --git a/src/nvidia/arch/nvalloc/unix/include/nv.h b/src/nvidia/arch/nvalloc/unix/include/nv.h
index bdbefe9..bd551b3 100644
--- a/src/nvidia/arch/nvalloc/unix/include/nv.h
+++ b/src/nvidia/arch/nvalloc/unix/include/nv.h
@@ -43,6 +43,7 @@
 #include <nv-firmware.h>
 #include <nv-ioctl.h>
 #include <nv-ioctl-numa.h>
+#include <nv_uvm_types.h>
 #include <nvmisc.h>
 #include <os/nv_memory_area.h>
 
diff --git a/src/nvidia/arch/nvalloc/unix/src/asm/x86/nv_rdcr.c b/src/nvidia/arch/nvalloc/unix/src/asm/x86/nv_rdcr.c
index 6115aa4..000dd90 100644
--- a/src/nvidia/arch/nvalloc/unix/src/asm/x86/nv_rdcr.c
+++ b/src/nvidia/arch/nvalloc/unix/src/asm/x86/nv_rdcr.c
@@ -29,8 +29,10 @@
 
 NvU32 osNv_rdcr4(void)
 {
-    NvU64 val;
+    NvU64 val = 0;
+#if !defined(__managarm__)
     asm volatile ("movq %%cr4,%0" : "=r" (val));
+#endif
     return (NvU32)val;
 }
 
diff --git a/src/nvidia/arch/nvalloc/unix/src/osinit.c b/src/nvidia/arch/nvalloc/unix/src/osinit.c
index 4a98012..ec448c7 100644
--- a/src/nvidia/arch/nvalloc/unix/src/osinit.c
+++ b/src/nvidia/arch/nvalloc/unix/src/osinit.c
@@ -1350,12 +1350,12 @@ RmSetupRegisters(
     NV_DEV_PRINTF(NV_DBG_SETUP, nv, "RmSetupRegisters for 0x%x:0x%x\n",
               nv->pci_info.vendor_id, nv->pci_info.device_id);
     NV_DEV_PRINTF(NV_DBG_SETUP, nv, "pci config info:\n");
-    NV_DEV_PRINTF(NV_DBG_SETUP, nv, "   registers look  like: 0x%" NvU64_fmtx " 0x%" NvU64_fmtx,
+    NV_DEV_PRINTF(NV_DBG_SETUP, nv, "   registers look  like: 0x%" NvU64_fmtx " 0x%" NvU64_fmtx "\n",
               nv->regs->cpu_address, nv->regs->size);
 
     if (nv->fb != NULL)
     {
-        NV_DEV_PRINTF(NV_DBG_SETUP, nv, "   fb        looks like: 0x%" NvU64_fmtx " 0x%" NvU64_fmtx,
+        NV_DEV_PRINTF(NV_DBG_SETUP, nv, "   fb        looks like: 0x%" NvU64_fmtx " 0x%" NvU64_fmtx "\n",
                 nv->fb->cpu_address, nv->fb->size);
     }
 
diff --git a/src/nvidia/meson.build b/src/nvidia/meson.build
new file mode 100644
index 0000000..45d651e
--- /dev/null
+++ b/src/nvidia/meson.build
@@ -0,0 +1,289 @@
+nvidia_generated_src = files(
+	'generated/g_access_cntr_buffer_nvoc.c',
+	'generated/g_all_dcl_pb.c',
+	'generated/g_binary_api_nvoc.c',
+	'generated/g_bindata.c',
+	'generated/g_ccsl_nvoc.c',
+	'generated/g_ce_utils_nvoc.c',
+	'generated/g_channel_descendant_nvoc.c',
+	'generated/g_chips2halspec_nvoc.c',
+	'generated/g_chipset_nvoc.c',
+	'generated/g_client_nvoc.c',
+	'generated/g_client_resource_nvoc.c',
+	'generated/g_code_coverage_mgr_nvoc.c',
+	'generated/g_compute_instance_subscription_nvoc.c',
+	'generated/g_conf_compute_api_nvoc.c',
+	'generated/g_conf_compute_nvoc.c',
+	'generated/g_console_mem_nvoc.c',
+	'generated/g_context_dma_nvoc.c',
+	'generated/g_crashcat_engine_nvoc.c',
+	'generated/g_crashcat_pb.c',
+	'generated/g_crashcat_queue_nvoc.c',
+	'generated/g_crashcat_report_nvoc.c',
+	'generated/g_crashcat_wayfinder_nvoc.c',
+	'generated/g_dbgbuffer_nvoc.c',
+	'generated/g_deferred_api_nvoc.c',
+	'generated/g_device_nvoc.c',
+	'generated/g_disp_capabilities_nvoc.c',
+	'generated/g_disp_channel_nvoc.c',
+	'generated/g_disp_inst_mem_nvoc.c',
+	'generated/g_disp_objs_nvoc.c',
+	'generated/g_disp_sf_user_nvoc.c',
+	'generated/g_dispsw_nvoc.c',
+	'generated/g_egm_mem_nvoc.c',
+	'generated/g_eng_state_nvoc.c',
+	'generated/g_engines_pb.c',
+	'generated/g_event_buffer_nvoc.c',
+	'generated/g_event_nvoc.c',
+	'generated/g_fabric_nvoc.c',
+	'generated/g_fabric_vaspace_nvoc.c',
+	'generated/g_fbsr_nvoc.c',
+	'generated/g_fla_mem_nvoc.c',
+	'generated/g_fm_session_api_nvoc.c',
+	'generated/g_generic_engine_nvoc.c',
+	'generated/g_gpu_access_nvoc.c',
+	'generated/g_gpu_acct_nvoc.c',
+	'generated/g_gpu_boost_mgr_nvoc.c',
+	'generated/g_gpu_class_list.c',
+	'generated/g_gpu_db_nvoc.c',
+	'generated/g_gpu_group_nvoc.c',
+	'generated/g_gpu_halspec_nvoc.c',
+	'generated/g_gpu_instance_subscription_nvoc.c',
+	'generated/g_gpu_mgmt_api_nvoc.c',
+	'generated/g_gpu_mgr_nvoc.c',
+	'generated/g_gpu_nvoc.c',
+	'generated/g_gpu_resource_nvoc.c',
+	'generated/g_gpu_user_shared_data_nvoc.c',
+	'generated/g_gpu_vaspace_nvoc.c',
+	'generated/g_gr_pb.c',
+	'generated/g_gsp_pb.c',
+	'generated/g_gsync_api_nvoc.c',
+	'generated/g_gsync_nvoc.c',
+	'generated/g_hal_mgr_nvoc.c',
+	'generated/g_hal_nvoc.c',
+	'generated/g_hda_codec_api_nvoc.c',
+	'generated/g_heap_nvoc.c',
+	'generated/g_host_eng_nvoc.c',
+	'generated/g_hw_resources_nvoc.c',
+	'generated/g_hypervisor_nvoc.c',
+	'generated/g_i2c_api_nvoc.c',
+	'generated/g_imex_session_api_nvoc.c',
+	'generated/g_intr_nvoc.c',
+	'generated/g_intr_service_nvoc.c',
+	'generated/g_io_vaspace_nvoc.c',
+	'generated/g_ioaccess_nvoc.c',
+	'generated/g_journal_nvoc.c',
+	'generated/g_journal_pb.c',
+	'generated/g_kern_bus_nvoc.c',
+	'generated/g_kern_disp_nvoc.c',
+	'generated/g_kern_fsp_nvoc.c',
+	'generated/g_kern_gmmu_nvoc.c',
+	'generated/g_kern_hwpm_common_defs_nvoc.c',
+	'generated/g_kern_hwpm_nvoc.c',
+	'generated/g_kern_hwpm_power_nvoc.c',
+	'generated/g_kern_mem_sys_nvoc.c',
+	'generated/g_kern_perf_nvoc.c',
+	'generated/g_kern_perfbuffer_nvoc.c',
+	'generated/g_kern_pmu_nvoc.c',
+	'generated/g_kernel_bif_nvoc.c',
+	'generated/g_kernel_ccu_api_nvoc.c',
+	'generated/g_kernel_ccu_nvoc.c',
+	'generated/g_kernel_ce_context_nvoc.c',
+	'generated/g_kernel_ce_nvoc.c',
+	'generated/g_kernel_channel_group_api_nvoc.c',
+	'generated/g_kernel_channel_group_nvoc.c',
+	'generated/g_kernel_channel_nvoc.c',
+	'generated/g_kernel_crashcat_engine_nvoc.c',
+	'generated/g_kernel_ctxshare_nvoc.c',
+	'generated/g_kernel_falcon_nvoc.c',
+	'generated/g_kernel_fifo_nvoc.c',
+	'generated/g_kernel_graphics_context_nvoc.c',
+	'generated/g_kernel_graphics_manager_nvoc.c',
+	'generated/g_kernel_graphics_nvoc.c',
+	'generated/g_kernel_graphics_object_nvoc.c',
+	'generated/g_kernel_gsp_nvoc.c',
+	'generated/g_kernel_gsplite_nvoc.c',
+	'generated/g_kernel_head_nvoc.c',
+	'generated/g_kernel_hostvgpudeviceapi_nvoc.c',
+	'generated/g_kernel_ioctrl_nvoc.c',
+	'generated/g_kernel_mc_nvoc.c',
+	'generated/g_kernel_mig_manager_nvoc.c',
+	'generated/g_kernel_nvdec_ctx_nvoc.c',
+	'generated/g_kernel_nvenc_ctx_nvoc.c',
+	'generated/g_kernel_nvjpg_ctx_nvoc.c',
+	'generated/g_kernel_nvlink_nvoc.c',
+	'generated/g_kernel_ofa_ctx_nvoc.c',
+	'generated/g_kernel_rc_nvoc.c',
+	'generated/g_kernel_sec2_nvoc.c',
+	'generated/g_kernel_sm_debugger_session_nvoc.c',
+	'generated/g_kernel_vgpu_mgr_nvoc.c',
+	'generated/g_kernel_video_engine_nvoc.c',
+	'generated/g_lock_stress_nvoc.c',
+	'generated/g_lock_test_nvoc.c',
+	'generated/g_mem_export_nvoc.c',
+	'generated/g_mem_fabric_import_ref_nvoc.c',
+	'generated/g_mem_fabric_import_v2_nvoc.c',
+	'generated/g_mem_fabric_nvoc.c',
+	'generated/g_mem_list_nvoc.c',
+	'generated/g_mem_mapper_nvoc.c',
+	'generated/g_mem_mgr_nvoc.c',
+	'generated/g_mem_multicast_fabric_nvoc.c',
+	'generated/g_mem_nvoc.c',
+	'generated/g_mig_config_session_nvoc.c',
+	'generated/g_mig_monitor_session_nvoc.c',
+	'generated/g_mmu_fault_buffer_nvoc.c',
+	'generated/g_mps_api_nvoc.c',
+	'generated/g_no_device_mem_nvoc.c',
+	'generated/g_nv_debug_dump_nvoc.c',
+	'generated/g_nvdebug_pb.c',
+	'generated/g_nvencsession_nvoc.c',
+	'generated/g_nvfbc_session_nvoc.c',
+	'generated/g_object_nvoc.c',
+	'generated/g_objsweng_nvoc.c',
+	'generated/g_objtmr_nvoc.c',
+	'generated/g_os_desc_mem_nvoc.c',
+	'generated/g_os_nvoc.c',
+	'generated/g_p2p_api_nvoc.c',
+	'generated/g_phys_mem_nvoc.c',
+	'generated/g_platform_nvoc.c',
+	'generated/g_platform_request_handler_nvoc.c',
+	'generated/g_prereq_tracker_nvoc.c',
+	'generated/g_profiler_v1_nvoc.c',
+	'generated/g_profiler_v2_nvoc.c',
+	'generated/g_rc_pb.c',
+	'generated/g_ref_count_nvoc.c',
+	'generated/g_reg_mem_nvoc.c',
+	'generated/g_regs_pb.c',
+	'generated/g_resource_nvoc.c',
+	'generated/g_rg_line_callback_nvoc.c',
+	'generated/g_rmconfig_util.c',
+	'generated/g_rpc_iom.c',
+	'generated/g_rpcstructurecopy_iom.c',
+	'generated/g_rs_client_nvoc.c',
+	'generated/g_rs_resource_nvoc.c',
+	'generated/g_rs_server_nvoc.c',
+	'generated/g_sec2_context_nvoc.c',
+	'generated/g_sec2_utils_nvoc.c',
+	'generated/g_sem_surf_nvoc.c',
+	'generated/g_spdm_nvoc.c',
+	'generated/g_spdm_proxy_nvoc.c',
+	'generated/g_standard_mem_nvoc.c',
+	'generated/g_subdevice_diag_nvoc.c',
+	'generated/g_subdevice_nvoc.c',
+	'generated/g_sw_test_nvoc.c',
+	'generated/g_swintr_nvoc.c',
+	'generated/g_syncgpuboost_nvoc.c',
+	'generated/g_syncpoint_mem_nvoc.c',
+	'generated/g_system_mem_nvoc.c',
+	'generated/g_system_nvoc.c',
+	'generated/g_third_party_p2p_nvoc.c',
+	'generated/g_timed_sema_nvoc.c',
+	'generated/g_tmr_nvoc.c',
+	'generated/g_traceable_nvoc.c',
+	'generated/g_usermode_api_nvoc.c',
+	'generated/g_uvm_channel_retainer_nvoc.c',
+	'generated/g_uvm_nvoc.c',
+	'generated/g_uvm_sw_nvoc.c',
+	'generated/g_vaspace_api_nvoc.c',
+	'generated/g_vaspace_nvoc.c',
+	'generated/g_vblank_callback_nvoc.c',
+	'generated/g_vgpuapi_nvoc.c',
+	'generated/g_vgpuconfigapi_nvoc.c',
+	'generated/g_video_mem_nvoc.c',
+	'generated/g_vidmem_access_bit_buffer_nvoc.c',
+	'generated/g_virt_mem_allocator_nvoc.c',
+	'generated/g_virt_mem_mgr_nvoc.c',
+	'generated/g_virt_mem_range_nvoc.c',
+	'generated/g_virtual_mem_nvoc.c',
+	'generated/g_zbc_api_nvoc.c',
+)
+
+inc = include_directories(
+	'arch/nvalloc/common/inc',
+	'arch/nvalloc/common/inc/gsp',
+	# 'arch/nvalloc/common/inc/deprecated',
+	'arch/nvalloc/unix/include',
+	'inc',
+	'inc/os',
+	'generated',
+	'kernel/inc',
+	'interface',
+	'inc/libraries',
+	'src/libraries',
+	'inc/kernel',
+
+	'src/libraries/libspdm/3.1.1/include',
+	'src/libraries/libspdm/3.1.1/include/hal',
+	'src/libraries/libspdm/3.1.1/os_stub/include',
+	'src/libraries/libspdm/3.1.1/os_stub',
+	# 'src/libraries/libspdm/3.1.1/os_stub/cryptlib_null',
+	'src/libraries/libspdm/nvidia',
+)
+
+defines = [
+	'-DNV_LINUX',
+	'-DNV_X86_64',
+	'-DNV_ARCH_BITS=64',
+	'-include', '../common/sdk/nvidia/inc/cpuopsys.h',
+	'-D_LANGUAGE_C',
+	'-D__NO_CTYPE',
+	'-DNVRM',
+	'-DLOCK_VAL_ENABLED=0',
+	'-DPORT_ATOMIC_64_BIT_SUPPORTED=1',
+	'-DPORT_IS_KERNEL_BUILD=1',
+	'-DPORT_IS_CHECKED_BUILD=1',
+	'-DPORT_MODULE_atomic=1',
+	'-DPORT_MODULE_core=1',
+	'-DPORT_MODULE_cpu=1',
+	'-DPORT_MODULE_crypto=1',
+	'-DPORT_MODULE_debug=1',
+	'-DPORT_MODULE_memory=1',
+	'-DPORT_MODULE_safe=1',
+	'-DPORT_MODULE_string=1',
+	'-DPORT_MODULE_sync=1',
+	'-DPORT_MODULE_thread=1',
+	'-DPORT_MODULE_util=1',
+	'-DPORT_MODULE_example=0',
+	'-DPORT_MODULE_mmio=0',
+	'-DPORT_MODULE_time=0',
+	'-DRS_STANDALONE=0',
+	'-DRS_STANDALONE_TEST=0',
+	'-DRS_COMPATABILITY_MODE=1',
+	'-DRS_PROVIDES_API_STATE=0',
+	'-DNV_CONTAINERS_NO_TEMPLATES',
+	'-DINCLUDE_NVLINK_LIB',
+	'-DINCLUDE_NVSWITCH_LIB',
+	'-DNV_PRINTF_STRINGS_ALLOWED=1',
+	'-DNV_ASSERT_FAILED_USES_STRINGS=1',
+	'-DPORT_ASSERT_FAILED_USES_STRINGS=1',
+	'-DLIBSPDM_CONFIG="nvspdm_rmconfig.h"',
+	'-DDEBUG',
+]
+
+c_flags = defines + [
+	'-ffreestanding',
+	'-mno-mmx',
+	'-mno-sse',
+	'-mno-sse2',
+	'-mno-3dnow',
+	'-Wno-unused-parameter',
+	'-Wno-unused-but-set-variable',
+	'-Wno-missing-field-initializers',
+	'-Wno-sign-compare',
+	'-Wno-initializer-overrides',
+	'-Wno-enum-conversion',
+	'-Wno-unused-variable',
+	'-Wno-non-literal-null-conversion',
+	'-Wno-cast-function-type-mismatch',
+	'-Wno-ignored-qualifiers',
+	'-Wno-unused-but-set-parameter',
+]
+
+libnvidia = static_library('nvidia',
+	[
+		nvidia_generated_src, nvidia_common_src, nvidia_libraries_src, nvidia_kernel_src,
+		nvidia_nvalloc_src, nvidia_interface_src
+	],
+	include_directories: [src_inc, inc],
+	c_args: c_flags,
+	pic: false)
-- 
2.49.0

